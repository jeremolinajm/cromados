========== FILE: ./App.css ==========
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


========== FILE: ./App.tsx ==========
// src/App.tsx
import { Suspense, lazy } from "react";
import { Routes, Route, Navigate, useLocation } from "react-router-dom";
import Navbar from "./components/Navbar";
import Footer from "./components/Footer";
import PagoResult from "./components/PagoResult";

// P√°ginas p√∫blicas
const HomePage = lazy(() => import("./pages/Inicio"));
const TurnosPage = lazy(() => import("./pages/Turnos"));
const BarberosPage = lazy(() => import("./pages/Barberos"));
const NosotrosPage = lazy(() => import("./pages/Nosotros"));
const PrivacidadPage = lazy(() => import("./pages/Privacidad"));

// Admin: componente propio (NO lib/adminApi)
const AdminApp = lazy(() => import("./pages/admin/AdminApp"));

function PublicLayout({ children }: { children: React.ReactNode }) {
  const location = useLocation();
  const isHome = location.pathname === "/";

  return (
    <div className="min-h-screen flex flex-col">
      <Navbar />
      {/* Sin padding-top en home para que el video ocupe toda la pantalla */}
      <main className={`flex-1 ${isHome ? '' : 'pt-20'}`}>{children}</main>
      {/* Footer solo en p√°ginas que no son home (home tiene copyright integrado) */}
      {!isHome && <Footer />}
    </div>
  );
}

export default function App() {
  const location = useLocation();
  const isAdmin = location.pathname.startsWith("/admin");

  return (
    <Suspense fallback={<div className="p-6 text-center">Cargando‚Ä¶</div>}>
      <Routes>
        {/* Rutas p√∫blicas con layout + Navbar */}
        <Route
          path="/"
          element={
            <PublicLayout>
              <HomePage />
            </PublicLayout>
          }
        />
        <Route
          path="/turnos"
          element={
            <PublicLayout>
              <TurnosPage />
            </PublicLayout>
          }
        />
        <Route
          path="/barberos"
          element={
            <PublicLayout>
              <BarberosPage />
            </PublicLayout>
          }
        />
        <Route
          path="/nosotros"
          element={
            <PublicLayout>
              <NosotrosPage />
            </PublicLayout>
          }
        />
        <Route
          path="/privacidad"
          element={
            <PublicLayout>
              <PrivacidadPage />
            </PublicLayout>
          }
        />

        {/* Panel admin con su propio layout */}
        <Route path="/admin/*" element={<AdminApp />} />

        {/* 404 */}
        <Route path="*" element={<Navigate to={isAdmin ? "/admin" : "/"} replace />} />
        <Route path="/pago/success" element={<PagoResult kind="success" />} />
        <Route path="/pago/pending" element={<PagoResult kind="pending" />} />
        <Route path="/pago/failure" element={<PagoResult kind="failure" />} />
      </Routes>
    </Suspense>
  );
}


========== FILE: ./assets/react.svg ==========
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>

========== FILE: ./components/CustomSelect.tsx ==========
import { useState, useRef, useEffect } from "react";
import { createPortal } from "react-dom";

type Option = {
  value: string;
  label: string;
};

type Props = {
  value: string;
  onChange: (value: string) => void;
  options: Option[];
  placeholder?: string;
  className?: string;
  disabled?: boolean;
  dropup?: boolean; // Abre el dropdown hacia arriba en lugar de hacia abajo
};

export default function CustomSelect({
  value,
  onChange,
  options,
  placeholder = "Seleccionar...",
  className = "",
  disabled = false,
  dropup = false,
}: Props) {
  const [isOpen, setIsOpen] = useState(false);
  const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0, width: 0, shouldDropUp: false });
  const containerRef = useRef<HTMLDivElement>(null);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const isScrollingRef = useRef(false);

  const selectedOption = options.find((opt) => opt.value === value);
  const displayText = selectedOption ? selectedOption.label : placeholder;

  // Calcular posici√≥n del dropdown
  const updateDropdownPosition = () => {
    if (containerRef.current) {
      const rect = containerRef.current.getBoundingClientRect();
      const dropdownHeight = 240; // max-h-60 = 15rem = 240px
      const spaceBelow = window.innerHeight - rect.bottom;
      const spaceAbove = rect.top;

      // Determinar si debe abrirse hacia arriba autom√°ticamente
      const shouldDropUp = dropup || (spaceBelow < dropdownHeight && spaceAbove > spaceBelow);

      setDropdownPosition({
        top: shouldDropUp ? rect.top - 8 : rect.bottom + 8,
        left: rect.left,
        width: rect.width,
        shouldDropUp,
      });
    }
  };

  useEffect(() => {
    const handleTouchMove = (event: TouchEvent) => {
      // Si el touch est√° dentro del dropdown, marcar que se est√° scrolleando
      if (dropdownRef.current && dropdownRef.current.contains(event.target as Node)) {
        isScrollingRef.current = true;
      }
    };

    const handleClickOutside = (event: MouseEvent | TouchEvent) => {
      const target = event.target as Node;

      // NO cerrar si el click/touch es dentro del dropdown
      if (dropdownRef.current && dropdownRef.current.contains(target)) {
        return;
      }

      // NO cerrar si acabamos de scrollear (touchend despu√©s de scroll)
      if (event.type === 'touchend' && isScrollingRef.current) {
        isScrollingRef.current = false;
        return;
      }

      // Cerrar si es fuera del contenedor completo
      if (containerRef.current && !containerRef.current.contains(target)) {
        setIsOpen(false);
      }
    };

    const handleScroll = (event: Event) => {
      const target = event.target;

      // ‚úÖ NO cerrar si el scroll es dentro del propio dropdown
      if (dropdownRef.current && (target === dropdownRef.current || dropdownRef.current.contains(target as Node))) {
        return;
      }

      // ‚úÖ NO cerrar si el scroll es dentro de la tabla horizontal
      if (target instanceof HTMLElement && target.classList.contains('overflow-x-auto')) {
        return;
      }

      // ‚úÖ Cerrar para scroll de p√°gina o window
      if (target === document || target === document.documentElement || target === document.body || target === window) {
        setIsOpen(false);
        return;
      }

      // Para otros scrolls, cerrar el dropdown
      setIsOpen(false);
    };

    if (isOpen) {
      // Reset scroll flag cuando se abre
      isScrollingRef.current = false;

      // Calcular posici√≥n inicial
      updateDropdownPosition();

      // Actualizar posici√≥n en scroll/resize
      window.addEventListener("scroll", updateDropdownPosition, true);
      window.addEventListener("resize", updateDropdownPosition);

      // Detectar touchmove para saber si el usuario est√° scrolleando
      document.addEventListener("touchmove", handleTouchMove, { passive: true });
      // Usar mousedown/touchend para cerrar
      document.addEventListener("mousedown", handleClickOutside);
      document.addEventListener("touchend", handleClickOutside);
      window.addEventListener("scroll", handleScroll, true);

      return () => {
        window.removeEventListener("scroll", updateDropdownPosition, true);
        window.removeEventListener("resize", updateDropdownPosition);
        document.removeEventListener("touchmove", handleTouchMove);
        document.removeEventListener("mousedown", handleClickOutside);
        document.removeEventListener("touchend", handleClickOutside);
        window.removeEventListener("scroll", handleScroll, true);
      };
    }
  }, [isOpen, dropup]);

  const handleSelect = (optValue: string) => {
    onChange(optValue);
    setIsOpen(false);
  };

  const dropdownContent = isOpen && !disabled && (
    <div
      ref={dropdownRef}
      className="max-h-60 overflow-y-auto rounded-lg border border-slate-300 bg-white shadow-lg"
      style={{
        position: 'fixed',
        top: dropdownPosition.shouldDropUp ? dropdownPosition.top : dropdownPosition.top,
        left: dropdownPosition.left,
        width: dropdownPosition.width,
        zIndex: 99999,
        WebkitOverflowScrolling: 'touch',
        touchAction: 'pan-y',
        maxHeight: '15rem',
        transform: dropdownPosition.shouldDropUp ? 'translateY(-100%)' : 'none',
      }}
    >
      {options.map((opt) => (
        <button
          key={opt.value}
          type="button"
          onClick={() => handleSelect(opt.value)}
          className={`w-full px-3 py-2 text-left text-sm hover:bg-fuchsia-50 ${
            opt.value === value ? "bg-fuchsia-100 text-fuchsia-700 font-medium" : "text-slate-900"
          }`}
        >
          {opt.label}
        </button>
      ))}
      {options.length === 0 && (
        <div className="px-3 py-2 text-sm text-slate-500">Sin opciones</div>
      )}
    </div>
  );

  return (
    <>
      <div ref={containerRef} className={`relative ${className}`}>
        <button
          type="button"
          disabled={disabled}
          onClick={() => !disabled && setIsOpen(!isOpen)}
          className={`w-full rounded-lg border border-slate-300 px-3 py-2 text-left text-sm bg-white flex items-center justify-between ${
            disabled ? "opacity-50 cursor-not-allowed" : "hover:border-slate-400"
          } ${!selectedOption ? "text-slate-400" : "text-slate-900"}`}
        >
          <span className="truncate">{displayText}</span>
          <svg
            className={`w-4 h-4 ml-2 transition-transform flex-shrink-0 ${isOpen ? "rotate-180" : ""}`}
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>

      {dropdownContent && createPortal(dropdownContent, document.body)}
    </>
  );
}


========== FILE: ./components/DatosClienteModal.tsx ==========
import { useEffect, useState } from "react";

type Props = {
  open: boolean;
  onCancel: () => void;
  onConfirm: (data: { nombre: string; telefono: string; edad: number }) => void;
};

export default function DatosClienteModal({ open, onCancel, onConfirm }: Props) {
  const [nombre, setNombre] = useState("");
  const [countryCode, setCountryCode] = useState("+54"); // üÜï C√≥digo de pa√≠s (default Argentina)
  const [telefono, setTelefono] = useState("");
  const [edad, setEdad] = useState<number | "">("");

  // bloquear scroll detr√°s del modal
  useEffect(() => {
    if (open) document.body.style.overflow = "hidden";
    return () => { document.body.style.overflow = ""; };
  }, [open]);

  if (!open) return null;

  const confirmar = () => {
    const e = typeof edad === "string" ? parseInt(edad || "0", 10) : edad;
    if (!nombre.trim()) return alert("Ingres√° tu nombre");
    if (!telefono.trim()) return alert("Ingres√° tu tel√©fono");
    if (!e || e < 3) return alert("Ingres√° una edad v√°lida (‚â• 4)");

    // üÜï Combinar c√≥digo de pa√≠s + n√∫mero (sin + duplicado)
    let telefonoCompleto = countryCode + telefono.replace(/^\+/, "").replace(/\s+/g, "");

    // üá¶üá∑ Argentina: insertar el 9 despu√©s del +54 para WhatsApp
    if (countryCode === "+54") {
      telefonoCompleto = "+549" + telefono.replace(/^\+/, "").replace(/\s+/g, "");
    }

    onConfirm({ nombre: nombre.trim(), telefono: telefonoCompleto, edad: e });
  };

  return (
    <div className="fixed inset-0 z-[1000]">
      {/* Backdrop que bloquea toda interacci√≥n detr√°s */}
      <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onCancel} />
      <div className="absolute inset-0 flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div className="w-full max-w-md rounded-t-3xl sm:rounded-2xl bg-white shadow-2xl p-5 sm:p-6 max-h-[90vh] overflow-y-auto">
          <h2 className="text-lg sm:text-xl font-semibold mb-4 sm:mb-5">Tus datos</h2>

          <label className="block text-sm font-medium mb-1.5">Nombre</label>
          <input
            className="w-full rounded-lg border border-gray-300 px-3 py-2.5 mb-3 text-base focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent"
            value={nombre}
            onChange={(e) => setNombre(e.target.value)}
            placeholder="Nombre y apellido"
          />

          <label className="block text-sm font-medium mb-1.5">Tel√©fono</label>
          <div className="flex gap-2 mb-3">
            {/* Selector de c√≥digo de pa√≠s */}
            <select
              className="w-[110px] flex-shrink-0 rounded-lg border border-gray-300 px-2 py-2.5 text-base focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent bg-white"
              value={countryCode}
              onChange={(e) => setCountryCode(e.target.value)}
            >
              <option value="+54">AR +54</option>
              <option value="+598">UY +598</option>
              <option value="+595">PY +595</option>
              <option value="+56">CL +56</option>
              <option value="+55">BR +55</option>
              <option value="+1">US +1</option>
              <option value="+34">ES +34</option>
              <option value="+52">MX +52</option>
              <option value="+51">PE +51</option>
              <option value="+57">CO +57</option>
            </select>
            {/* Input de n√∫mero */}
            <input
              className="flex-1 min-w-0 rounded-lg border border-gray-300 px-3 py-2.5 text-base focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent"
              value={telefono}
              onChange={(e) => setTelefono(e.target.value)}
              placeholder={countryCode === "+54" ? "11 1234 5678" : "n√∫mero"}
              type="tel"
            />
          </div>

          <label className="block text-sm font-medium mb-1.5">Edad</label>
          <input
            type="number"
            className="w-full rounded-lg border border-gray-300 px-3 py-2.5 mb-4 sm:mb-5 text-base focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent"
            value={edad}
            onChange={(e) => setEdad(e.target.value === "" ? "" : Number(e.target.value))}
            placeholder="18"
            min={3}
          />

          <div className="flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-center gap-2 sm:gap-3">
            <button
              className="px-4 py-2.5 rounded-lg border border-gray-300 shadow-sm hover:bg-gray-50 transition-colors font-medium"
              onClick={onCancel}
            >
              Cancelar
            </button>
            <button
              className="px-4 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl transition-all font-semibold"
              onClick={confirmar}
            >
              Pagar con Mercado Pago
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}


========== FILE: ./components/Footer.tsx ==========
import { useLocation, Link } from "react-router-dom";

export default function Footer() {
  const currentYear = new Date().getFullYear();
  const location = useLocation();

  // Usar texto blanco en la p√°gina de inicio (que tiene video de fondo oscuro)
  const isHome = location.pathname === "/";
  const textColor = isHome ? "text-white/90" : "text-gray-900";
  const nameColor = isHome ? "text-white" : "text-black";
  const linkColor = isHome ? "text-white/80 hover:text-white" : "text-gray-600 hover:text-gray-900";

  return (
    <footer className="py-6 text-center">
      <p className={`text-xs sm:text-sm ${textColor} mb-2`}>
        &copy; {currentYear} <span className={`font-semibold ${nameColor}`}>Cromados</span>. Todos los derechos reservados.
      </p>
      <p className="text-xs">
        <Link to="/privacidad" className={`${linkColor} underline transition-colors`}>
          Pol√≠tica de Privacidad
        </Link>
      </p>
    </footer>
  );
}



========== FILE: ./components/IntroSucursales.tsx ==========
import { useEffect, useState } from "react";
import { useToast } from "../components/Toast";
import { endpoints } from "../lib/endpoints";
import { GET } from "../lib/http";
import { resolveUrl } from "../lib/adminApi";
import OptimizedImage from "./OptimizedImage";

type Sucursal = { id: number; nombre: string; direccion: string; fotoUrl?: string | null };

type Props = {
  onSelect: (sucursalId: number) => void;
};

export default function IntroSucursales({ onSelect }: Props) {
  const toast = useToast();
  const [loading, setLoading] = useState(true);
  const [sucursales, setSucursales] = useState<Sucursal[]>([]);

  useEffect(() => {
    (async () => {
      try {
        const data = await GET<Sucursal[]>(endpoints.sucursales());
        setSucursales(Array.isArray(data) ? data : []);
      } catch {
        toast("No se pudieron cargar las sucursales.");
      } finally {
        setLoading(false);
      }
    })();
  }, [toast]);

  return (
    <div className="fixed inset-0 z-40 bg-black/50">
      <div className="absolute inset-0 overflow-y-auto pt-24 pb-8">
        <div className="mx-auto max-w-6xl px-4">
          {loading ? (
            <div className="text-white/90">Cargando sucursales‚Ä¶</div>
          ) : (
            <div className={`grid gap-5 ${sucursales.length === 1 ? 'grid-cols-1 max-w-xl mx-auto' : 'md:grid-cols-2'}`}>
              {sucursales.map((s) => (
                <div key={s.id} className="rounded-2xl overflow-hidden bg-white shadow-sm">
                  {/* imagen grande 16:9 */}
                  <div className="aspect-[16/9] bg-slate-100">
                    {s.fotoUrl ? (
                      <OptimizedImage
                        src={resolveUrl(s.fotoUrl)}
                        alt={`Foto de ${s.nombre}`}
                        className="h-full w-full object-cover"
                        width={1200}
                        height={675}
                        loading="lazy"
                        onError={(e) => {
                          (e.currentTarget as HTMLImageElement).src = "/placeholder-wide.jpg";
                        }}
                      />
                    ) : (
                      <div className="h-full w-full object-cover bg-slate-200 grid place-items-center text-s text-slate-600 border shrink-0">
                        Sin foto
                      </div>
                    )}
                  </div>

                  <div className="p-5">
                    <h3 className="text-xl font-semibold">{s.nombre}</h3>
                    <p className="text-slate-600 mt-1">{s.direccion}</p>

                    <div className="mt-4 flex gap-3">
                      <a
                        className="rounded-lg border px-3 py-2"
                        href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
                          s.direccion || s.nombre
                        )}`}
                        target="_blank"
                        rel="noreferrer"
                      >
                        C√≥mo llegar
                      </a>
                      <button
                        className="rounded-lg bg-fuchsia-600 px-3 py-2 text-white"
                        onClick={() => onSelect(s.id)}
                      >
                        Elegir esta sucursal
                      </button>
                    </div>
                  </div>
                </div>
              ))}
              {sucursales.length === 0 && (
                <div className="rounded-xl bg-white p-4">No hay sucursales disponibles.</div>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}


========== FILE: ./components/Navbar.tsx ==========
import { useState, useEffect } from "react";
import { NavLink } from "react-router-dom";

const links = [
  { to: "/", label: "Inicio" },
  { to: "/barberos", label: "Barberos" },
  { to: "/nosotros", label: "Nosotros" },
];

export default function Navbar() {
  const [open, setOpen] = useState(false);
  const [scrolled, setScrolled] = useState(false);

  // Detectar scroll para efecto glassmorphism din√°mico
  useEffect(() => {
    const handleScroll = () => {
      setScrolled(window.scrollY > 20);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  const base = "px-4 py-2 rounded-full font-medium transition-all duration-300 text-sm";
  const active = "text-white bg-white/20";
  const inactive = "text-gray-300 hover:text-white hover:bg-white/10";

  return (
    <header className="fixed top-0 inset-x-0 z-50 text-white">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 lg:pt-6">
        {/* Desktop: Navbar flotante estilo pill */}
        <div className="hidden lg:flex items-center justify-center">
          <nav className={`flex items-center gap-1 px-2 py-2 rounded-full transition-all duration-300 ${
            scrolled
              ? "bg-black/90 backdrop-blur-xl shadow-2xl"
              : "bg-black/70 backdrop-blur-md"
          }`}>
            {links.map((l) => (
              <NavLink
                key={l.to}
                to={l.to}
                end={l.to === "/"}
                className={({ isActive }) =>
                  `${base} ${isActive ? active : inactive}`
                }
              >
                {l.label}
              </NavLink>
            ))}
            <NavLink
              to="/turnos"
              className="ml-1 px-5 py-2 rounded-full font-semibold bg-fuchsia-600 hover:bg-fuchsia-700 text-white transition-all duration-300 text-sm shadow-lg shadow-fuchsia-500/30"
            >
              Reservar Turno
            </NavLink>
          </nav>
        </div>

        {/* Mobile: Navbar compacto */}
        <div className={`lg:hidden flex items-center justify-between px-4 py-3 rounded-full transition-all duration-300 ${
          scrolled
            ? "bg-black/90 backdrop-blur-xl shadow-2xl"
            : "bg-black/70 backdrop-blur-md"
        }`}>
          {/* Logo */}
          <NavLink to="/" className="flex items-center" onClick={() => setOpen(false)}>
            <img
              src="/logo.png"
              alt="Cromados"
              className="h-9 w-9 rounded-lg object-cover"
              onError={(e) => {
                (e.currentTarget as HTMLImageElement).src = "/placeholder-avatar.png";
              }}
            />
          </NavLink>

          {/* Bot√≥n hamburguesa */}
          <button
            type="button"
            aria-label="Abrir men√∫"
            aria-expanded={open}
            onClick={() => setOpen((v) => !v)}
            className="inline-flex items-center justify-center w-9 h-9 rounded-full hover:bg-white/10 focus:outline-none transition-all duration-200"
          >
            <svg
              className={`${open ? "hidden" : "block"} h-5 w-5`}
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
            >
              <path d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg
              className={`${open ? "block" : "hidden"} h-5 w-5`}
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
            >
              <path d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      {/* Men√∫ m√≥vil desplegable - dropdown compacto */}
      {open && (
        <div className="lg:hidden px-4 sm:px-6 mt-3">
          <div className={`rounded-2xl overflow-hidden shadow-2xl transition-all duration-300 ${
            scrolled
              ? "bg-black/90 backdrop-blur-xl"
              : "bg-black/80 backdrop-blur-lg"
          }`}>
            <nav className="py-2 px-2">
              <ul className="space-y-1">
                {links.map((l) => (
                  <li key={l.to}>
                    <NavLink
                      to={l.to}
                      end={l.to === "/"}
                      onClick={() => setOpen(false)}
                      className={({ isActive }) =>
                        `block px-4 py-2 rounded-full font-medium transition-all duration-200 text-center ${
                          isActive
                            ? "text-white bg-white/20"
                            : "text-gray-300 hover:text-white hover:bg-white/10"
                        }`
                      }
                    >
                      {l.label}
                    </NavLink>
                  </li>
                ))}

                {/* Separador */}
                <li className="px-4 py-2">
                  <div className="border-t border-white/10"></div>
                </li>

                {/* Bot√≥n CTA en mobile */}
                <li className="px-4 pb-2">
                  <NavLink
                    to="/turnos"
                    onClick={() => setOpen(false)}
                    className="block px-6 py-3 rounded-xl font-semibold bg-fuchsia-600 hover:bg-fuchsia-700 text-white text-center shadow-lg shadow-fuchsia-500/30 transition-all duration-300"
                  >
                    Reservar Turno
                  </NavLink>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      )}
    </header>
  );
}


========== FILE: ./components/OptimizedImage.tsx ==========
/**
 * Componente de imagen optimizada con soporte para srcset y lazy loading.
 * Genera autom√°ticamente las URLs de las diferentes versiones (400px, 800px, 1200px)
 * bas√°ndose en la convenci√≥n de nombres del backend.
 */

interface OptimizedImageProps {
  /** URL base de la imagen (ej: "/uploads/barberos/barbero-1-123456.webp") */
  src: string;
  /** Texto alternativo para accesibilidad */
  alt: string;
  /** Clases CSS adicionales */
  className?: string;
  /** Ancho de la imagen en p√≠xeles (para evitar CLS - Cumulative Layout Shift) */
  width?: number;
  /** Alto de la imagen en p√≠xeles (para evitar CLS) */
  height?: number;
  /** Si debe usar lazy loading (default: true) */
  loading?: "lazy" | "eager";
  /** Funci√≥n que se ejecuta si hay error al cargar */
  onError?: (e: React.SyntheticEvent<HTMLImageElement, Event>) => void;
}

/**
 * Componente de imagen optimizada con srcset responsivo.
 *
 * Genera autom√°ticamente las diferentes versiones de la imagen:
 * - 400px para m√≥viles (thumbnail)
 * - 800px para tablets (medium)
 * - 1200px para desktop (large)
 *
 * Ejemplo de uso:
 * ```tsx
 * <OptimizedImage
 *   src="/uploads/barberos/barbero-1-123456.webp"
 *   alt="Foto del barbero"
 *   width={800}
 *   height={800}
 *   className="rounded-full"
 * />
 * ```
 */
export default function OptimizedImage({
  src,
  alt,
  className = "",
  width,
  height,
  loading = "lazy",
  onError,
}: OptimizedImageProps) {
  // Si la imagen ya tiene un sufijo de tama√±o (-400, -800, -1200), usar directamente
  if (src.match(/-(400|800|1200)\.(webp|jpg|jpeg|png)$/)) {
    return (
      <img
        src={src}
        alt={alt}
        className={className}
        width={width}
        height={height}
        loading={loading}
        onError={onError}
      />
    );
  }

  // Generar versiones de la imagen
  const { thumbnail, medium, large, original } = generateImageVersions(src);

  return (
    <img
      src={original}
      srcSet={`
        ${thumbnail} 400w,
        ${medium} 800w,
        ${large} 1200w
      `}
      sizes="(max-width: 640px) 400px, (max-width: 1024px) 800px, 1200px"
      alt={alt}
      className={className}
      width={width}
      height={height}
      loading={loading}
      onError={onError}
    />
  );
}

/**
 * Genera las URLs de las diferentes versiones de una imagen.
 *
 * Convenci√≥n de nombres:
 * - Original: barbero-1-123456.jpg
 * - Thumbnail: barbero-1-123456-400.jpg
 * - Medium: barbero-1-123456-800.jpg
 * - Large: barbero-1-123456-1200.jpg
 */
function generateImageVersions(src: string) {
  // Remover extensi√≥n y obtener base
  const lastDot = src.lastIndexOf('.');
  const base = src.substring(0, lastDot);
  const ext = src.substring(lastDot);

  // Usar JPG optimizado
  const jpgExt = ext.toLowerCase().match(/\.(jpg|jpeg)$/) ? ext : '.jpg';

  return {
    thumbnail: `${base}-400${jpgExt}`,
    medium: `${base}-800${jpgExt}`,
    large: `${base}-1200${jpgExt}`,
    original: `${base}${jpgExt}`,
  };
}

/**
 * Hook para generar las URLs de las versiones de imagen.
 * √ötil si necesitas las URLs directamente sin renderizar el componente.
 */
export function useImageVersions(src: string) {
  return generateImageVersions(src);
}


========== FILE: ./components/PagoResult.tsx ==========
// src/pages/PagoResult.tsx
import { useMemo, useState } from "react";
import { useLocation, Link } from "react-router-dom";

type Kind = "success" | "pending" | "failure";

export default function PagoResult({ kind }: { kind: Kind }) {
  const q = new URLSearchParams(useLocation().search);
  const paymentId  = q.get("payment_id") || q.get("collection_id") || "-";
  const status     = q.get("status") || q.get("collection_status") || kind;
  const preference = q.get("preference_id") || "-";
  const orderId    = q.get("merchant_order_id") || "-";

  const [showDetails, setShowDetails] = useState(false);

  const title = useMemo(() => {
    if (kind === "success") return "¬°Pago aprobado!";
    if (kind === "pending") return "Pago pendiente";
    return "No pudimos procesar el pago";
  }, [kind]);

  const subtitle = useMemo(() => {
    if (kind === "success") {
      return "Tu pago se aprob√≥ correctamente. En minutos confirmamos tu turno por WhatsApp.";
    }
    if (kind === "pending") {
      return "Tu pago qued√≥ en revisi√≥n. Cuando se apruebe, te confirmamos el turno por WhatsApp.";
    }
    return "Pod√©s intentar nuevamente. Si el problema persiste, escribinos por WhatsApp.";
  }, [kind]);

  return (
    <div className="max-w-xl mx-auto p-6">
      <h1 className="text-2xl font-semibold mb-2">{title}</h1>
      <p className="text-slate-700 mb-4">{subtitle}</p>

      {/* Acciones principales para el cliente */}
      <div className="mt-4 flex flex-wrap gap-2">
        <Link to="/" className="rounded-lg border px-4 py-2">
          Volver al inicio
        </Link>
      </div>

      {/* Detalles t√©cnicos (opcional) */}
      <div className="mt-6">
        <button
          className="text-sm text-slate-600 underline"
          onClick={() => setShowDetails((v) => !v)}
        >
          {showDetails ? "Ocultar detalles" : "Ver detalles de la operaci√≥n"}
        </button>

        {showDetails && (
          <div className="mt-2 rounded-lg border p-3 text-sm space-y-1 bg-white">
            <div>
              <span className="text-slate-500">Estado:</span> <b>{status}</b>
            </div>
            <div>
              <span className="text-slate-500">Payment ID:</span> {paymentId}
            </div>
            <div>
              <span className="text-slate-500">Preference:</span> {preference}
            </div>
            <div>
              <span className="text-slate-500">Order:</span> {orderId}
            </div>
            <p className="text-xs text-slate-500 pt-2">
              Nota: el turno se confirma autom√°ticamente por un webhook de Mercado Pago.
              Si no lo ves de inmediato, puede tardar unos minutos.
            </p>
          </div>
        )}
      </div>
    </div>
  );
}


========== FILE: ./components/SocialLinks.tsx ==========
// src/components/SocialLinks.tsx
import { Instagram } from "lucide-react";

type Props = { className?: string };

export default function SocialLinks({ className }: Props) {
  return (
    <div className={`flex items-center gap-3 ${className ?? ""}`}>
      {/* Instagram */}
      <a
        href="https://www.instagram.com/peluqueria_croma2/"
        target="_blank"
        rel="noreferrer"
        className="p-2 rounded-lg bg-white/10 text-white hover:bg-white/20"
        aria-label="Instagram"
      >
        <Instagram size={20} />
      </a>

      {/* TikTok */}
      <a
        href="https://www.tiktok.com/@cromados" // <-- Usuario
        target="_blank"
        rel="noreferrer"
        className="p-2 rounded-lg bg-white/10 text-white hover:bg-white/20"
        aria-label="TikTok"
      >
        <img
          src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg"
          alt="TikTok"
          className="h-5 w-5"
          style={{ filter: "invert(1)" }} // lo pone blanco sobre fondo oscuro
        />
      </a>
    </div>
  );
}


========== FILE: ./components/Toast.tsx ==========
// src/components/Toast.tsx
import { createContext, useContext, useState, useCallback } from "react";

type ToastMsg = { id: number; text: string };
const ToastCtx = createContext<{ show: (text: string) => void } | null>(null);

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const [items, setItems] = useState<ToastMsg[]>([]);
  const show = useCallback((text: string) => {
    const id = Date.now();
    setItems((prev) => [...prev, { id, text }]);
    setTimeout(() => setItems((prev) => prev.filter(i => i.id !== id)), 3000);
  }, []);
  return (
    <ToastCtx.Provider value={{ show }}>
      {children}
      <div className="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 space-y-2 w-[90%] max-w-md">
        {items.map(i => (
          <div key={i.id} className="rounded-xl bg-black/90 text-white px-4 py-3 shadow-lg">
            {i.text}
          </div>
        ))}
      </div>
    </ToastCtx.Provider>
  );
}

export function useToast() {
  const ctx = useContext(ToastCtx);
  if (!ctx) throw new Error("useToast debe usarse dentro de <ToastProvider>");
  return ctx.show;
}


========== FILE: ./contexts/AuthContext.tsx ==========
// src/contexts/AuthContext.tsx
import { createContext, useContext, useState, useEffect, useCallback } from 'react';
import type { ReactNode } from 'react';
import * as authApi from '../lib/authApi';

type AuthContextType = {
  isAuthenticated: boolean;
  isLoading: boolean;
  user?: string;
  login: (username: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
};

const AuthContext = createContext<AuthContextType | null>(null);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const [user, setUser] = useState<string | undefined>();

  // ‚úÖ Verificar autenticaci√≥n al montar
  const checkAuth = useCallback(async () => {
  try {
    const result = await authApi.me();

    setIsAuthenticated(result.ok === true);
    setUser(result.user);

    if (!result.ok) {
      authApi.clearAllAuthCookies();
    }
  } catch (err) {
    console.error('[AuthContext] Error verificando auth:', err);
    setIsAuthenticated(false);
    setUser(undefined);
    authApi.clearAllAuthCookies();
  } finally {
    setIsLoading(false);
  }
}, []);

  useEffect(() => {
    checkAuth();
  }, [checkAuth]);

  // ‚úÖ Login delegado a authApi
  async function login(username: string, password: string) {
    try {
      const result = await authApi.login(username, password);
      
      if (result.ok) {
        setIsAuthenticated(true);
      } else {
        throw new Error('Login fall√≥');
      }
    } catch (error) {
      throw error;
    }
  }

  // ‚úÖ Logout delegado a authApi
  async function logout() {
  try {
    // Ejecutar logout (ahora limpia cookies primero)
    await authApi.logout();
  } catch (error) {
    console.error('[AuthContext] Error en logout:', error);
  } finally {
    // ‚úÖ SIEMPRE actualizar estado, incluso si hubo error
    setIsAuthenticated(false);
    setUser(undefined);
  }
}

  return (
    <AuthContext.Provider value={{ isAuthenticated, isLoading, user, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const ctx = useContext(AuthContext);
  if (!ctx) throw new Error('useAuth debe usarse dentro de AuthProvider');
  return ctx;
}

========== FILE: ./hooks/usePageTitle.ts ==========
import { useEffect } from 'react'
import { useLocation } from 'react-router-dom'

const MAP: Record<string, string> = {
  '/': 'Inicio',
  '/turnos': 'Turnos',
  '/barberos': 'Barberos',
  '/nosotros': 'Nosotros',
}

export function usePageTitle(suffix = 'Cromados') {
  const { pathname } = useLocation()
  useEffect(() => {
    const base = MAP[pathname] || 'Cromados'
    document.title = base === 'Cromados' ? base : `${base} ‚Äî ${suffix}`
  }, [pathname, suffix])
}



========== FILE: ./index.css ==========
@tailwind base;
@tailwind components;
@tailwind utilities;


========== FILE: ./lib/adminApi.ts ==========
/**
 * RAW_URL: host base del backend (sin /api).
 */
export const RAW_URL = (import.meta.env.VITE_API_URL || "http://localhost:8080")
  .toString()
  .replace(/\/+$/, "");

export const BASE = `${RAW_URL}/api`;

// ‚¨ÖÔ∏è HELPER CSRF
function getCsrfCookie(): string {
  // Importar desde authApi para usar la l√≥gica con fallback
  const fromCookie = document.cookie
    .split(";")
    .map(s => s.trim())
    .find(x => x.startsWith("CSRF="))
    ?.split("=")[1];
  
  if (fromCookie) return fromCookie;
  
  // Fallback a localStorage
  return localStorage.getItem('_csrf_backup') || '';
}

// ‚¨ÖÔ∏è HEADERS CON CSRF
function authHeaders(): Record<string, string> {
  const csrf = getCsrfCookie();
  return {
    'Content-Type': 'application/json',
    ...(csrf ? { 'X-CSRF-Token': csrf } : {})
  };
}

export async function jsonOrThrow(res: Response) {
  if (!res.ok) {
    let msg = `HTTP ${res.status}`;
    try { msg += ` ‚Äì ${await res.text()}`; } catch {}
    throw new Error(msg);
  }
  const ct = res.headers.get("content-type") || "";
  return ct.includes("application/json") ? res.json() : res.text();
}

function toIsoDate(d: Date) {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

export function resolveUrl(path?: string | null): string {
  if (!path) return "";
  if (/^https?:\/\//i.test(path)) return path;
  if (path.startsWith("/")) return `${RAW_URL}${path}`;
  return `${RAW_URL}/${path}`;
}

export type Page<T> = {
  content: T[];
  totalElements: number;
  totalPages: number;
  number: number;
  size: number;
};

export type SucursalDTO = {
  id?: number;
  nombre: string;
  direccion: string;
  fotoUrl?: string | null;
};

export type BarberoDTO = {
  id?: number;
  nombre: string;
  sucursalId: number;
  fotoUrl?: string | null;
  instagram?: string | null;
  facebook?: string | null;
  telefono?: string | null;
};

export type ServicioDTO = {
  id?: number;
  nombre: string;
  precio: number;
  duracionMin: number;
  descripcion?: string | null;
  sesiones?: number;
  adicional?: boolean; // ‚úÖ NUEVO: Marca si es servicio adicional
};

export type TurnoAdminDTO = {
  id: number;
  clienteNombre: string;
  clienteEmail?: string | null;
  clienteTelefono?: string | null;
  sucursalId: number;
  barberoId: number;
  tipoCorteId: number;
  fecha: string;
  hora: string;
  estado: "PENDIENTE" | "RESERVADO" | "CONFIRMADO" | "CANCELADO" | string;
  pagoConfirmado?: boolean | null;
  barberoNombre?: string;
  servicioNombre?: string;
};

export type HorarioBarberoDTO = {
  diaSemana: number;
  inicio: string;
  fin: string;
};

export type DiaExcepcionalBarberoDTO = {
  id?: number;
  barberoId?: number;
  fecha: string; // YYYY-MM-DD
  inicio: string; // HH:mm
  fin: string; // HH:mm
};

async function getPublic<T>(path: string): Promise<T> {
  const res = await fetch(`${BASE}${path}`);
  return jsonOrThrow(res);
}

export const PublicApi = {
  barberos() {
    return getPublic<any>("/barberos");
  },
  sucursales() {
    return getPublic<SucursalDTO[]>("/sucursales");
  },
  servicios() {
    return getPublic<ServicioDTO[]>("/servicios");
  },
  disponibilidad(barberoId: number, fecha: string) {
    return getPublic<string[]>(`/disponibilidad?barberoId=${barberoId}&fecha=${fecha}`);
  },
};

export const AdminApi = {
  async sucursales(): Promise<SucursalDTO[]> {
    const res = await fetch(`${BASE}/sucursales`);
    return jsonOrThrow(res);
  },
  async serviciosPublic(): Promise<ServicioDTO[]> {
    const res = await fetch(`${BASE}/servicios`);
    return jsonOrThrow(res);
  },

  async listBarberos(page = 0, size = 50, sort = "id,asc"): Promise<Page<BarberoDTO>> {
    const res = await fetch(
      `${RAW_URL}/admin/barberos?page=${page}&size=${size}&sort=${encodeURIComponent(sort)}`,
      { credentials: 'include', headers: authHeaders() }
    );
    return jsonOrThrow(res);
  },
  
  async createBarbero(dto: any): Promise<BarberoDTO> {
    const res = await fetch(`${RAW_URL}/admin/barberos`, {
      method: "POST",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async updateBarbero(id: number, dto: any): Promise<BarberoDTO> {
    const res = await fetch(`${RAW_URL}/admin/barberos/${id}`, {
      method: "PUT",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async deleteBarbero(id: number): Promise<void> {
    const res = await fetch(`${RAW_URL}/admin/barberos/${id}`, { 
      method: "DELETE", 
      credentials: 'include',
      headers: authHeaders()
    });
    if (!res.ok && res.status !== 204) await jsonOrThrow(res);
  },
  
  async uploadBarberoFoto(id: number, file: File): Promise<BarberoDTO> {
    const fd = new FormData(); 
    fd.append("file", file);
    const csrf = getCsrfCookie();
    const res = await fetch(`${RAW_URL}/admin/barberos/${id}/foto`, {
      method: "POST", 
      credentials: 'include',
      headers: csrf ? { 'X-CSRF-Token': csrf } : {},
      body: fd,
    });
    return jsonOrThrow(res);
  },

  async horariosDeBarbero(barberoId: number): Promise<HorarioBarberoDTO[]> {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}`, { 
      credentials: 'include',
      headers: authHeaders()
    });
    return jsonOrThrow(res);
  },
  
  async upsertHorarioBarbero(barberoId: number, diaSemana: number, inicio: string, fin: string) {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/${diaSemana}`, {
      method: "PUT",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify({ inicio, fin }),
    });
    return jsonOrThrow(res);
  },
  
  async deleteHorarioBarbero(barberoId: number, diaSemana: number): Promise<void> {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/${diaSemana}`, {
      method: "DELETE",
      credentials: 'include',
      headers: authHeaders()
    });
    if (!res.ok && res.status !== 204) await jsonOrThrow(res);
  },

  async listDiasExcepcionales(barberoId: number): Promise<DiaExcepcionalBarberoDTO[]> {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/excepcionales`, {
      credentials: 'include',
      headers: authHeaders()
    });
    return jsonOrThrow(res);
  },

  async agregarDiaExcepcional(barberoId: number, fecha: string, inicio: string, fin: string): Promise<DiaExcepcionalBarberoDTO> {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/excepcionales`, {
      method: "POST",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify({ fecha, inicio, fin }),
    });
    return jsonOrThrow(res);
  },

  async eliminarDiaExcepcional(barberoId: number, id: number): Promise<void> {
    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/excepcionales/${id}`, {
      method: "DELETE",
      credentials: 'include',
      headers: authHeaders()
    });
    if (!res.ok && res.status !== 204) await jsonOrThrow(res);
  },

  async listSucursales(page = 0, size = 50, sort = "id,asc"): Promise<Page<SucursalDTO>> {
    const res = await fetch(
      `${RAW_URL}/admin/sucursales?page=${page}&size=${size}&sort=${encodeURIComponent(sort)}`,
      { credentials: 'include', headers: authHeaders() }
    );
    return jsonOrThrow(res);
  },
  
  async createSucursal(dto: any): Promise<SucursalDTO> {
    const res = await fetch(`${RAW_URL}/admin/sucursales`, {
      method: "POST",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async updateSucursal(id: number, dto: any): Promise<SucursalDTO> {
    const res = await fetch(`${RAW_URL}/admin/sucursales/${id}`, {
      method: "PUT",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async deleteSucursal(id: number): Promise<void> {
    const res = await fetch(`${RAW_URL}/admin/sucursales/${id}`, { 
      method: "DELETE", 
      credentials: 'include',
      headers: authHeaders()
    });
    if (!res.ok && res.status !== 204) await jsonOrThrow(res);
  },
  
  async uploadSucursalFoto(id: number, file: File): Promise<SucursalDTO> {
    const fd = new FormData(); 
    fd.append("file", file);
    const csrf = getCsrfCookie();
    const res = await fetch(`${RAW_URL}/admin/sucursales/${id}/foto`, {
      method: "POST", 
      credentials: 'include',
      headers: csrf ? { 'X-CSRF-Token': csrf } : {},
      body: fd,
    });
    return jsonOrThrow(res);
  },

  async listServicios(page = 0, size = 50, sort = "id,asc"): Promise<Page<ServicioDTO>> {
    const res = await fetch(
      `${RAW_URL}/admin/servicios?page=${page}&size=${size}&sort=${encodeURIComponent(sort)}`,
      { credentials: 'include', headers: authHeaders() }
    );
    return jsonOrThrow(res);
  },
  
  async createServicio(dto: any): Promise<ServicioDTO> {
    const res = await fetch(`${RAW_URL}/admin/servicios`, {
      method: "POST",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async updateServicio(id: number, dto: any): Promise<ServicioDTO> {
    const res = await fetch(`${RAW_URL}/admin/servicios/${id}`, {
      method: "PUT",
      credentials: 'include',
      headers: authHeaders(),
      body: JSON.stringify(dto),
    });
    return jsonOrThrow(res);
  },
  
  async toggleServicioActivo(id: number): Promise<ServicioDTO> {
    const res = await fetch(`${RAW_URL}/admin/servicios/${id}/toggle-activo`, {
      method: "PATCH",
      credentials: 'include',
      headers: authHeaders()
    });
    return jsonOrThrow(res);
  },

  async deleteServicio(id: number): Promise<void> {
    const res = await fetch(`${RAW_URL}/admin/servicios/${id}`, {
      method: "DELETE",
      credentials: 'include',
      headers: authHeaders()
    });
    if (!res.ok && res.status !== 204) await jsonOrThrow(res);
  },

  async calcularPagosBarberos(desde: string, hasta: string): Promise<any[]> {
    const url = new URL(`${RAW_URL}/admin/calculadora/pagos`);
    url.searchParams.set('desde', desde);
    url.searchParams.set('hasta', hasta);
    const res = await fetch(url.toString(), {
      method: "GET",
      credentials: 'include',
      headers: authHeaders()
    });
    return jsonOrThrow(res);
  },

  async listTurnos(params: any): Promise<Page<TurnoAdminDTO>> {
    const { desde, hasta, page = 0, size = 20, sort } = params;
    const u = new URL(`${RAW_URL}/admin/turnos`);
    u.searchParams.set("desde", desde);
    u.searchParams.set("hasta", hasta);
    u.searchParams.set("page", String(page));
    u.searchParams.set("size", String(size));
    if (sort) u.searchParams.set("sort", sort); // üîß A√±adir par√°metro sort

    const res = await fetch(u.toString(), { 
      credentials: 'include',
      headers: authHeaders()
    });
    const json = await jsonOrThrow(res);

    const mapped: TurnoAdminDTO[] = (json.items || []).map((t: any) => ({
      id: Number(t.id),
      clienteNombre: t.clienteNombre ?? t.cliente_nombre ?? "",
      clienteEmail: t.clienteEmail ?? t.cliente_email ?? null,
      clienteTelefono: t.clienteTelefono ?? t.cliente_telefono ?? null,
      sucursalId: t.sucursalId ?? t.sucursal_id ?? t.sucursal?.id,
      barberoId: t.barberoId ?? t.barbero_id ?? t.barbero?.id,
      tipoCorteId: t.tipoCorteId ?? t.servicioId ?? t.tipo_corte_id ?? t.tipoCorte?.id,
      fecha: t.fecha,
      hora: t.hora,
      estado: t.estado,
      pagoConfirmado: !!t.pagoConfirmado,
      barberoNombre: t.barberoNombre ?? t.barbero_nombre ?? t.barbero?.nombre,
      servicioNombre: t.servicioNombre ?? t.servicio_nombre ?? t.tipoCorte?.nombre,
      // üÜï Nuevos campos de pago
      montoPagado: t.montoPagado ?? t.monto_pagado ?? null,
      senia: t.senia ?? false,
      montoEfectivo: t.montoEfectivo ?? t.monto_efectivo ?? null,
      // üÜï Adicionales
      adicionales: t.adicionales ?? "",
    }));

    return {
      content: mapped,
      totalElements: json.total ?? 0,
      totalPages: json.pages ?? 1,
      number: json.page ?? page,
      size,
    };
  },

  async proximos(dias = 7, limit = 8): Promise<TurnoAdminDTO[]> {
    const u = new URL(`${RAW_URL}/admin/turnos/proximos`);
    u.searchParams.set("dias", String(dias));
    u.searchParams.set("limit", String(limit));
    const res = await fetch(u.toString(), { 
      credentials: 'include',
      headers: authHeaders()
    });
    const json = await jsonOrThrow(res);
    return (json.items || []).map((t: any) => ({
      id: t.id,
      clienteNombre: t.clienteNombre ?? t.cliente_nombre,
      clienteEmail: t.clienteEmail ?? t.cliente_email ?? null,
      clienteTelefono: t.clienteTelefono ?? t.cliente_telefono ?? null,
      sucursalId: t.sucursalId ?? t.sucursal_id ?? t.sucursal?.id,
      barberoId: t.barberoId ?? t.barbero_id ?? t.barbero?.id,
      tipoCorteId: t.tipoCorteId ?? t.tipo_corte_id ?? t.tipoCorte?.id ?? t.servicio?.id,
      fecha: t.fecha,
      hora: t.hora,
      estado: t.estado,
      pagoConfirmado: t.pagoConfirmado ?? t.pago_confirmado ?? null,
      barberoNombre: t.barberoNombre ?? t.barbero?.nombre,
      tipoCorteNombre: t.servicioNombre ?? t.tipoCorte?.nombre,
      adicionales: t.adicionales ?? "",
    }));
  },

  async countBarberos(): Promise<number> {
    const page = await this.listBarberos(0, 1, "id,asc");
    return page?.totalElements ?? 0;
  },
  
  async countSucursales(): Promise<number> {
    const page = await this.listSucursales(0, 1, "id,asc");
    return page?.totalElements ?? 0;
  },
  
  async countServicios(): Promise<number> {
    const page = await this.listServicios(0, 1, "id,asc");
    return page?.totalElements ?? 0;
  },
  
  async listTurnosRecientes(limit = 5) {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const plus30 = new Date(today);
    plus30.setDate(today.getDate() + 30);

    const page = await this.listTurnos({
      desde: toIsoDate(today),
      hasta: toIsoDate(plus30),
      page: 0,
      size: limit,
    });
    return page?.content ?? [];
  },

  // ‚úÖ NUEVO: √öltimos turnos (ordenados por ID desc, sin filtro de fecha)
  async listUltimosTurnos(limit = 10) {
    const u = new URL(`${RAW_URL}/admin/turnos/ultimos`);
    u.searchParams.set("limit", String(limit));
    const res = await fetch(u.toString(), {
      credentials: 'include',
      headers: authHeaders()
    });
    const json = await jsonOrThrow(res);
    return (json.items || []).map((t: any) => ({
      id: t.id,
      clienteNombre: t.clienteNombre ?? t.cliente_nombre,
      clienteEmail: t.clienteEmail ?? t.cliente_email ?? null,
      clienteTelefono: t.clienteTelefono ?? t.cliente_telefono ?? null,
      sucursalId: t.sucursalId ?? t.sucursal_id ?? t.sucursal?.id,
      barberoId: t.barberoId ?? t.barbero_id ?? t.barbero?.id,
      tipoCorteId: t.tipoCorteId ?? t.tipo_corte_id ?? t.tipoCorte?.id ?? t.servicio?.id,
      fecha: t.fecha,
      hora: t.hora,
      estado: t.estado,
      pagoConfirmado: t.pagoConfirmado ?? t.pago_confirmado ?? null,
      barberoNombre: t.barberoNombre ?? t.barbero?.nombre,
      servicioNombre: t.servicioNombre ?? t.tipoCorte?.nombre,
      montoPagado: t.montoPagado ?? t.monto_pagado ?? null,
      montoEfectivo: t.montoEfectivo ?? t.monto_efectivo ?? null,
    }));
  },

  // ‚úÖ NUEVO: Contar turnos vigentes
  async countTurnosVigentes(): Promise<number> {
    const res = await fetch(`${RAW_URL}/admin/turnos/count-vigentes`, {
      credentials: 'include',
      headers: authHeaders()
    });
    const json = await jsonOrThrow(res);
    return json?.count ?? 0;
  },
};

export default AdminApi;

========== FILE: ./lib/api.ts ==========
// src/lib/api.ts
import axios from "axios";

const API_URL = import.meta.env.VITE_API_URL || "http://localhost:8080";
const API_BASE = import.meta.env.VITE_API_BASE || "/api"; // IMPORTANTE: con barra

export const api = axios.create({
  baseURL: `${API_URL}${API_BASE}`, // => http://localhost:8080/api
  timeout: 15000,
});



========== FILE: ./lib/authApi.ts ==========
// src/lib/authApi.ts
import { RAW_URL } from './adminApi';

// ================== Utilidades de Cookies ==================

/**
 * Lee el valor de una cookie por nombre
 */
export function getCookie(name: string): string | null {
  const cookies = document.cookie.split(';');
  for (const cookie of cookies) {
    const [key, value] = cookie.trim().split('=');
    if (key === name) {
      return decodeURIComponent(value);
    }
  }
  
  // Fallback a localStorage
  const backup = localStorage.getItem(`_${name.toLowerCase()}_backup`);
  if (backup) {
    return backup;
  }

  return null;
}

/**
 * Lee espec√≠ficamente la cookie CSRF
 */
export function getCsrfCookie(): string {
  // Intentar primero desde cookie (ideal)
  const fromCookie = getCookie('CSRF');
  if (fromCookie) return fromCookie;
  
  // Fallback: localStorage (si cookies est√°n bloqueadas)
  const fromStorage = localStorage.getItem('_csrf_backup');
  if (fromStorage) {
    return fromStorage;
  }

  return '';
}

/**
 * Limpia una cookie espec√≠fica (EXCEPTO CSRF hasta despu√©s del logout)
 */
export function clearCookie(name: string): void {
  const configs = [
    `${name}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT`,
    `${name}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax`,
    `${name}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=None; Secure`,
  ];
  
  configs.forEach(config => {
    document.cookie = config;
  });
}

/**
 * Limpia todas las cookies de autenticaci√≥n
 */
export function clearAllAuthCookies(): void {
  const authCookies = ['ACCESS', 'REFRESH', 'CSRF'];
  const domains = [
    '', // dominio actual
    window.location.hostname,
    `.${window.location.hostname}`,
  ];
  const paths = ['/', '/admin', '/auth'];
  
  authCookies.forEach(cookieName => {
    // Estrategia 1: Limpieza simple
    document.cookie = `${cookieName}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT`;
    
    // Estrategia 2: Con SameSite
    document.cookie = `${cookieName}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax`;
    document.cookie = `${cookieName}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=None; Secure`;
    
    // Estrategia 3: M√∫ltiples dominios y paths
    domains.forEach(domain => {
      paths.forEach(path => {
        const domainPart = domain ? `; Domain=${domain}` : '';
        document.cookie = `${cookieName}=; Path=${path}${domainPart}; Expires=Thu, 01 Jan 1970 00:00:00 GMT`;
        document.cookie = `${cookieName}=; Path=${path}${domainPart}; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax`;
        document.cookie = `${cookieName}=; Path=${path}${domainPart}; Expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=None; Secure`;
      });
    });
  });
}

// ================== Endpoints de Autenticaci√≥n ==================

/**
 * Login: autentica usuario y establece cookies
 */
export async function login(user: string, pass: string): Promise<{ ok: boolean }> {
  const url = `${RAW_URL}/auth/login`;
  
  const response = await fetch(url, {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: user, password: pass }),
  });

  if (!response.ok) {
    let errorMsg = 'Credenciales inv√°lidas';
    try {
      const errorData = await response.json();
      errorMsg = errorData.error || errorMsg;
    } catch {
      errorMsg = await response.text().catch(() => errorMsg);
    }
    throw new Error(errorMsg);
  }

  const result = await response.json();

  // ‚úÖ Guardar tokens en localStorage (funciona cross-origin)
  if (result.csrf) {
    localStorage.setItem('_csrf_backup', result.csrf);
  }
  if (result.access) {
    localStorage.setItem('_access_backup', result.access);
  }
  if (result.refresh) {
    localStorage.setItem('_refresh_backup', result.refresh);
  }

  return result;
}


/**
 * Refresh: renueva el access token usando el refresh token
 */
export async function refresh(): Promise<boolean> {
  const csrf = getCsrfCookie();
  
  if (!csrf) {
    return false;
  }

  const url = `${RAW_URL}/auth/refresh`;
  
  try {
    const response = await fetch(url, {
      method: "POST",
      credentials: "include",
      headers: { 
        "Content-Type": "application/json",
        "X-CSRF-Token": csrf 
      },
    });

    return response.ok;
  } catch (error) {
    return false;
  }
}

/**
 * Me: verifica si el usuario est√° autenticado
 */
export async function me(): Promise<{ ok: boolean; user?: string; roles?: string[] }> {
  const url = `${RAW_URL}/auth/me`;
  
  try {
    const response = await fetch(url, { 
      credentials: "include",
      headers: { "Content-Type": "application/json" }
    });

    if (!response.ok) {
      return { ok: false };
    }

    return response.json();
  } catch (error) {
    return { ok: false };
  }
}

/**
 * Logout: cierra sesi√≥n y limpia cookies
 * IMPORTANTE: Guarda CSRF antes de limpiar para poder hacer el request
 */
export async function logout(): Promise<void> {
  // ‚úÖ 1. PRIMERO limpiar localmente (no esperar al servidor)
  clearAllAuthCookies();

  // ‚úÖ 2. Intentar notificar al servidor (best effort)
  const csrf = getCsrfCookie();
  const url = `${RAW_URL}/auth/logout`;

  // No esperamos ni manejamos errores - es opcional
  fetch(url, {
    method: "POST",
    credentials: "include",
    headers: {
      "Content-Type": "application/json",
      ...(csrf ? { "X-CSRF-Token": csrf } : {})
    }
  }).catch(() => {
    // Ignorar errores de logout del servidor
  });
}
/**
 * Obtiene cookie CSRF del servidor (para cliente p√∫blico)
 */
export async function ensureCsrf(baseUrl?: string): Promise<void> {
  const root = baseUrl ? baseUrl.replace(/\/+$/, "") : RAW_URL;
  const url = `${root}/auth/csrf`;

  try {
    const response = await fetch(url, {
      method: "GET",
      credentials: "include"
    });

    if (response.ok) {
      // Intentar leer el token de la respuesta JSON
      try {
        const data = await response.json();
        if (data.csrf) {
          // Guardar en localStorage como backup (para mobile con cookies bloqueadas)
          localStorage.setItem('_csrf_backup', data.csrf);
        }
      } catch {
        // Si no hay JSON, el token debe estar en la cookie
      }
    }
  } catch (error) {
    console.warn('[ensureCsrf] Error obteniendo CSRF:', error);
  }
}

// ================== Verificaci√≥n de Estado ==================

/**
 * Verifica si hay tokens de sesi√≥n presentes
 */
export function hasAuthTokens(): boolean {
  const access = getCookie('ACCESS');
  const refresh = getCookie('REFRESH');
  return !!(access || refresh);
}

/**
 * Verifica si la sesi√≥n parece v√°lida (tiene tokens)
 */
export function isLikelyAuthenticated(): boolean {
  return hasAuthTokens();
}

// ================== Export por defecto ==================

export default {
  login,
  logout,
  refresh,
  me,
  ensureCsrf,
  getCsrfCookie,
  getCookie,
  clearCookie,
  clearAllAuthCookies,
  hasAuthTokens,
  isLikelyAuthenticated,
};

========== FILE: ./lib/config.ts ==========
// frontend/src/lib/config.ts
// Defaults seguros para dev si no hay envs definidas
const DEF_API_URL = 'http://localhost:8080'
const DEF_API_BASE = 'api'

export const API_URL  = (import.meta.env.VITE_API_URL  || DEF_API_URL).replace(/\/+$/, '')
export const API_BASE = (import.meta.env.VITE_API_BASE || DEF_API_BASE).replace(/\/+$/, '')

/** Construye URL: http://host[:port][/base]/ruta  */
export function apiUrl(path: string) {
  const clean = path.startsWith('/') ? path : `/${path}`
  const base  = API_BASE ? `/${API_BASE.replace(/^\//, '')}` : ''
  return `${API_URL}${base}${clean}`
}



========== FILE: ./lib/endpoints.ts ==========
import { apiUrl } from './config'

export const endpoints = {
  sucursales: () => apiUrl('/sucursales'),
  barberos:   (sucursalId: string|number) => apiUrl(`/barberos?sucursalId=${sucursalId}`),
  servicios:  () => apiUrl('/servicios'),
  disponibilidad: (barberoId: string|number, fecha: string) =>
    apiUrl(`/disponibilidad?barberoId=${barberoId}&fecha=${fecha}`),
  reservas:   () => apiUrl('/reservas'),
  reservaById:(id: string|number) => apiUrl(`/reservas/${id}`),
  checkout:   () => apiUrl('/pagos/checkout'),
}



========== FILE: ./lib/http.ts ==========
async function handle<T>(res: Response): Promise<T> {
  if (!res.ok) {
    const text = await res.text().catch(() => '')
    throw new Error(`HTTP ${res.status} ${res.statusText}${text ? ` ‚Äî ${text}` : ''}`)
  }
  // 204 No Content
  if (res.status === 204) return undefined as T
  const ct = res.headers.get('content-type') || ''
  if (ct.includes('application/json')) return (await res.json()) as T
  // fallback
  return (await res.text()) as unknown as T
}

export async function GET<T>(path: string, init?: RequestInit) {
  const res = await fetch(path, { method: 'GET', ...init })
  return handle<T>(res)
}
export async function POST<T>(path: string, body: unknown, init?: RequestInit) {
  const res = await fetch(path, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', ...(init?.headers || {}) },
    body: JSON.stringify(body),
    ...init,
  })
  return handle<T>(res)
}



========== FILE: ./main.tsx ==========
// src/main.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import App from './App'
import './index.css'
import { ToastProvider } from './components/Toast'
import { AuthProvider } from './contexts/AuthContext'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <ToastProvider>
          <App />
        </ToastProvider>
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>,
)

========== FILE: ./pages/admin/AdminApp.tsx ==========
// src/pages/admin/AdminApp.tsx
import { Routes, Route, Navigate } from "react-router-dom";
import { useAuth } from "../../contexts/AuthContext";
import AdminLayout from "./AdminLayout";
import Dashboard from "./Dashboard";
import BarberosAdmin from "./BarberosAdmin";
import SucursalesAdmin from "./SucursalesAdmin";
import ServiciosAdmin from "./ServiciosAdmin";
import HorariosBarberoAdmin from "./HorariosBarberoAdmin";
import TurnosAdmin from "./TurnosAdmin";
import CalculadoraPagos from "./CalculadoraPagos";
import LoginAdmin from "./LoginAdmin";

export default function AdminApp() {
  const { isAuthenticated, isLoading } = useAuth();

  if (isLoading) {
    return (
      <div className="min-h-screen grid place-items-center">
        <div className="text-center">
          <div className="text-lg font-semibold">Cargando...</div>
        </div>
      </div>
    );
  }

  if (!isAuthenticated) {
    return <LoginAdmin />;
  }

  return (
    <Routes>
      <Route element={<AdminLayout />}>
        <Route index element={<Dashboard />} />
        <Route path="barberos" element={<BarberosAdmin />} />
        <Route path="sucursales" element={<SucursalesAdmin />} />
        <Route path="servicios" element={<ServiciosAdmin />} />
        <Route path="horarios" element={<HorariosBarberoAdmin />} />
        <Route path="turnos" element={<TurnosAdmin />} />
        <Route path="calculadora" element={<CalculadoraPagos />} />
      </Route>
      <Route path="*" element={<Navigate to="/admin" replace />} />
    </Routes>
  );
}

========== FILE: ./pages/admin/AdminLayout.tsx ==========
// src/pages/admin/AdminLayout.tsx
import { useState } from "react";
import { Link, NavLink, Outlet } from "react-router-dom";
import { useAuth } from "../../contexts/AuthContext";

export default function AdminLayout() {
  const [open, setOpen] = useState(false);
  const { logout } = useAuth();

  const linkClass = ({ isActive }: { isActive: boolean }) =>
    `group flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-all ${
      isActive
        ? "bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 text-white shadow-lg shadow-fuchsia-500/30"
        : "text-slate-700 hover:bg-slate-100 hover:text-slate-900"
    }`;

  async function handleLogout() {
    try {
      await logout();
    } catch (error) {
      console.error('[AdminLayout] Error en logout:', error);
    } finally {
      window.location.href = '/admin';
    }
  }

  const menuItems = [
    { to: "/admin", label: "Panel", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>, end: true },
    { to: "/admin/barberos", label: "Barberos", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg> },
    { to: "/admin/horarios", label: "Horarios", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> },
    { to: "/admin/sucursales", label: "Sucursales", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg> },
    { to: "/admin/servicios", label: "Servicios", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" /></svg> },
    { to: "/admin/turnos", label: "Turnos", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg> },
    { to: "/admin/calculadora", label: "Calculadora", icon: <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg> },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100">
      {/* Header */}
      <header className="sticky top-0 z-40 border-b bg-white/80 backdrop-blur-xl shadow-sm">
        <div className="mx-auto max-w-7xl h-16 px-4 sm:px-6 flex items-center justify-between">
          {/* Hamburguesa mobile - solo icono */}
          <button
            className="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg border border-slate-200 hover:bg-slate-50 transition-colors"
            onClick={() => setOpen(true)}
            aria-label="Abrir men√∫"
          >
            <svg className="w-5 h-5" viewBox="0 0 20 20" fill="none">
              <path d="M3 6h14M3 10h14M3 14h14" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
            </svg>
          </button>

          {/* Logo */}
          <Link to="/admin" className="flex items-center gap-2">
            <div className="w-11 h-11 flex items-center justify-center">
              <img
                src="/logo-cromados.png"
                alt="Cromados"
                className="w-full h-full object-contain"
                style={{ filter: 'brightness(0) saturate(100%)' }}
              />
            </div>
            <span className="font-semibold text-lg bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent hidden sm:inline">Cromados Admin</span>
          </Link>

          {/* Logout desktop - texto completo */}
          <button
            onClick={handleLogout}
            className="hidden md:inline-flex items-center gap-2 text-sm text-slate-600 hover:text-slate-900 px-4 py-2 rounded-lg hover:bg-slate-100 transition-colors"
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
            Cerrar sesi√≥n
          </button>

          {/* Logout mobile - solo icono */}
          <button
            onClick={handleLogout}
            className="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg border border-slate-200 hover:bg-red-50 hover:border-red-200 hover:text-red-600 transition-colors"
            aria-label="Cerrar sesi√≥n"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
          </button>
        </div>
      </header>

      {/* Men√∫ m√≥vil mejorado */}
      {open && (
        <div className="md:hidden fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setOpen(false)} />
          <aside className="absolute inset-y-0 left-0 w-80 bg-white shadow-2xl p-4 overflow-y-auto">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-2">
                <div className="w-11 h-11 flex items-center justify-center">
                  <img
                    src="/logo-cromados.png"
                    alt="Cromados"
                    className="w-full h-full object-contain"
                    style={{ filter: 'brightness(0) saturate(100%)' }}
                  />
                </div>
                <span className="font-bold text-lg bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent">Cromados</span>
              </div>
              <button
                onClick={() => setOpen(false)}
                className="rounded-lg border border-slate-200 p-2 hover:bg-slate-50 transition-colors"
                aria-label="Cerrar men√∫"
              >
                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <nav className="space-y-2">
              {menuItems.map((item) => (
                <NavLink
                  key={item.to}
                  to={item.to}
                  className={linkClass}
                  onClick={() => setOpen(false)}
                  end={item.end}
                >
                  {item.icon}
                  <span>{item.label}</span>
                </NavLink>
              ))}
            </nav>
          </aside>
        </div>
      )}

      <div className="mx-auto max-w-7xl">
        <div className="grid grid-cols-1 md:grid-cols-[260px_1fr] gap-6 p-4 sm:p-6">
          {/* Sidebar desktop mejorado */}
          <aside className="hidden md:block">
            <div className="sticky top-24 space-y-2 bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 p-4">
              <nav className="space-y-1">
                {menuItems.map((item) => (
                  <NavLink
                    key={item.to}
                    to={item.to}
                    className={linkClass}
                    end={item.end}
                  >
                    {item.icon}
                    <span>{item.label}</span>
                  </NavLink>
                ))}
              </nav>
            </div>
          </aside>

          {/* Main content */}
          <main className="min-w-0">
            <Outlet />
          </main>
        </div>
      </div>
    </div>
  );
}


========== FILE: ./pages/admin/BarberosAdmin.tsx ==========
import { useEffect, useMemo, useState } from "react";
import { AdminApi, type BarberoDTO, type SucursalDTO, resolveUrl} from "../../lib/adminApi";
import { useNavigate } from "react-router-dom";

type Mode =
  | { kind: "idle" }
  | { kind: "create" }
  | { kind: "edit"; id: number; currentFotoUrl?: string | null };

const EMPTY: BarberoDTO & { telefono?: string } & { telegramChatId?: string } = {
  nombre: "",
  sucursalId: 0,
  instagram: "",
  facebook: "",
  telefono: "",
  telegramChatId: "",
};

export default function BarberosAdmin() {
  const [rows, setRows] = useState<(BarberoDTO & { telefono?: string } & { telegramChatId?: string })[]>([]);
  const [sucursales, setSucursales] = useState<SucursalDTO[]>([]);
  const [mode, setMode] = useState<Mode>({ kind: "idle" });
  const [form, setForm] = useState<BarberoDTO & { telefono?: string } & { telegramChatId?: string }>({ ...EMPTY });
  const [file, setFile] = useState<File | null>(null);
  const [preview, setPreview] = useState<string | null>(null);

  const [loading, setLoading] = useState(false);
  const [loadingTable, setLoadingTable] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  const navigate = useNavigate();

  const loadAll = async () => {
    setLoadingTable(true);
    setError(null);
    try {
      const [barPage, sucs] = await Promise.all([
        AdminApi.listBarberos(0, 200, "id,asc"),
        AdminApi.sucursales(),
      ]);
      const list = Array.isArray(barPage?.content) ? (barPage.content as (BarberoDTO & { telefono?: string })[]): [];
      setRows(list);
      setSucursales(Array.isArray(sucs) ? sucs : []);
    } catch (e: any) {
      setError(e?.message || "Error cargando barberos");
      setRows([]);
    } finally {
      setLoadingTable(false);
    }
  };

  useEffect(() => {
    loadAll();
    return () => {
      if (preview) URL.revokeObjectURL(preview);
    };
  }, []);

  const canSave = useMemo(
    () => form.nombre.trim() !== "" && Number(form.sucursalId) > 0,
    [form]
  );

  const onSelectFile = (f: File | null) => {
    setFile(f);
    if (preview) URL.revokeObjectURL(preview);
    setPreview(f ? URL.createObjectURL(f) : null);
  };

  const resetForm = () => {
    setForm({ ...EMPTY });
    onSelectFile(null);
    setMode({ kind: "idle" });
  };

  const startCreate = () => {
    setForm({ ...EMPTY });
    onSelectFile(null);
    setMode({ kind: "create" });
  };

  const startEdit = (b: BarberoDTO & { telefono?: string } & { telegramChatId?: string }) => {
    setForm({
      id: b.id,
      nombre: b.nombre || "",
      sucursalId: b.sucursalId || 0,
      instagram: b.instagram || "",
      facebook: b.facebook || "",
      telefono: (b as any).telefono || "",
      fotoUrl: b.fotoUrl || "",
      telegramChatId: String(b.telegramChatId || ""),
    });
    onSelectFile(null);
    setPreview(null);
    setMode({ kind: "edit", id: Number(b.id), currentFotoUrl: b.fotoUrl || null });
  };

  const normalizePhone = (s?: string) =>
    (s ?? "").replace(/\s+/g, " ").trim();

  const save = async () => {
    if (!canSave) return;
    setLoading(true);
    setError(null);
    try {
      const telefono = normalizePhone(form.telefono);
      
      // ‚úÖ Preparar payload correctamente
      const chatIdRaw = form.telegramChatId?.trim();
      const chatIdNumber = chatIdRaw && /^\d+$/.test(chatIdRaw) 
        ? Number(chatIdRaw) 
        : null;

      const payload = {
        nombre: form.nombre,
        sucursalId: Number(form.sucursalId),
        instagram: form.instagram || "",
        facebook: form.facebook || "",
        telefono: telefono || "",
        telegramChatId: chatIdNumber
      };

      console.log('[BarberosAdmin] Guardando con payload:', payload);

      let saved: BarberoDTO;

      if (mode.kind === "edit" && mode.id) {
        saved = await AdminApi.updateBarbero(mode.id, payload as any);
      } else {
        saved = await AdminApi.createBarbero(payload as any);
      }

      if (file && saved?.id) {
        await AdminApi.uploadBarberoFoto(Number(saved.id), file);
      }

      resetForm();
      await loadAll();
    } catch (e: any) {
      console.error('[BarberosAdmin] Error:', e);
      setError(e?.message || "Error guardando barbero");
    } finally {
      setLoading(false);
    }
  };

  const del = async (id?: number) => {
    if (!id) return;
    if (!confirm("¬øEliminar barbero?")) return;
    setLoading(true);
    setError(null);
    try {
      await AdminApi.deleteBarbero(id);
      await loadAll();
    } catch (e: any) {
      setError(e?.message || "Error eliminando barbero");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-4 sm:space-y-6">
      {/* Header responsive */}
      <header className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <div>
          <h1 className="text-xl sm:text-2xl font-semibold">Barberos</h1>
          <p className="text-sm sm:text-base text-slate-600">Alta, edici√≥n, foto y baja.</p>
        </div>
        {mode.kind === "idle" && (
          <button
            onClick={startCreate}
            className="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2.5 text-white font-medium shadow-md hover:shadow-lg hover:from-fuchsia-700 hover:to-fuchsia-800 transition-all"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
            Nuevo barbero
          </button>
        )}
      </header>

      {error && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {error}
        </div>
      )}

      {/* Formulario responsive */}
      {mode.kind !== "idle" && (
        <div className="rounded-2xl border border-slate-200 bg-white p-3 sm:p-4 shadow-sm">
          <div className="grid gap-3 grid-cols-1 sm:grid-cols-2">
            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Nombre</span>
              <input
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.nombre}
                onChange={(e) => setForm({ ...form, nombre: e.target.value })}
              />
            </label>

            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Sucursal</span>
              <select
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.sucursalId || 0}
                onChange={(e) =>
                  setForm({ ...form, sucursalId: Number(e.target.value) })
                }
              >
                <option value={0}>Seleccionar‚Ä¶</option>
                {sucursales.map((s) => (
                  <option key={s.id} value={s.id}>
                    {s.nombre}
                  </option>
                ))}
              </select>
            </label>

            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Tel√©fono (WhatsApp)</span>
              <input
                type="tel"
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.telefono ?? ""}
                onChange={(e) => setForm({ ...form, telefono: e.target.value })}
                placeholder="+54 9 351 123 4567"
              />
              <span className="text-xs text-slate-500">
                Formato internacional (E.164), ej. +549351...
              </span>
            </label>

            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Telegram Chat ID</span>
              <input
                type="text"
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.telegramChatId || ""}
                onChange={(e) => {
                  // Solo permitir d√≠gitos
                  const val = e.target.value.replace(/\D/g, "");
                  setForm({ ...form, telegramChatId: val });
                }}
                placeholder="123456789"
              />
              <span className="text-xs text-slate-500">
                ID num√©rico del chat (enviar /start al bot)
              </span>
            </label>

            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Instagram (opcional)</span>
              <input
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.instagram || ""}
                onChange={(e) =>
                  setForm({ ...form, instagram: e.target.value })
                }
                placeholder="@usuario"
              />
            </label>
            
            <label className="grid gap-1">
              <span className="text-sm text-slate-600">Facebook (opcional)</span>
              <input
                className="border rounded-xl px-3 py-2 text-sm sm:text-base"
                value={form.facebook || ""}
                onChange={(e) =>
                  setForm({ ...form, facebook: e.target.value })
                }
              />
            </label>
            <label className="grid gap-2 sm:col-span-2">
              <span className="text-sm font-medium text-slate-700">Foto (.jpg/.png) ‚Äî opcional</span>
              <input
                type="file"
                accept="image/*"
                onChange={(e) => onSelectFile(e.target.files?.[0] || null)}
                className="block w-full text-sm text-slate-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-fuchsia-50 file:text-fuchsia-700 hover:file:bg-fuchsia-100 cursor-pointer"
              />

              {(() => {
                const fotoSrc =
                  preview ??
                  (mode.kind === "edit" && mode.currentFotoUrl
                    ? resolveUrl(mode.currentFotoUrl)
                    : null);

                if (!fotoSrc) return null;

                return (
                  <div className="mt-2">
                    <img
                      src={fotoSrc}
                      alt="preview"
                      className="h-24 w-24 sm:h-32 sm:w-32 object-cover rounded-xl border"
                    />
                  </div>
                );
              })()}
            </label>
          </div>

          <div className="mt-4 flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
            <button
              onClick={save}
              disabled={!canSave || loading}
              className="rounded-xl bg-fuchsia-600 px-4 py-2 text-white disabled:bg-slate-300 text-sm sm:text-base"
            >
              {mode.kind === "edit" ? "Guardar cambios" : "Crear"}
            </button>
            <button
              onClick={resetForm}
              className="rounded-xl border border-slate-300 px-4 py-2 text-sm sm:text-base"
            >
              Cancelar
            </button>
          </div>
        </div>
      )}

      {/* Tabla responsive */}
      <div className="rounded-2xl border border-slate-200 bg-white shadow-sm">
        {/* Vista m√≥vil: cards */}
        <div className="block md:hidden">
          {loadingTable && (
            <div className="p-4 text-slate-500 text-sm">Cargando‚Ä¶</div>
          )}
          
          {!loadingTable && rows.map((b) => (
            <div key={b.id} className="border-b last:border-b-0 p-3">
              <div className="flex items-start gap-3">
                {b.fotoUrl ? (
                  <img
                    src={resolveUrl(b.fotoUrl)!}
                    alt={b.nombre}
                    className="h-16 w-16 object-cover rounded-full border shrink-0"
                  />
                ) : (
                  <div className="h-16 w-16 rounded-full bg-slate-200 grid place-items-center text-xs text-slate-600 shrink-0">
                    Sin foto
                  </div>
                )}
                
                <div className="flex-1 min-w-0">
                  <div className="font-medium truncate">{b.nombre}</div>
                  <div className="text-xs text-slate-500">
                    {sucursales.find((s) => s.id === b.sucursalId)?.nombre || "-"}
                  </div>
                  {(b as any).telefono && (
                    <div className="text-xs text-slate-500 mt-1">
                      üì± {(b as any).telefono}
                    </div>
                  )}
                  {b.telegramChatId && (
                    <div className="text-xs text-slate-500">
                      üí¨ {b.telegramChatId}
                    </div>
                  )}
                  
                  <div className="flex flex-wrap gap-2 mt-2">
                    <button
                      className="rounded-lg border px-2 py-1 text-xs"
                      onClick={() => startEdit(b)}
                    >
                      Editar
                    </button>
                    <button
                      className="rounded-lg border px-2 py-1 text-xs"
                      onClick={() => navigate(`/admin/horarios?barberoId=${Number(b.id)}`)}
                    >
                      Horarios
                    </button>
                    <button
                      className="rounded-lg border px-2 py-1 text-xs text-red-600 border-red-300"
                      onClick={() => del(Number(b.id))}
                    >
                      Eliminar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {!loadingTable && rows.length === 0 && (
            <div className="p-4 text-slate-500 text-sm">Sin barberos.</div>
          )}
        </div>

        {/* Vista desktop: tabla */}
        <div className="hidden md:block overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="text-slate-600">
              <tr>
                <th className="px-4 py-2 text-left">ID</th>
                <th className="px-4 py-2 text-left">Foto</th>
                <th className="px-4 py-2 text-left">Nombre</th>
                <th className="px-4 py-2 text-left">Sucursal</th>
                <th className="px-4 py-2 text-left">Tel√©fono</th>
                <th className="px-4 py-2 text-left">Telegram</th>
                <th className="px-4 py-2"></th>
              </tr>
            </thead>
            <tbody>
              {loadingTable && (
                <tr>
                  <td colSpan={7} className="px-4 py-4 text-slate-500">
                    Cargando‚Ä¶
                  </td>
                </tr>
              )}

              {!loadingTable && rows.map((b) => (
                <tr key={b.id} className="border-t border-slate-200">
                  <td className="px-4 py-2">{b.id}</td>
                  <td className="px-4 py-2">
                    {b.fotoUrl ? (
                      <img
                        src={resolveUrl(b.fotoUrl)!}
                        alt={b.nombre}
                        className="h-12 w-12 object-cover rounded-full border"
                      />
                    ) : (
                      <div className="h-12 w-12 rounded-full bg-slate-200 grid place-items-center text-xs text-slate-600">
                        Sin foto
                      </div>
                    )}
                  </td>
                  <td className="px-4 py-2">{b.nombre}</td>
                  <td className="px-4 py-2">
                    {sucursales.find((s) => s.id === b.sucursalId)?.nombre || "-"}
                  </td>
                  <td className="px-4 py-2">{(b as any).telefono ?? "‚Äì"}</td>
                  <td className="px-4 py-2">{b.telegramChatId || "‚Äì"}</td>
                  <td className="px-4 py-2 text-right space-x-2">
                    <button
                      className="rounded-xl border px-3 py-1"
                      onClick={() => startEdit(b)}
                    >
                      Editar
                    </button>
                    <button
                      className="rounded-xl border px-3 py-1"
                      onClick={() => navigate(`/admin/horarios?barberoId=${Number(b.id)}`)}
                    >
                      Horarios
                    </button>
                    <button
                      className="rounded-xl border px-3 py-1 text-red-600 border-red-300"
                      onClick={() => del(Number(b.id))}
                    >
                      Eliminar
                    </button>
                  </td>
                </tr>
              ))}

              {!loadingTable && rows.length === 0 && (
                <tr>
                  <td colSpan={7} className="px-4 py-4 text-slate-500">
                    Sin barberos.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

========== FILE: ./pages/admin/CalculadoraPagos.tsx ==========
import { useState } from "react";
import AdminApi from "../../lib/adminApi";

type PagoBarbero = {
  barberoId: number;
  barberoNombre: string;
  cantidadTurnos: number;

  // MONTOS BRUTOS (informativos - c√≥mo pagaron los clientes)
  montoAppBruto: number;           // Total que entr√≥ por Mercado Pago
  montoTransferenciaBruto: number; // Total que entr√≥ por transferencia al alias del negocio
  montoEfectivoBruto: number;      // Total que entr√≥ en efectivo a caja
  totalBruto: number;              // Suma de todos los montos brutos

  // C√ÅLCULO PARA EL BARBERO
  comision50: number;              // 50% del total bruto (lo que le corresponde)
  cantidadBonos: number;           // Cantidad de bonos ganados (1 por cada 10 turnos/d√≠a)
  montoBonus: number;              // Monto del bonus (cantidadBonos * 50% precio id=1)
  totalAPagar: number;             // comision50 + montoBonus

  detalleServicios: DetalleServicio[];
  bonosPorDia: Record<string, number>; // Detalle de bonos por d√≠a (para mostrar en UI)
};

type DetalleServicio = {
  servicioNombre: string;
  cantidad: number;
  precioUnitario: number;
  subtotal: number;
};

export default function CalculadoraPagos() {
  const [desde, setDesde] = useState("");
  const [hasta, setHasta] = useState("");
  const [pagos, setPagos] = useState<PagoBarbero[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Calcular semana actual (lunes a domingo)
  const setSemanActual = () => {
    const hoy = new Date();
    const diaSemana = hoy.getDay(); // 0=domingo, 1=lunes, ..., 6=s√°bado

    // Calcular lunes de esta semana
    const lunes = new Date(hoy);
    const diffToMonday = diaSemana === 0 ? -6 : 1 - diaSemana; // Si es domingo, retroceder 6 d√≠as
    lunes.setDate(hoy.getDate() + diffToMonday);

    // Calcular domingo de esta semana
    const domingo = new Date(lunes);
    domingo.setDate(lunes.getDate() + 6);

    setDesde(lunes.toISOString().split('T')[0]);
    setHasta(domingo.toISOString().split('T')[0]);
  };

  // Calcular semana pasada
  const setSemanaAnterior = () => {
    const hoy = new Date();
    const diaSemana = hoy.getDay();

    // Calcular lunes de esta semana
    const lunesEstaSemana = new Date(hoy);
    const diffToMonday = diaSemana === 0 ? -6 : 1 - diaSemana;
    lunesEstaSemana.setDate(hoy.getDate() + diffToMonday);

    // Retroceder 7 d√≠as para lunes de semana pasada
    const lunesPasado = new Date(lunesEstaSemana);
    lunesPasado.setDate(lunesEstaSemana.getDate() - 7);

    // Domingo de semana pasada
    const domingoPasado = new Date(lunesPasado);
    domingoPasado.setDate(lunesPasado.getDate() + 6);

    setDesde(lunesPasado.toISOString().split('T')[0]);
    setHasta(domingoPasado.toISOString().split('T')[0]);
  };

  // Calcular solo hoy
  const setHoy = () => {
    const hoy = new Date();
    const fechaHoy = hoy.toISOString().split('T')[0];
    setDesde(fechaHoy);
    setHasta(fechaHoy);
  };

  const calcular = async () => {
    if (!desde || !hasta) {
      setError("Debe seleccionar ambas fechas");
      return;
    }

    setLoading(true);
    setError(null);
    setPagos([]);

    try {
      const resultado = await AdminApi.calcularPagosBarberos(desde, hasta);
      setPagos(resultado);

      if (resultado.length === 0) {
        setError("No se encontraron turnos confirmados en el rango seleccionado");
      }
    } catch (e: any) {
      setError(e?.message || "Error calculando pagos");
    } finally {
      setLoading(false);
    }
  };

  const formatCurrency = (value: number) => {
    return new Intl.NumberFormat('es-AR', {
      style: 'currency',
      currency: 'ARS',
      minimumFractionDigits: 0
    }).format(value);
  };

  const totalGeneral = pagos.reduce((sum, p) => sum + p.totalAPagar, 0);

  return (
    <div className="space-y-6">
      <header>
        <h1 className="text-2xl font-semibold">Calculadora de Pagos</h1>
        <p className="text-slate-600">Calcula cu√°nto pagar a cada barbero por per√≠odo.</p>
      </header>

      {/* Selector de fechas */}
      <div className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <div className="grid md:grid-cols-5 gap-4 items-end">
          <div>
            <label className="block text-sm font-medium mb-1">Desde</label>
            <input
              type="date"
              value={desde}
              onChange={(e) => setDesde(e.target.value)}
              className="w-full rounded-lg border px-3 py-2"
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-1">Hasta</label>
            <input
              type="date"
              value={hasta}
              onChange={(e) => setHasta(e.target.value)}
              className="w-full rounded-lg border px-3 py-2"
            />
          </div>
          <button
            onClick={setHoy}
            className="rounded-lg border border-fuchsia-300 bg-fuchsia-50 px-3 py-2 text-sm text-fuchsia-700 hover:bg-fuchsia-100 transition"
          >
            Hoy
          </button>
          <div className="flex gap-2">
            <button
              onClick={setSemanaAnterior}
              className="flex-1 rounded-lg border border-fuchsia-300 bg-fuchsia-50 px-3 py-2 text-sm text-fuchsia-700 hover:bg-fuchsia-100 transition"
            >
              Semana pasada
            </button>
            <button
              onClick={setSemanActual}
              className="flex-1 rounded-lg border border-fuchsia-300 bg-fuchsia-50 px-3 py-2 text-sm text-fuchsia-700 hover:bg-fuchsia-100 transition"
            >
              Semana actual
            </button>
          </div>
          <button
            onClick={calcular}
            disabled={!desde || !hasta || loading}
            className="rounded-lg bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2.5 text-white font-medium shadow-md hover:shadow-lg disabled:opacity-40 transition"
          >
            {loading ? "Calculando..." : "Calcular"}
          </button>
        </div>
      </div>

      {error && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-red-700">
          {error}
        </div>
      )}

      {/* Resultados */}
      {pagos.length > 0 && (
        <div className="space-y-4">
          {/* Total general */}
          <div className="rounded-2xl border-2 border-fuchsia-200 bg-gradient-to-br from-fuchsia-50 to-fuchsia-100 p-6">
            <div className="text-center">
              <div className="text-sm text-fuchsia-600 font-medium mb-1">Total General</div>
              <div className="text-4xl font-bold text-fuchsia-900">{formatCurrency(totalGeneral)}</div>
              <div className="text-sm text-fuchsia-600 mt-2">
                {pagos.reduce((sum, p) => sum + p.cantidadTurnos, 0)} turnos ‚Ä¢ {pagos.length} barbero(s)
              </div>
            </div>
          </div>

          {/* Detalle por barbero */}
          {pagos.map((pago) => (
            <div key={pago.barberoId} className="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
              {/* Header del barbero */}
              <div className="bg-gradient-to-r from-slate-50 to-slate-100 px-6 py-4 border-b">
                <div className="flex items-center justify-between">
                  <div>
                    <h3 className="text-lg font-semibold text-slate-900">{pago.barberoNombre}</h3>
                    <p className="text-sm text-slate-600">{pago.cantidadTurnos} turno(s)</p>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-fuchsia-600">{formatCurrency(pago.totalAPagar)}</div>
                    <div className="text-xs text-slate-500">Total a pagar</div>
                  </div>
                </div>
              </div>

              {/* Ingresos brutos informativos */}
              <div className="px-6 py-4 bg-slate-50 border-b">
                <h4 className="text-sm font-semibold text-slate-700 mb-3">Ingresos brutos por medio de pago (informativos)</h4>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                  <div className="bg-white rounded-lg border border-amber-200 p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <svg className="w-4 h-4 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                      <span className="text-xs font-medium text-slate-600">APP</span>
                    </div>
                    <div className="text-lg font-bold text-amber-600">{formatCurrency(pago.montoAppBruto)}</div>
                    <div className="text-xs text-slate-500">Mercado Pago</div>
                  </div>
                  <div className="bg-white rounded-lg border border-blue-200 p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <svg className="w-4 h-4 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                      </svg>
                      <span className="text-xs font-medium text-slate-600">Transferencia</span>
                    </div>
                    <div className="text-lg font-bold text-blue-600">{formatCurrency(pago.montoTransferenciaBruto)}</div>
                    <div className="text-xs text-slate-500">Al alias del negocio</div>
                  </div>
                  <div className="bg-white rounded-lg border border-green-200 p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <svg className="w-4 h-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                      <span className="text-xs font-medium text-slate-600">Efectivo</span>
                    </div>
                    <div className="text-lg font-bold text-green-600">{formatCurrency(pago.montoEfectivoBruto)}</div>
                    <div className="text-xs text-slate-500">A caja</div>
                  </div>
                  <div className="bg-gradient-to-br from-slate-100 to-slate-200 rounded-lg border border-slate-300 p-3">
                    <div className="flex items-center gap-2 mb-1">
                      <svg className="w-4 h-4 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                      </svg>
                      <span className="text-xs font-medium text-slate-700">Total Bruto</span>
                    </div>
                    <div className="text-lg font-bold text-slate-900">{formatCurrency(pago.totalBruto)}</div>
                    <div className="text-xs text-slate-600">Suma de todos</div>
                  </div>
                </div>
              </div>

              {/* C√°lculo de comisi√≥n */}
              <div className="px-6 py-4 bg-fuchsia-50 border-b">
                <div className="flex items-center justify-between">
                  <div>
                    <h4 className="text-sm font-semibold text-fuchsia-900 mb-1">Comisi√≥n del barbero (50%)</h4>
                    <p className="text-xs text-fuchsia-600">
                      {formatCurrency(pago.totalBruto)} √ó 50% = {formatCurrency(pago.comision50)}
                    </p>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-fuchsia-600">{formatCurrency(pago.comision50)}</div>
                  </div>
                </div>
              </div>

              {/* Bonus por volumen */}
              {pago.cantidadBonos > 0 && (
                <div className="px-6 py-4 bg-gradient-to-r from-purple-50 to-pink-50 border-b">
                  <div className="flex items-center justify-between mb-3">
                    <div>
                      <div className="flex items-center gap-2 mb-1">
                        <svg className="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h4 className="text-sm font-semibold text-purple-700">Bonus por volumen diario</h4>
                      </div>
                      <p className="text-xs text-purple-600">
                        {pago.cantidadBonos} bono{pago.cantidadBonos > 1 ? 's' : ''} ganado{pago.cantidadBonos > 1 ? 's' : ''} (1 por cada 10 turnos/d√≠a)
                      </p>
                    </div>
                    <div className="text-right">
                      <div className="text-2xl font-bold text-purple-600">+{formatCurrency(pago.montoBonus)}</div>
                      <div className="text-xs text-purple-500">50% √ó corte id=1</div>
                    </div>
                  </div>
                  {/* Detalle de bonos por d√≠a */}
                  {pago.bonosPorDia && Object.keys(pago.bonosPorDia).length > 0 && (
                    <div className="mt-3 pt-3 border-t border-purple-200">
                      <p className="text-xs font-medium text-purple-700 mb-2">Detalle por d√≠a:</p>
                      <div className="flex flex-wrap gap-2">
                        {Object.entries(pago.bonosPorDia).map(([fecha, cantidad]) => (
                          <div key={fecha} className="bg-white rounded-lg border border-purple-200 px-3 py-1.5">
                            <span className="text-xs font-medium text-purple-900">{fecha}</span>
                            <span className="text-xs text-purple-600 ml-2">‚Üí {cantidad} bono{cantidad > 1 ? 's' : ''}</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Detalle de servicios */}
              <div className="p-6">
                <h4 className="text-sm font-semibold text-slate-700 mb-3">Detalle por servicio</h4>
                <div className="space-y-2">
                  {pago.detalleServicios.map((detalle, idx) => (
                    <div key={idx} className="flex items-center justify-between py-2 border-b last:border-b-0">
                      <div className="flex-1">
                        <div className="font-medium text-slate-900">{detalle.servicioNombre}</div>
                        <div className="text-xs text-slate-500">
                          {detalle.cantidad} √ó {formatCurrency(detalle.precioUnitario)}
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="font-semibold text-slate-900">{formatCurrency(detalle.subtotal)}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* Estado vac√≠o */}
      {!loading && pagos.length === 0 && !error && (
        <div className="rounded-2xl border border-slate-200 bg-white p-12 text-center">
          <svg className="w-16 h-16 text-slate-300 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
          <p className="text-slate-500 mb-1">Selecciona un rango de fechas</p>
          <p className="text-sm text-slate-400">y haz clic en "Calcular" para ver los resultados</p>
        </div>
      )}
    </div>
  );
}


========== FILE: ./pages/admin/Dashboard.tsx ==========
// src/pages/admin/Dashboard.tsx
import { useEffect, useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { AdminApi, PublicApi } from "../../lib/adminApi";

type TurnoAdminDTO = {
  id: number;
  clienteNombre: string;
  clienteEmail?: string | null;
  clienteTelefono?: string | null;
  sucursalId: number;
  barberoId: number;
  tipoCorteId: number;
  fecha: string; // yyyy-MM-dd
  hora: string;  // HH:mm
  estado: "PENDIENTE" | "RESERVADO" | "CONFIRMADO" | "CANCELADO" | "BLOQUEADO" | string;
  pagoConfirmado?: boolean | null;
  barberoNombre?: string;
  servicioNombre?: string;
  montoPagado?: number;
  montoEfectivo?: number;
};

export default function Dashboard() {
  const navigate = useNavigate();

  const [totalSucursales, setTotalSucursales] = useState(0);
  const [totalBarberos, setTotalBarberos] = useState(0);
  const [turnosVigentes, setTurnosVigentes] = useState(0);
  const [turnosRecientes, setTurnosRecientes] = useState<TurnoAdminDTO[]>([]);
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(true);
  const [barberoName, setBarberoName] = useState<Record<number, string>>({});
  const [tipoCorteName, setTipoCorteName] = useState<Record<number, string>>({});

  useEffect(() => {
    let mounted = true;
    (async () => {
      setLoading(true);
      setError(null);
      try {
        const [suc, barPage, turnos, countVigentes, barberos, servicios] = await Promise.all([
          AdminApi.sucursales().catch(() => []),
          AdminApi.listBarberos(0, 1).catch(() => ({ content: [], totalElements: 0 } as any)),
          AdminApi.listUltimosTurnos(10).catch(() => [] as TurnoAdminDTO[]),
          AdminApi.countTurnosVigentes().catch(() => 0),
          PublicApi.barberos().catch(() => []),
          PublicApi.servicios().catch(() => []),
        ]);

        if (!mounted) return;
        setTotalSucursales(Array.isArray(suc) ? suc.length : 0);

        const totalB =
          typeof (barPage as any)?.totalElements === "number"
            ? (barPage as any).totalElements
            : Array.isArray((barPage as any)?.content)
            ? (barPage as any).content.length
            : 0;
        setTotalBarberos(totalB);
        setTurnosVigentes(countVigentes);

        // Mapear barberos
        const bmap: Record<number, string> = {};
        (Array.isArray(barberos) ? barberos : []).forEach((b: any) => {
          if (b?.id != null) bmap[Number(b.id)] = String(b.nombre || `#${b.id}`);
        });
        setBarberoName(bmap);

        // Mapear servicios
        const smap: Record<number, string> = {};
        (Array.isArray(servicios) ? servicios : []).forEach((s: any) => {
          if (s?.id != null) smap[Number(s.id)] = String(s.nombre || `#${s.id}`);
        });
        setTipoCorteName(smap);

        setTurnosRecientes(Array.isArray(turnos) ? turnos : []);
      } catch (e: any) {
        if (!mounted) return;
        setError(e?.message || "Error cargando dashboard");
      } finally {
        if (mounted) setLoading(false);
      }
    })();
    return () => {
      mounted = false;
    };
  }, []);

  const getEstadoBadge = (estado: string, pagoConfirmado?: boolean | null) => {
    if (estado === "BLOQUEADO") {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">
          üîí Bloqueado
        </span>
      );
    }
    if (pagoConfirmado) {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
          ‚úì Confirmado
        </span>
      );
    }
    return (
      <span className="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">
        Pendiente
      </span>
    );
  };

  return (
    <div className="space-y-6 lg:space-y-8">
      {/* Header - Responsive */}
      <header className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl lg:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 bg-clip-text text-transparent">
            Panel de Administraci√≥n
          </h1>
          <p className="text-slate-600 text-sm lg:text-base mt-1">Resumen general y accesos r√°pidos</p>
        </div>
        <Link
          to="/"
          className="inline-flex items-center justify-center rounded-xl border border-slate-300 px-4 py-2 text-sm font-medium hover:bg-slate-50 transition-colors"
        >
          <svg className="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Ver sitio
        </Link>
      </header>

      {/* Accesos r√°pidos - Responsive */}
      <section className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
        <button
          onClick={() => navigate("/admin/barberos?new=1")}
          className="group rounded-2xl border border-slate-200 p-5 text-left hover:border-fuchsia-300 hover:shadow-md transition-all bg-white"
        >
          <div className="flex items-center justify-between mb-3">
            <div className="w-10 h-10 rounded-xl bg-fuchsia-100 flex items-center justify-center group-hover:bg-fuchsia-200 transition-colors">
              <svg className="w-5 h-5 text-fuchsia-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <span className="text-xs font-medium text-fuchsia-600 bg-fuchsia-50 px-2 py-1 rounded-full">Acceso r√°pido</span>
          </div>
          <div className="text-lg font-semibold text-slate-900 mb-1">Nuevo barbero</div>
          <div className="text-slate-500 text-sm">Agregar un nuevo barbero al sistema</div>
        </button>

        <button
          onClick={() => navigate("/admin/servicios?new=1")}
          className="group rounded-2xl border border-slate-200 p-5 text-left hover:border-purple-300 hover:shadow-md transition-all bg-white"
        >
          <div className="flex items-center justify-between mb-3">
            <div className="w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center group-hover:bg-purple-200 transition-colors">
              <svg className="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" />
              </svg>
            </div>
            <span className="text-xs font-medium text-purple-600 bg-purple-50 px-2 py-1 rounded-full">Acceso r√°pido</span>
          </div>
          <div className="text-lg font-semibold text-slate-900 mb-1">Nuevo servicio</div>
          <div className="text-slate-500 text-sm">Crear un tipo de corte o servicio</div>
        </button>

        <button
          onClick={() => navigate("/admin/sucursales?new=1")}
          className="group rounded-2xl border border-slate-200 p-5 text-left hover:border-blue-300 hover:shadow-md transition-all bg-white"
        >
          <div className="flex items-center justify-between mb-3">
            <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center group-hover:bg-blue-200 transition-colors">
              <svg className="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
            </div>
            <span className="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded-full">Acceso r√°pido</span>
          </div>
          <div className="text-lg font-semibold text-slate-900 mb-1">Nueva sucursal</div>
          <div className="text-slate-500 text-sm">Registrar una nueva ubicaci√≥n</div>
        </button>

        <button
          onClick={() => navigate("/admin/calculadora")}
          className="group rounded-2xl border border-slate-200 p-5 text-left hover:border-emerald-300 hover:shadow-md transition-all bg-white sm:col-span-2 lg:col-span-1"
        >
          <div className="flex items-center justify-between mb-3">
            <div className="w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-200 transition-colors">
              <svg className="w-5 h-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
            </div>
            <span className="text-xs font-medium text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full">Herramienta</span>
          </div>
          <div className="text-lg font-semibold text-slate-900 mb-1">Calculadora de Pagos</div>
          <div className="text-slate-500 text-sm">Calcular pagos semanales a barberos</div>
        </button>
      </section>

      {/* M√©tricas - Responsive */}
      <section className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <div className="rounded-2xl border border-slate-200 p-6 bg-gradient-to-br from-white to-slate-50 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between mb-4">
            <div className="text-slate-500 text-sm font-medium">Sucursales</div>
            <div className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center">
              <svg className="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
            </div>
          </div>
          <div className="text-3xl lg:text-4xl font-bold text-slate-900 mb-3">{totalSucursales}</div>
          <Link to="/admin/sucursales" className="inline-flex items-center text-blue-600 text-sm font-medium hover:text-blue-700 transition-colors">
            Ver sucursales
            <svg className="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </Link>
        </div>

        <div className="rounded-2xl border border-slate-200 p-6 bg-gradient-to-br from-white to-slate-50 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between mb-4">
            <div className="text-slate-500 text-sm font-medium">Barberos</div>
            <div className="w-10 h-10 rounded-xl bg-fuchsia-100 flex items-center justify-center">
              <svg className="w-5 h-5 text-fuchsia-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
          </div>
          <div className="text-3xl lg:text-4xl font-bold text-slate-900 mb-3">{totalBarberos}</div>
          <Link to="/admin/barberos" className="inline-flex items-center text-fuchsia-600 text-sm font-medium hover:text-fuchsia-700 transition-colors">
            Ver barberos
            <svg className="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </Link>
        </div>

        <div className="rounded-2xl border border-slate-200 p-6 bg-gradient-to-br from-white to-slate-50 hover:shadow-md transition-shadow sm:col-span-2 lg:col-span-1">
          <div className="flex items-center justify-between mb-4">
            <div className="text-slate-500 text-sm font-medium">Turnos vigentes</div>
            <div className="w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center">
              <svg className="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
          </div>
          <div className="text-3xl lg:text-4xl font-bold text-slate-900 mb-3">
            {turnosVigentes}
          </div>
          <Link to="/admin/turnos" className="inline-flex items-center text-green-600 text-sm font-medium hover:text-green-700 transition-colors">
            Ver todos los turnos
            <svg className="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </Link>
        </div>
      </section>

      {/* √öltimos turnos - Mejorado y Responsive */}
      <section className="rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden">
        <div className="px-4 sm:px-6 py-4 border-b bg-gradient-to-r from-slate-50 to-white flex items-center justify-between">
          <div>
            <h2 className="text-lg font-semibold text-slate-900">√öltimos 10 Turnos</h2>
            <p className="text-sm text-slate-500 mt-0.5">Turnos confirmados y bloqueados m√°s recientes (ordenados por ID)</p>
          </div>
          <Link
            to="/admin/turnos"
            className="hidden sm:inline-flex items-center text-sm font-medium text-fuchsia-600 hover:text-fuchsia-700"
          >
            Ver todos
            <svg className="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </Link>
        </div>

        {error && (
          <div className="px-4 sm:px-6 py-3 bg-red-50 border-b border-red-200">
            <p className="text-sm text-red-700">{error}</p>
          </div>
        )}

        {loading && (
          <div className="px-4 sm:px-6 py-12 text-center">
            <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 mb-3">
              <svg className="animate-spin w-6 h-6 text-slate-600" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>
            <p className="text-slate-500">Cargando turnos...</p>
          </div>
        )}

        {!loading && Array.isArray(turnosRecientes) && turnosRecientes.length === 0 && (
          <div className="px-4 sm:px-6 py-12 text-center">
            <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 mb-3">
              <svg className="w-6 h-6 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <p className="text-slate-500">No hay turnos recientes</p>
          </div>
        )}

        {/* Tabla desktop - hidden en mobile */}
        {!loading && turnosRecientes.length > 0 && (
          <div className="hidden lg:block overflow-x-auto">
            <table className="min-w-full text-sm">
              <thead className="bg-slate-50 border-b border-slate-200">
                <tr>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">ID</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Cliente</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Barbero</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Servicio</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Fecha</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Hora</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Monto</th>
                  <th className="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Estado</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {turnosRecientes.map((t) => {
                  const horaDisplay = t.hora === "00:00:00" || t.hora === "00:00" ? "FH" : t.hora.slice(0, 5);
                  const monto = t.montoPagado || t.montoEfectivo || 0;

                  return (
                    <tr key={t.id} className="hover:bg-slate-50 transition-colors">
                      <td className="px-4 py-3">
                        <span className="font-mono text-xs font-semibold text-slate-900">#{t.id}</span>
                      </td>
                      <td className="px-4 py-3">
                        <div className="font-medium text-slate-900">{t.clienteNombre}</div>
                        {t.clienteTelefono && (
                          <div className="text-xs text-slate-500">{t.clienteTelefono}</div>
                        )}
                      </td>
                      <td className="px-4 py-3 text-slate-700">
                        {t.barberoNombre || barberoName[t.barberoId] || `#${t.barberoId}`}
                      </td>
                      <td className="px-4 py-3 text-slate-700">
                        {t.servicioNombre || tipoCorteName[t.tipoCorteId] || `#${t.tipoCorteId}`}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap text-slate-700">
                        {new Date(t.fecha).toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit' })}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {horaDisplay === "FH" ? (
                          <span className="inline-flex items-center rounded-full bg-purple-100 px-2 py-1 text-xs font-medium text-purple-800">
                            FH
                          </span>
                        ) : (
                          <span className="text-slate-700">{horaDisplay}</span>
                        )}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {monto > 0 ? (
                          <span className="font-semibold text-slate-900">${monto}</span>
                        ) : (
                          <span className="text-slate-400">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 whitespace-nowrap">
                        {getEstadoBadge(t.estado, t.pagoConfirmado)}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        )}

        {/* Cards mobile/tablet */}
        {!loading && turnosRecientes.length > 0 && (
          <div className="lg:hidden divide-y divide-slate-100">
            {turnosRecientes.map((t) => {
              const horaDisplay = t.hora === "00:00:00" || t.hora === "00:00" ? "FH" : t.hora.slice(0, 5);
              const monto = t.montoPagado || t.montoEfectivo || 0;

              return (
                <div key={t.id} className="p-4 hover:bg-slate-50 transition-colors">
                  <div className="flex items-start justify-between mb-3">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-mono text-xs font-semibold text-slate-500">#{t.id}</span>
                        {getEstadoBadge(t.estado, t.pagoConfirmado)}
                      </div>
                      <div className="font-semibold text-slate-900 mb-1">{t.clienteNombre}</div>
                      {t.clienteTelefono && (
                        <div className="text-sm text-slate-500">{t.clienteTelefono}</div>
                      )}
                    </div>
                    {monto > 0 && (
                      <div className="text-right">
                        <div className="text-lg font-bold text-slate-900">${monto}</div>
                        <div className="text-xs text-slate-500">Monto</div>
                      </div>
                    )}
                  </div>

                  <div className="grid grid-cols-2 gap-3 text-sm">
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Barbero</div>
                      <div className="font-medium text-slate-700">
                        {t.barberoNombre || barberoName[t.barberoId] || `#${t.barberoId}`}
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Servicio</div>
                      <div className="font-medium text-slate-700">
                        {t.servicioNombre || tipoCorteName[t.tipoCorteId] || `#${t.tipoCorteId}`}
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Fecha</div>
                      <div className="font-medium text-slate-700">
                        {new Date(t.fecha).toLocaleDateString('es-AR', {
                          day: '2-digit',
                          month: 'short',
                          year: 'numeric'
                        })}
                      </div>
                    </div>
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Hora</div>
                      <div className="font-medium text-slate-700">
                        {horaDisplay === "FH" ? (
                          <span className="inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-xs font-medium text-purple-800">
                            FH
                          </span>
                        ) : (
                          horaDisplay
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

        {/* Link m√≥vil */}
        {!loading && turnosRecientes.length > 0 && (
          <div className="lg:hidden border-t border-slate-200 bg-slate-50">
            <Link
              to="/admin/turnos"
              className="flex items-center justify-center px-4 py-3 text-sm font-medium text-fuchsia-600 hover:text-fuchsia-700"
            >
              Ver todos los turnos
              <svg className="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
              </svg>
            </Link>
          </div>
        )}
      </section>
    </div>
  );
}


========== FILE: ./pages/admin/HorariosBarberoAdmin.tsx ==========
import { useEffect, useMemo, useState } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import { AdminApi, type BarberoDTO, type Page, type DiaExcepcionalBarberoDTO } from "../../lib/adminApi";
import { useToast } from "../../components/Toast";
import { RAW_URL } from "../../lib/adminApi";
import CustomSelect from "../../components/CustomSelect";
import { ensureCsrf, getCsrfCookie } from "../../lib/authApi";


type Horario = { diaSemana: number; inicio: string; fin: string };

const DIAS: { n: number; label: string }[] = [
  { n: 1, label: "Lunes" },
  { n: 2, label: "Martes" },
  { n: 3, label: "Mi√©rcoles" },
  { n: 4, label: "Jueves" },
  { n: 5, label: "Viernes" },
  { n: 6, label: "S√°bado" },
  { n: 7, label: "Domingo" },
];

// HH:mm cada 30 minutos
const TIMES_30 = (() => {
  const out: string[] = [];
  for (let h = 0; h < 24; h++) {
    for (let m = 0; m < 60; m += 30) {
      out.push(`${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`);
    }
  }
  return out;
})();

// Opciones para CustomSelect
const TIME_OPTIONS = TIMES_30.map((t) => ({ value: t, label: t }));

export default function HorariosBarberoAdmin() {
  const toast = useToast();
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  const initialId = Number(searchParams.get("barberoId") || 0) || null;
  
  const [dirty, setDirty] = useState<Record<number, boolean>>({
  1:false, 2:false, 3:false, 4:false, 5:false, 6:false, 7:false
  });

  const [barberos, setBarberos] = useState<BarberoDTO[]>([]);
  const [barberoId, setBarberoId] = useState<number | null>(initialId);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Mapa de horarios en edici√≥n (por d√≠a)
  const [rows, setRows] = useState<Record<number, Horario | null>>({
    1: null, 2: null, 3: null, 4: null, 5: null, 6: null, 7: null,
  });

  const [rowsExtra, setRowsExtra] = useState<Record<number, Horario | null>>({
  1: null, 2: null, 3: null, 4: null, 5: null, 6: null, 7: null,
});

  // Estado para d√≠as excepcionales
  const [diasExcepcionales, setDiasExcepcionales] = useState<DiaExcepcionalBarberoDTO[]>([]);
  const [nuevoDiaExcepcional, setNuevoDiaExcepcional] = useState({
    fecha: "",
    inicio1: "09:00",
    fin1: "13:00",
    inicio2: "",
    fin2: "",
  });
  const [editandoFecha, setEditandoFecha] = useState<string | null>(null);

  const selected = useMemo(
    () => barberos.find((b) => Number(b.id) === Number(barberoId)) || null,
    [barberos, barberoId]
  );

  useEffect(() => {
    (async () => {
      try {
        setLoading(true);
        // Obtener CSRF token primero
        await ensureCsrf(RAW_URL);

        const page = (await AdminApi.listBarberos(0, 100, "nombre,asc")) as Page<BarberoDTO>;
        const list = Array.isArray(page?.content) ? page.content : [];
        setBarberos(list);
        setError(null);
      } catch (e: any) {
        setError(e?.message || "Error cargando barberos");
        toast("No se pudieron cargar barberos.");
      } finally {
        setLoading(false);
      }
    })();
  }, [toast]);

  useEffect(() => {
    (async () => {
      setSearchParams((prev) => {
        const sp = new URLSearchParams(prev);
        if (barberoId) sp.set("barberoId", String(barberoId));
        else sp.delete("barberoId");
        return sp;
      });

      if (!barberoId) {
        setRows({ 1: null,2: null,3: null,4: null,5: null,6: null,7: null });
        return;
      }

      try {
        setLoading(true);
        const hs = await AdminApi.horariosDeBarbero(barberoId);
        // normalizo por d√≠a y ordeno por inicio para decidir T1/T2
        const m1: Record<number, Horario | null> = { 1:null,2:null,3:null,4:null,5:null,6:null,7:null };
        const m2: Record<number, Horario | null> = { 1:null,2:null,3:null,4:null,5:null,6:null,7:null };

        (hs || [])
          .sort((a: any, b: any) => String(a.inicio).localeCompare(String(b.inicio)))
          .forEach((h: any) => {
            const d = Number(h.diaSemana);
            if (!m1[d]) m1[d] = { diaSemana: d, inicio: h.inicio, fin: h.fin };
            else if (!m2[d]) m2[d] = { diaSemana: d, inicio: h.inicio, fin: h.fin };
            // si vinieran m√°s de 2, las ignoramos visualmente
          });

        setRows(m1);
        setRowsExtra(m2);

        // Cargar d√≠as excepcionales
        const excepcionales = await AdminApi.listDiasExcepcionales(barberoId);
        setDiasExcepcionales(excepcionales || []);

        setError(null);
      } catch (e: any) {
        setError(e?.message || "Error cargando horarios");
        toast("No se pudieron cargar horarios.");
      } finally {
        setLoading(false);
      }
    })();
  }, [barberoId, setSearchParams, toast]);

  const setValue = (dia: number, field: "inicio" | "fin", v: string) => {
    setRows((prev) => {
      const cur = prev[dia];
      const base: Horario = cur ? { ...cur } : { diaSemana: dia, inicio: "09:00", fin: "18:00" };
      (base as any)[field] = v;
      return { ...prev, [dia]: base };
    });
    setDirty((d) => ({ ...d, [dia]: true }));
  };

  const setValueExtra = (dia: number, field: "inicio" | "fin", v: string) => {
    setRowsExtra((prev) => {
      const cur = prev[dia];
      const base: Horario = cur ? { ...cur } : { diaSemana: dia, inicio: "14:00", fin: "20:00" };
      (base as any)[field] = v;
      return { ...prev, [dia]: base };
    });
    setDirty((d) => ({ ...d, [dia]: true }));
  };


  const cerrarDia = async (dia: number) => {
    if (!barberoId) return;
    try {
      setLoading(true);
      // Asegurar token CSRF fresco antes de DELETE
      await ensureCsrf(RAW_URL);
      await AdminApi.deleteHorarioBarbero(barberoId, dia);
      setRowsExtra((r) => ({ ...r, [dia]: null }));
      setRows((r) => ({ ...r, [dia]: null }));
      toast("D√≠a cerrado.");
      setDirty((d) => ({ ...d, [dia]: false }));
    } catch (e: any) {
      toast(e?.message || "Error cerrando d√≠a.");
    } finally {
      setLoading(false);
    }
  };

  const guardarDia = async (dia: number) => {
    if (!barberoId) return;
    const h1 = rows[dia];      // franja 1 (ma√±ana/√∫nica)
    const h2 = rowsExtra[dia]; // franja 2 (tarde, opcional)

    let h1m = h1;
    let h2m = h2;

    // Si el usuario solo carg√≥ T2, traemos T1 del server para no borrarlo sin querer
    if ((!h1m || !h1m.inicio || !h1m.fin) && (h2m?.inicio && h2m?.fin)) {
      const hsServer = await AdminApi.horariosDeBarbero(barberoId);
      const delDia = (hsServer || [])
        .filter((h: any) => Number(h.diaSemana) === dia)
        .sort((a: any, b: any) => String(a.inicio).localeCompare(String(b.inicio)));
      if (delDia[0]) {
        h1m = { diaSemana: dia, inicio: delDia[0].inicio, fin: delDia[0].fin };
      }
    }

    // (opcionalmente tambi√©n preservamos T2 si ya exist√≠a y el usuario solo toc√≥ T1)
    if ((h1m?.inicio && h1m?.fin) && (!h2m || !h2m.inicio || !h2m.fin)) {
      const hsServer = await AdminApi.horariosDeBarbero(barberoId);
      const delDia = (hsServer || [])
        .filter((h: any) => Number(h.diaSemana) === dia)
        .sort((a: any, b: any) => String(a.inicio).localeCompare(String(b.inicio)));
      if (delDia[1]) {
        h2m = { diaSemana: dia, inicio: delDia[1].inicio, fin: delDia[1].fin };
      }
    }

    const payload: Record<string, string> = {};
    if (h1m?.inicio && h1m?.fin) {
      payload.inicio1 = h1m.inicio;
      payload.fin1    = h1m.fin;
      payload.inicio  = h1m.inicio; // compat
      payload.fin     = h1m.fin;    // compat
    }
    if (h2m?.inicio && h2m?.fin) {
      payload.inicio2 = h2m.inicio;
      payload.fin2    = h2m.fin;
    }

    // ‚úÖ UN solo PUT que el backend ahora entiende (T1+T2)
    // Asegurar que tengamos un token CSRF fresco
    await ensureCsrf(RAW_URL);
    const csrf = getCsrfCookie();

    const res = await fetch(`${RAW_URL}/admin/horarios-barbero/${barberoId}/${dia}`, {
      method: "PUT",
      credentials: 'include', // ‚¨ÖÔ∏è Importante para enviar cookies JWT
      headers: {
        "Content-Type": "application/json",
        ...(csrf ? { "X-CSRF-Token": csrf } : {})
      },
      body: JSON.stringify(payload),
    });

    if (!res.ok) {
      const msg = await res.text();
      // Si es 409, mostramos el mensaje del server y recargamos el d√≠a
      if (res.status === 409) {
        try {
          const json = JSON.parse(msg);
          toast(json?.message || "No se pudo guardar por registros relacionados.");
        } catch {
          toast("No se pudo guardar por registros relacionados.");
        }
        // recarga la data del d√≠a para revertir lo que qued√≥ en UI
        try {
          const hs = await AdminApi.horariosDeBarbero(barberoId);
          const m1: Record<number, Horario | null> = { 1:null,2:null,3:null,4:null,5:null,6:null,7:null };
          const m2: Record<number, Horario | null> = { 1:null,2:null,3:null,4:null,5:null,6:null,7:null };
          (hs || [])
            .sort((a: any, b: any) => String(a.inicio).localeCompare(String(b.inicio)))
            .forEach((h: any) => {
              const dnum = Number(h.diaSemana);
              if (!m1[dnum]) m1[dnum] = { diaSemana: dnum, inicio: h.inicio, fin: h.fin };
              else if (!m2[dnum]) m2[dnum] = { diaSemana: dnum, inicio: h.inicio, fin: h.fin };
            });
          setRows(m1);
          setRowsExtra(m2);
          setDirty((d) => ({ ...d, [dia]: false }));
        } catch {
          // silencioso
        }
        return;
      }

      // otros errores
      throw new Error(msg);
    }

    toast("Horario guardado.");

    // refrescar desde server para ver lo realmente persistido
    try {
      const hs = await AdminApi.horariosDeBarbero(barberoId);
      const m1: Record<number, Horario | null> = {1:null,2:null,3:null,4:null,5:null,6:null,7:null};
      const m2: Record<number, Horario | null> = {1:null,2:null,3:null,4:null,5:null,6:null,7:null};
      (hs || [])
        .sort((a: any, b: any) => String(a.inicio).localeCompare(String(b.inicio)))
        .forEach((h: any) => {
          const dnum = Number(h.diaSemana);
          if (!m1[dnum]) m1[dnum] = { diaSemana: dnum, inicio: h.inicio, fin: h.fin };
          else if (!m2[dnum]) m2[dnum] = { diaSemana: dnum, inicio: h.inicio, fin: h.fin };
        });
      setRows(m1);
      setRowsExtra(m2);
    } catch {/* silencioso */}

    setDirty((d) => ({ ...d, [dia]: false }));
  };

  const cargarDiaExcepcionalParaEditar = (fecha: string, franjas: DiaExcepcionalBarberoDTO[]) => {
    const franjasOrdenadas = franjas.sort((a, b) => a.inicio.localeCompare(b.inicio));
    const t1 = franjasOrdenadas[0];
    const t2 = franjasOrdenadas[1];

    setNuevoDiaExcepcional({
      fecha: fecha,
      inicio1: t1?.inicio || "09:00",
      fin1: t1?.fin || "13:00",
      inicio2: t2?.inicio || "",
      fin2: t2?.fin || "",
    });
    setEditandoFecha(fecha);

    // Scroll al formulario
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  };

  const agregarDiaExcepcional = async () => {
    if (!barberoId) return;

    const { fecha, inicio1, fin1, inicio2, fin2 } = nuevoDiaExcepcional;

    if (!fecha || !inicio1 || !fin1) {
      toast("Complet√° fecha, inicio y fin de T1");
      return;
    }

    try {
      setLoading(true);
      await ensureCsrf(RAW_URL);

      // Si estamos editando, primero eliminamos las franjas existentes
      if (editandoFecha) {
        const franjasAEliminar = diasExcepcionales.filter(d => d.fecha === editandoFecha);
        for (const franja of franjasAEliminar) {
          if (franja.id) {
            await AdminApi.eliminarDiaExcepcional(barberoId, franja.id);
          }
        }
      }

      // Agregar T1
      await AdminApi.agregarDiaExcepcional(barberoId, fecha, inicio1, fin1);

      // Agregar T2 si est√° completo
      if (inicio2 && fin2) {
        await AdminApi.agregarDiaExcepcional(barberoId, fecha, inicio2, fin2);
      }

      // Recargar lista
      const excepcionales = await AdminApi.listDiasExcepcionales(barberoId);
      setDiasExcepcionales(excepcionales || []);

      // Limpiar formulario
      setNuevoDiaExcepcional({
        fecha: "",
        inicio1: "09:00",
        fin1: "13:00",
        inicio2: "",
        fin2: "",
      });
      setEditandoFecha(null);

      toast(editandoFecha ? "D√≠a excepcional actualizado." : "D√≠a excepcional agregado.");
    } catch (e: any) {
      toast(e?.message || "Error guardando d√≠a excepcional.");
    } finally {
      setLoading(false);
    }
  };

  const cancelarEdicion = () => {
    setNuevoDiaExcepcional({
      fecha: "",
      inicio1: "09:00",
      fin1: "13:00",
      inicio2: "",
      fin2: "",
    });
    setEditandoFecha(null);
  };

  const eliminarDiaExcepcional = async (id: number) => {
    if (!barberoId) return;

    try {
      setLoading(true);
      await ensureCsrf(RAW_URL);
      await AdminApi.eliminarDiaExcepcional(barberoId, id);

      // Recargar lista
      const excepcionales = await AdminApi.listDiasExcepcionales(barberoId);
      setDiasExcepcionales(excepcionales || []);

      toast("D√≠a excepcional eliminado.");
    } catch (e: any) {
      toast(e?.message || "Error eliminando d√≠a excepcional.");
    } finally {
      setLoading(false);
    }
  };

  // Agrupar d√≠as excepcionales por fecha
  const diasExcepcionalesAgrupados = useMemo(() => {
    const grupos: Record<string, DiaExcepcionalBarberoDTO[]> = {};
    diasExcepcionales.forEach((dia) => {
      if (!grupos[dia.fecha]) grupos[dia.fecha] = [];
      grupos[dia.fecha].push(dia);
    });
    return grupos;
  }, [diasExcepcionales]);

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl lg:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 bg-clip-text text-transparent">
            Horarios de Barberos
          </h1>
          {selected && (
            <p className="text-sm text-slate-600 mt-1">
              Editando: <span className="font-semibold text-fuchsia-600">{selected.nombre}</span>
            </p>
          )}
        </div>
        <button
          className="inline-flex items-center justify-center gap-2 rounded-xl border border-slate-300 px-4 py-2 text-sm font-medium hover:bg-slate-50 transition-colors"
          onClick={() => navigate("/admin/barberos")}
        >
          <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Volver
        </button>
      </div>

      {/* Selector de barbero */}
      <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 p-6">
        <label className="block text-sm font-medium text-slate-700 mb-3">Barbero</label>
        <CustomSelect
          value={barberoId ? String(barberoId) : ""}
          onChange={(value) => setBarberoId(value ? Number(value) : null)}
          options={barberos.map((b) => ({ value: String(b.id), label: b.nombre }))}
          placeholder="Eleg√≠ un barbero‚Ä¶"
        />
      </div>

      {error && (
        <div className="rounded-xl border border-red-300 bg-red-50 px-4 py-3 text-red-700 text-sm flex items-center gap-2">
          <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
          </svg>
          {error}
        </div>
      )}

      {loading && (
        <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 p-12 text-center">
          <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-fuchsia-100 mb-3">
            <svg className="animate-spin w-6 h-6 text-fuchsia-600" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
          <p className="text-slate-600">Cargando horarios‚Ä¶</p>
        </div>
      )}

      {!!barberoId && !loading && (
        <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50">
          <div className="px-4 sm:px-6 py-4 bg-gradient-to-r from-slate-50 to-white border-b border-slate-200 rounded-t-2xl">
            <h2 className="text-base sm:text-lg font-semibold text-slate-900">Configuraci√≥n de Horarios</h2>
            <p className="text-xs sm:text-sm text-slate-500 mt-0.5">Defin√≠ las franjas horarias para cada d√≠a de la semana</p>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full text-sm min-w-[800px]">
              <thead>
                <tr className="bg-gradient-to-r from-slate-50 to-white border-b border-slate-200">
                  <th className="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">D√≠a</th>
                  <th className="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">T1 - Inicio</th>
                  <th className="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">T1 - Fin</th>
                  <th className="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">T2 - Inicio</th>
                  <th className="px-2 sm:px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">T2 - Fin</th>
                  <th className="px-2 sm:px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider whitespace-nowrap">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {DIAS.map((d) => {
                  const h = rows[d.n];
                  const cerrado = !h;
                  return (
                    <tr key={d.n} className="border-b border-slate-100 hover:bg-slate-50/50 transition-colors">
                      <td className="px-2 sm:px-4 py-2 sm:py-3">
                        <span className="font-medium text-slate-900 text-xs sm:text-sm whitespace-nowrap">{d.label}</span>
                      </td>

                      {/* T1 Inicio */}
                      <td className="px-2 sm:px-4 py-2 sm:py-3 relative">
                        {cerrado ? (
                          <div className="text-slate-400 text-center text-xs">--:--</div>
                        ) : (
                          <CustomSelect
                            className="w-20 sm:w-full"
                            value={h?.inicio || ""}
                            onChange={(value) => setValue(d.n, "inicio", value)}
                            options={TIME_OPTIONS}
                            placeholder="--:--"
                          />
                        )}
                      </td>

                      {/* T1 Fin */}
                      <td className="px-2 sm:px-4 py-2 sm:py-3 relative">
                        {cerrado ? (
                          <div className="text-slate-400 text-center text-xs">--:--</div>
                        ) : (
                          <CustomSelect
                            className="w-20 sm:w-full"
                            value={h?.fin || ""}
                            onChange={(value) => setValue(d.n, "fin", value)}
                            options={TIME_OPTIONS}
                            placeholder="--:--"
                          />
                        )}
                      </td>

                      {/* T2 Inicio */}
                      <td className="px-2 sm:px-4 py-2 sm:py-3 relative">
                        {cerrado ? (
                          <div className="text-slate-400 text-center text-xs">--:--</div>
                        ) : (
                          <CustomSelect
                            className="w-20 sm:w-full"
                            value={rowsExtra[d.n]?.inicio || ""}
                            onChange={(value) => setValueExtra(d.n, "inicio", value)}
                            options={TIME_OPTIONS}
                            placeholder="--:--"
                          />
                        )}
                      </td>

                      {/* T2 Fin */}
                      <td className="px-2 sm:px-4 py-2 sm:py-3 relative">
                        {cerrado ? (
                          <div className="text-slate-400 text-center text-xs">--:--</div>
                        ) : (
                          <CustomSelect
                            className="w-20 sm:w-full"
                            value={rowsExtra[d.n]?.fin || ""}
                            onChange={(value) => setValueExtra(d.n, "fin", value)}
                            options={TIME_OPTIONS}
                            placeholder="--:--"
                          />
                        )}
                      </td>

                      {/* Acciones */}
                      <td className="px-2 sm:px-4 py-2 sm:py-3">
                        <div className="flex items-center justify-end gap-1 sm:gap-2">
                          {cerrado ? (
                            <button
                              className="inline-flex items-center gap-1 rounded-lg border border-green-300 bg-green-50 px-2 py-1.5 text-xs font-medium text-green-700 hover:bg-green-100 transition-colors whitespace-nowrap"
                              onClick={() => {
                                setRows((r) => ({ ...r, [d.n]: { diaSemana: d.n, inicio: "09:00", fin: "12:00" } }))
                                setRowsExtra((r) => ({ ...r, [d.n]: null }));
                                setDirty((dmap) => ({ ...dmap, [d.n]: true }));
                              }}
                            >
                              <svg className="w-3 h-3 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                              </svg>
                              <span className="hidden sm:inline">Abrir</span>
                            </button>
                          ) : (
                            <>
                              {dirty[d.n] && (
                                <button
                                  className="inline-flex items-center gap-1 rounded-lg bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-2 py-1.5 text-xs font-medium text-white hover:from-fuchsia-700 hover:to-fuchsia-800 shadow-md hover:shadow-lg transition-all whitespace-nowrap"
                                  onClick={() => guardarDia(d.n)}
                                >
                                  <svg className="w-3 h-3 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                  </svg>
                                  <span className="hidden sm:inline">Guardar</span>
                                </button>
                              )}
                              <button
                                className="inline-flex items-center gap-1 rounded-lg border border-red-300 bg-red-50 px-2 py-1.5 text-xs font-medium text-red-700 hover:bg-red-100 transition-colors whitespace-nowrap"
                                onClick={() => cerrarDia(d.n)}
                                disabled={loading}
                              >
                                <svg className="w-3 h-3 sm:w-4 sm:h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                                <span className="hidden sm:inline">Cerrar</span>
                              </button>
                            </>
                          )}
                        </div>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>

          {loading && <div className="mt-3 text-slate-500 text-sm">Guardando‚Ä¶</div>}
        </div>
      )}

      {/* Secci√≥n de d√≠as excepcionales */}
      {!!barberoId && !loading && (
        <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50">
          <div className="px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-50 to-white border-b border-amber-200 rounded-t-2xl">
            <h2 className="text-base sm:text-lg font-semibold text-slate-900">D√≠as Excepcionales</h2>
            <p className="text-xs sm:text-sm text-slate-500 mt-0.5">
              D√≠as espec√≠ficos que no siguen el horario regular (ej: festivos, eventos especiales)
            </p>
          </div>

          <div className="p-4 sm:p-6 space-y-6">
            {/* Formulario para agregar/editar */}
            <div className="bg-gradient-to-r from-amber-50/50 to-white p-4 rounded-xl border border-amber-200">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-sm font-semibold text-slate-900">
                  {editandoFecha ? "Editar d√≠a excepcional" : "Agregar d√≠a excepcional"}
                </h3>
                {editandoFecha && (
                  <button
                    className="text-xs text-slate-600 hover:text-slate-900 underline"
                    onClick={cancelarEdicion}
                  >
                    Cancelar edici√≥n
                  </button>
                )}
              </div>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3">
                <div>
                  <label className="block text-xs font-medium text-slate-700 mb-1">Fecha</label>
                  <input
                    type="date"
                    className="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent disabled:bg-slate-100 disabled:cursor-not-allowed"
                    value={nuevoDiaExcepcional.fecha}
                    onChange={(e) => setNuevoDiaExcepcional({ ...nuevoDiaExcepcional, fecha: e.target.value })}
                    min={new Date().toISOString().split('T')[0]}
                    disabled={!!editandoFecha}
                  />
                </div>
                <div>
                  <label className="block text-xs font-medium text-slate-700 mb-1">T1 Inicio</label>
                  <CustomSelect
                    value={nuevoDiaExcepcional.inicio1}
                    onChange={(value) => setNuevoDiaExcepcional({ ...nuevoDiaExcepcional, inicio1: value })}
                    options={TIME_OPTIONS}
                  />
                </div>
                <div>
                  <label className="block text-xs font-medium text-slate-700 mb-1">T1 Fin</label>
                  <CustomSelect
                    value={nuevoDiaExcepcional.fin1}
                    onChange={(value) => setNuevoDiaExcepcional({ ...nuevoDiaExcepcional, fin1: value })}
                    options={TIME_OPTIONS}
                  />
                </div>
                <div>
                  <label className="block text-xs font-medium text-slate-700 mb-1">T2 Inicio</label>
                  <CustomSelect
                    value={nuevoDiaExcepcional.inicio2}
                    onChange={(value) => setNuevoDiaExcepcional({ ...nuevoDiaExcepcional, inicio2: value })}
                    options={TIME_OPTIONS}
                    placeholder="Opcional"
                  />
                </div>
                <div>
                  <label className="block text-xs font-medium text-slate-700 mb-1">T2 Fin</label>
                  <CustomSelect
                    value={nuevoDiaExcepcional.fin2}
                    onChange={(value) => setNuevoDiaExcepcional({ ...nuevoDiaExcepcional, fin2: value })}
                    options={TIME_OPTIONS}
                    placeholder="Opcional"
                  />
                </div>
              </div>
              <button
                className="mt-3 inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2 text-sm font-medium text-white hover:from-fuchsia-700 hover:to-fuchsia-800 shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                onClick={agregarDiaExcepcional}
                disabled={loading || !nuevoDiaExcepcional.fecha}
              >
                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  {editandoFecha ? (
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                  ) : (
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                  )}
                </svg>
                {editandoFecha ? "Guardar cambios" : "Agregar"}
              </button>
            </div>

            {/* Lista de d√≠as excepcionales */}
            {Object.keys(diasExcepcionalesAgrupados).length === 0 ? (
              <div className="text-center py-8 text-slate-500 text-sm">
                No hay d√≠as excepcionales configurados
              </div>
            ) : (
              <div className="space-y-2">
                {Object.entries(diasExcepcionalesAgrupados)
                  .sort(([a], [b]) => a.localeCompare(b))
                  .map(([fecha, franjas]) => {
                    const fechaObj = new Date(fecha + 'T00:00:00');
                    const diaNombre = fechaObj.toLocaleDateString('es-AR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });

                    return (
                      <div key={fecha} className="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200 hover:border-fuchsia-300 transition-colors">
                        <div className="flex items-start gap-3">
                          <div className="flex-shrink-0 w-10 h-10 rounded-lg bg-gradient-to-br from-fuchsia-500 to-fuchsia-600 flex items-center justify-center">
                            <svg className="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                          </div>
                          <div>
                            <div className="font-semibold text-slate-900 capitalize text-sm">{diaNombre}</div>
                            <div className="text-xs text-slate-600 mt-1 space-x-2">
                              {franjas
                                .sort((a, b) => a.inicio.localeCompare(b.inicio))
                                .map((franja, idx) => (
                                  <span key={franja.id} className="inline-flex items-center gap-1">
                                    {idx > 0 && <span className="text-slate-400">|</span>}
                                    <span className="font-mono">{franja.inicio} - {franja.fin}</span>
                                  </span>
                                ))}
                            </div>
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          <button
                            className="flex-shrink-0 inline-flex items-center gap-1 rounded-lg border border-blue-300 bg-blue-50 px-3 py-1.5 text-xs font-medium text-blue-700 hover:bg-blue-100 transition-colors"
                            onClick={() => cargarDiaExcepcionalParaEditar(fecha, franjas)}
                            disabled={loading}
                          >
                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            Editar
                          </button>
                          <button
                            className="flex-shrink-0 inline-flex items-center gap-1 rounded-lg border border-red-300 bg-red-50 px-3 py-1.5 text-xs font-medium text-red-700 hover:bg-red-100 transition-colors"
                            onClick={() => {
                              // Eliminar todas las franjas de esta fecha
                              franjas.forEach((franja) => {
                                if (franja.id) eliminarDiaExcepcional(franja.id);
                              });
                            }}
                            disabled={loading}
                          >
                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            Eliminar
                          </button>
                        </div>
                      </div>
                    );
                  })}
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}


========== FILE: ./pages/admin/LoginAdmin.tsx ==========
// src/pages/admin/LoginAdmin.tsx
import { useState, useEffect } from 'react';
import type { FormEvent } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';
import { clearAllAuthCookies } from '../../lib/authApi';

export default function LoginAdmin() {
  const navigate = useNavigate();
  const { login } = useAuth();

  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const cookies = document.cookie;
    if (cookies.includes('ACCESS') || cookies.includes('REFRESH')) {
      clearAllAuthCookies();
    }
  }, []);

  async function handleSubmit(e: FormEvent) {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      await login(username, password);
      navigate('/admin', { replace: true });
    } catch (err: any) {
      setError('Usuario o contrase√±a incorrectos');
    } finally {
      setLoading(false);
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-white to-slate-100 px-4 py-8">
      <div className="w-full max-w-md">
        {/* Logo o t√≠tulo */}
        <div className="text-center mb-8">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-fuchsia-600 to-fuchsia-700 rounded-2xl mb-4 shadow-lg shadow-fuchsia-500/30">
            <svg className="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
          </div>
          <h1 className="text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent mb-2">Panel de Administraci√≥n</h1>
          <p className="text-slate-600">Ingres√° tus credenciales para continuar</p>
        </div>

        {/* Card de login */}
        <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl p-8 border border-slate-200/50">
          <form onSubmit={handleSubmit} className="space-y-6">
            <div>
              <label className="block text-sm font-medium mb-2 text-slate-700">Usuario</label>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                className="w-full rounded-xl border border-slate-300 bg-white px-4 py-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent transition-all"
                placeholder="Ingres√° tu usuario"
                required
                autoFocus
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2 text-slate-700">Contrase√±a</label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full rounded-xl border border-slate-300 bg-white px-4 py-3 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent transition-all"
                placeholder="Ingres√° tu contrase√±a"
                required
              />
            </div>

            {error && (
              <div className="rounded-xl border border-red-300 bg-red-50 px-4 py-3 text-red-700 text-sm flex items-center gap-2 animate-shake">
                <svg className="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                </svg>
                {error}
              </div>
            )}

            <button
              type="submit"
              disabled={loading}
              className="w-full rounded-xl bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-3 text-white font-semibold shadow-lg shadow-fuchsia-500/30 hover:shadow-fuchsia-500/50 hover:from-fuchsia-700 hover:to-fuchsia-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]"
            >
              {loading ? (
                <span className="flex items-center justify-center gap-2">
                  <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                  </svg>
                  Iniciando sesi√≥n...
                </span>
              ) : (
                'Ingresar al Panel'
              )}
            </button>
          </form>
        </div>

        {/* Footer */}
        <p className="text-center text-slate-500 text-sm mt-6">
          Cromados ¬© {new Date().getFullYear()}
        </p>
      </div>
    </div>
  );
}


========== FILE: ./pages/admin/ServiciosAdmin.tsx ==========
// src/pages/admin/ServiciosAdmin.tsx
import { useEffect, useMemo, useState } from "react";
import AdminApi, { type ServicioDTO, type BarberoDTO } from "../../lib/adminApi";

type Mode = { kind: "idle" } | { kind: "create" } | { kind: "edit"; id: number };

type FormState = {
  nombre: string;
  precio: string;       // string mientras se tipea
  duracionMin: string;  // string mientras se tipea
  sesiones: string;     // string mientras se tipea
  descripcion: string;
  adicional: boolean;   // ‚úÖ NUEVO: Checkbox para marcar como adicional
  barberosHabilitadosIds: number[]; // ‚úÖ IDs de barberos que pueden ofrecer este servicio
};

const emptyForm: FormState = {
  nombre: "",
  precio: "",
  duracionMin: "",
  sesiones: "1",
  descripcion: "",
  adicional: false,     // ‚úÖ Por defecto NO es adicional
  barberosHabilitadosIds: [], // ‚úÖ Por defecto todos pueden ofrecer el servicio
};

const onlyPosInt = (s: string) => /^(?:[1-9]\d*)$/.test(s); // >=1

export default function ServiciosAdmin() {
  const [items, setItems] = useState<ServicioDTO[]>([]);
  const [barberos, setBarberos] = useState<BarberoDTO[]>([]);
  const [loading, setLoading] = useState(false);
  const [mode, setMode] = useState<Mode>({ kind: "idle" });
  const [form, setForm] = useState<FormState>(emptyForm);
  const [error, setError] = useState<string | null>(null);

  const load = async () => {
    setLoading(true);
    setError(null);
    try {
      const page = await AdminApi.listServicios(0, 100, "id,asc");
      // ‚úÖ Asignar directo; content ya es ServicioDTO[]
      setItems(page.content);
      // Si quer√©s fallback ultra seguro:
      // setItems(Array.isArray(page.content) ? page.content : ([] as ServicioDTO[]));
    } catch (e: any) {
      setError(e?.message || "Error cargando servicios");
    } finally {
      setLoading(false);
    }
  };

  const loadBarberos = async () => {
    try {
      const page = await AdminApi.listBarberos(0, 500, "nombre,asc");
      setBarberos(page.content || []);
    } catch (e: any) {
      console.error("Error cargando barberos:", e);
    }
  };

  useEffect(() => {
    load();
    loadBarberos();
  }, []);

  const startCreate = () => {
    setForm(emptyForm);
    setMode({ kind: "create" });
    setError(null);
  };

  const startEdit = (it: ServicioDTO) => {
    setForm({
      nombre: it.nombre ?? "",
      precio: String(it.precio ?? ""),
      duracionMin: String(it.duracionMin ?? ""),
      sesiones: String((it as any).sesiones ?? "1"),
      descripcion: it.descripcion ?? "",
      adicional: it.adicional ?? false, // ‚úÖ Cargar valor de adicional
      barberosHabilitadosIds: (it as any).barberosHabilitadosIds ?? [], // ‚úÖ Cargar barberos habilitados
    });
    setMode({ kind: "edit", id: it.id! });
    setError(null);
  };

  const cancel = () => {
    setMode({ kind: "idle" });
    setForm(emptyForm);
    setError(null);
  };

  const canSave = useMemo(() => {
    return (
      form.nombre.trim().length > 1 &&
      onlyPosInt(form.precio) &&
      onlyPosInt(form.duracionMin) &&
      onlyPosInt(form.sesiones) && Number(form.sesiones) >= 1
    );
  }, [form]);

  const save = async () => {
    if (!canSave) return;
    setLoading(true);
    setError(null);

    // ‚úÖ Payload exacto que pide AdminApi (sesiones y adicional obligatorios)
    const dtoPayload: {
      nombre: string;
      precio: number;
      duracionMin: number;
      descripcion?: string | "";
      sesiones: number;
      adicional: boolean;
      barberosHabilitadosIds?: number[];
    } = {
      nombre: form.nombre.trim(),
      precio: Number(form.precio),
      duracionMin: Number(form.duracionMin),
      sesiones: Number(form.sesiones),
      descripcion: form.descripcion?.trim() || "",
      adicional: form.adicional, // ‚úÖ Incluir en el payload
      barberosHabilitadosIds: form.barberosHabilitadosIds, // ‚úÖ Incluir barberos habilitados
    };

    try {
      if (mode.kind === "create") {
        await AdminApi.createServicio(dtoPayload);
      } else if (mode.kind === "edit") {
        await AdminApi.updateServicio(mode.id, dtoPayload);
      }
      await load();
      cancel();
    } catch (e: any) {
      setError(e?.message || "Error guardando servicio");
    } finally {
      setLoading(false);
    }
  };

  const toggleActivo = async (id: number) => {
    setLoading(true);
    setError(null);
    try {
      await AdminApi.toggleServicioActivo(id);
      await load();
    } catch (e: any) {
      setError(e?.message || "Error cambiando estado del servicio");
    } finally {
      setLoading(false);
    }
  };

  const removeOne = async (id: number) => {
    if (!confirm("¬øEliminar servicio?")) return;
    setLoading(true);
    setError(null);
    try {
      await AdminApi.deleteServicio(id);
      await load();
    } catch (e: any) {
      setError(e?.message || "Error eliminando servicio");
    } finally {
      setLoading(false);
    }
  };

  const onNumChange =
    (field: keyof FormState) => (e: React.ChangeEvent<HTMLInputElement>) => {
      const v = e.target.value;
      if (v === "" || onlyPosInt(v)) {
        setForm((f) => ({ ...f, [field]: v }));
      }
    };

  return (
    <div className="space-y-6">
      <header className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold">Servicios</h1>
          <p className="text-slate-600">Alta, edici√≥n y baja de servicios.</p>
        </div>
        {mode.kind === "idle" && (
          <button
            onClick={startCreate}
            className="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2.5 text-white font-medium shadow-md hover:shadow-lg hover:from-fuchsia-700 hover:to-fuchsia-800 transition-all"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
            Nuevo servicio
          </button>
        )}
      </header>

      {error && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-red-700">
          {error}
        </div>
      )}

      {mode.kind !== "idle" && (
        <div className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">Nombre</label>
              <input
                className="w-full rounded-lg border px-3 py-2"
                value={form.nombre}
                onChange={(e) => setForm({ ...form, nombre: e.target.value })}
                placeholder="Ej. Corte cl√°sico"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Precio (ARS)</label>
              <input
                className="w-full rounded-lg border px-3 py-2"
                value={form.precio}
                onChange={onNumChange("precio")}
                placeholder="Ej. 5000"
                inputMode="numeric"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Duraci√≥n (min)</label>
              <input
                className="w-full rounded-lg border px-3 py-2"
                value={form.duracionMin}
                onChange={onNumChange("duracionMin")}
                placeholder="Ej. 30"
                inputMode="numeric"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Sesiones</label>
              <input
                className="w-full rounded-lg border px-3 py-2"
                value={form.sesiones}
                onChange={onNumChange("sesiones")}
                placeholder="1"
                inputMode="numeric"
              />
            </div>
            <div className="md:col-span-2">
              <label className="block text-sm font-medium mb-1">Descripci√≥n</label>
              <textarea
                className="w-full rounded-lg border px-3 py-2"
                rows={3}
                value={form.descripcion}
                onChange={(e) =>
                  setForm({ ...form, descripcion: e.target.value })
                }
                placeholder="Opcional"
              />
            </div>
            <div className="md:col-span-2">
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={form.adicional}
                  onChange={(e) => setForm({ ...form, adicional: e.target.checked })}
                  className="rounded border-slate-300 text-fuchsia-600 focus:ring-fuchsia-500"
                />
                <span className="text-sm font-medium">
                  Es un servicio adicional
                  <span className="block text-xs text-slate-500 font-normal">
                    Los servicios adicionales se pueden agregar a otros servicios en la misma reserva (ej: Lavado con Corte)
                  </span>
                </span>
              </label>
            </div>
            <div className="md:col-span-2">
              <label className="block text-sm font-medium mb-2">
                Barberos habilitados
                <span className="block text-xs text-slate-500 font-normal mt-1">
                  Si no seleccion√°s ninguno, todos los barberos podr√°n ofrecer este servicio. Si seleccion√°s algunos, solo esos barberos podr√°n ofrecerlo.
                </span>
              </label>
              <div className="flex flex-wrap gap-2">
                {barberos.map((b) => (
                  <label key={b.id} className="flex items-center gap-2 cursor-pointer rounded-lg border px-3 py-2 hover:bg-slate-50">
                    <input
                      type="checkbox"
                      checked={form.barberosHabilitadosIds.includes(b.id!)}
                      onChange={(e) => {
                        if (e.target.checked) {
                          setForm({ ...form, barberosHabilitadosIds: [...form.barberosHabilitadosIds, b.id!] });
                        } else {
                          setForm({ ...form, barberosHabilitadosIds: form.barberosHabilitadosIds.filter(id => id !== b.id!) });
                        }
                      }}
                      className="rounded border-slate-300 text-fuchsia-600 focus:ring-fuchsia-500"
                    />
                    <span className="text-sm">{b.nombre}</span>
                  </label>
                ))}
              </div>
            </div>
          </div>

          <div className="flex gap-2 mt-4">
            <button
              disabled={!canSave || loading}
              onClick={save}
              className="rounded-lg bg-fuchsia-600 px-4 py-2 text-white disabled:opacity-40"
            >
              Guardar
            </button>
            <button
              disabled={loading}
              onClick={cancel}
              className="rounded-lg border px-4 py-2"
            >
              Cancelar
            </button>
          </div>
        </div>
      )}

      {/* Tabla responsive */}
      <div className="rounded-2xl border border-slate-200 bg-white shadow-sm">
        {/* Vista m√≥vil: cards */}
        <div className="block md:hidden">
          {loading && (
            <div className="p-4 text-slate-500 text-sm">Cargando‚Ä¶</div>
          )}

          {!loading && items.map((it) => (
            <div key={it.id} className="border-b last:border-b-0 p-3">
              <div className="flex items-start justify-between gap-3">
                <div className="flex-1 min-w-0">
                  <div className="font-medium text-base mb-1">{it.nombre}</div>

                  <div className="flex items-center gap-3 text-xs text-slate-600 mb-2">
                    <span className="font-semibold text-fuchsia-600">ARS ${it.precio}</span>
                    <span>‚è±Ô∏è {it.duracionMin} min</span>
                    <span>üìÖ {(it as any).sesiones ?? 1} sesi√≥n{(it as any).sesiones > 1 ? 'es' : ''}</span>
                  </div>

                  {it.descripcion && (
                    <div className="text-xs text-slate-500 mb-2 line-clamp-2">
                      {it.descripcion}
                    </div>
                  )}

                  <div className="text-xs text-slate-400">ID: {it.id}</div>

                  <div className="flex flex-wrap gap-2 mt-2">
                    <button
                      onClick={() => startEdit(it)}
                      className="rounded-lg border px-2 py-1 text-xs hover:bg-slate-50"
                    >
                      Editar
                    </button>
                    <button
                      onClick={() => it.id && toggleActivo(it.id)}
                      className={`rounded-lg border px-2 py-1 text-xs ${
                        (it as any).activo === false
                          ? 'text-green-600 border-green-300 hover:bg-green-50'
                          : 'text-orange-600 border-orange-300 hover:bg-orange-50'
                      }`}
                    >
                      {(it as any).activo === false ? 'Activar' : 'Desactivar'}
                    </button>
                    <button
                      onClick={() => it.id && removeOne(it.id)}
                      className="rounded-lg border px-2 py-1 text-xs text-red-600 border-red-300 hover:bg-red-50"
                    >
                      Eliminar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {!loading && items.length === 0 && (
            <div className="p-8 text-center">
              <svg className="w-12 h-12 text-slate-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <p className="text-sm text-slate-500 mb-2">Sin servicios.</p>
              <button
                onClick={startCreate}
                className="text-xs text-fuchsia-600 hover:text-fuchsia-700 font-medium"
              >
                Crear primer servicio
              </button>
            </div>
          )}
        </div>

        {/* Vista desktop: tabla */}
        <div className="hidden md:block overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-50 text-slate-700">
              <tr>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">ID</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Nombre</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Precio</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Duraci√≥n</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Sesiones</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Descripci√≥n</th>
                <th className="px-4 py-3 text-right text-xs font-semibold uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {loading && (
                <tr>
                  <td colSpan={7} className="px-4 py-4 text-slate-500 text-center">
                    Cargando‚Ä¶
                  </td>
                </tr>
              )}

              {!loading && items.map((it) => (
                <tr key={it.id} className="border-t border-slate-200 hover:bg-slate-50">
                  <td className="px-4 py-3">
                    <span className="font-mono text-xs font-semibold">#{it.id}</span>
                  </td>
                  <td className="px-4 py-3">
                    <div className="font-medium">{it.nombre}</div>
                  </td>
                  <td className="px-4 py-3">
                    <span className="font-semibold text-fuchsia-600">ARS ${it.precio}</span>
                  </td>
                  <td className="px-4 py-3">{it.duracionMin} min</td>
                  <td className="px-4 py-3">{(it as any).sesiones ?? 1}</td>
                  <td className="px-4 py-3">
                    <div className="text-slate-600 text-sm max-w-xs truncate">
                      {it.descripcion || "-"}
                    </div>
                  </td>
                  <td className="px-4 py-3 text-right space-x-2">
                    <button
                      onClick={() => startEdit(it)}
                      className="rounded-xl border px-3 py-1 hover:bg-slate-50"
                    >
                      Editar
                    </button>
                    <button
                      onClick={() => it.id && toggleActivo(it.id)}
                      className={`rounded-xl border px-3 py-1 ${
                        (it as any).activo === false
                          ? 'text-green-600 border-green-300 hover:bg-green-50'
                          : 'text-orange-600 border-orange-300 hover:bg-orange-50'
                      }`}
                    >
                      {(it as any).activo === false ? 'Activar' : 'Desactivar'}
                    </button>
                    <button
                      onClick={() => it.id && removeOne(it.id)}
                      className="rounded-xl border px-3 py-1 text-red-600 border-red-300 hover:bg-red-50"
                    >
                      Eliminar
                    </button>
                  </td>
                </tr>
              ))}

              {!loading && items.length === 0 && (
                <tr>
                  <td colSpan={7} className="px-4 py-8 text-slate-500 text-center">
                    <div className="flex flex-col items-center gap-2">
                      <svg className="w-12 h-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                      </svg>
                      <p className="text-sm">Sin servicios.</p>
                      <button
                        onClick={startCreate}
                        className="mt-2 text-xs text-fuchsia-600 hover:text-fuchsia-700 font-medium"
                      >
                        Crear primer servicio
                      </button>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

========== FILE: ./pages/admin/SucursalesAdmin.tsx ==========
import { useEffect, useMemo, useState } from "react";
import { AdminApi, type SucursalDTO, resolveUrl } from "../../lib/adminApi";

type Mode =
  | { kind: "idle" }
  | { kind: "create" }
  | { kind: "edit"; id: number };

const EMPTY: SucursalDTO = { nombre: "", direccion: "" };

export default function SucursalesAdmin() {
  const [rows, setRows] = useState<SucursalDTO[]>([]);
  const [mode, setMode] = useState<Mode>({ kind: "idle" });
  const [form, setForm] = useState<SucursalDTO>({ ...EMPTY });
  const [file, setFile] = useState<File | null>(null);

  const [loading, setLoading] = useState(false);
  const [loadingTable, setLoadingTable] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const loadAll = async () => {
    setLoadingTable(true);
    setError(null);
    try {
      const page = await AdminApi.listSucursales(0, 200, "id,asc");
      const list = Array.isArray(page?.content) ? (page.content as SucursalDTO[]) : [];
      setRows(list);
    } catch (e: any) {
      setError(e?.message || "Error cargando sucursales");
      setRows([]);
    } finally {
      setLoadingTable(false);
    }
  };

  useEffect(() => {
    loadAll();
  }, []);

  const canSave = useMemo(
    () => form.nombre.trim() !== "" && form.direccion.trim() !== "",
    [form]
  );

  const resetForm = () => {
    setForm({ ...EMPTY });
    setFile(null);
    setMode({ kind: "idle" });
  };

  const startCreate = () => {
    setForm({ ...EMPTY });
    setFile(null);
    setMode({ kind: "create" });
  };

  const startEdit = (s: SucursalDTO) => {
    setForm({ id: s.id, nombre: s.nombre, direccion: s.direccion, fotoUrl: s.fotoUrl || "" });
    setFile(null);
    setMode({ kind: "edit", id: Number(s.id) });
  };

  const save = async () => {
    if (!canSave) return;
    setLoading(true);
    setError(null);
    try {
      let saved: SucursalDTO;
      if (mode.kind === "edit" && mode.id) {
        saved = await AdminApi.updateSucursal(mode.id, {
          nombre: form.nombre,
          direccion: form.direccion,
        });
      } else {
        saved = await AdminApi.createSucursal({
          nombre: form.nombre,
          direccion: form.direccion,
        });
      }

      if (file && saved?.id) {
        await AdminApi.uploadSucursalFoto(Number(saved.id), file);
      }

      resetForm();
      await loadAll();
    } catch (e: any) {
      setError(e?.message || "Error guardando sucursal");
    } finally {
      setLoading(false);
    }
  };

  const del = async (id?: number) => {
    if (!id) return;
    if (!confirm("¬øEliminar sucursal?")) return;
    setLoading(true);
    setError(null);
    try {
      await AdminApi.deleteSucursal(id);
      await loadAll();
    } catch (e: any) {
      setError(e?.message || "Error eliminando sucursal");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-6">
      <header className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 className="text-2xl font-semibold">Sucursales</h1>
          <p className="text-slate-600 text-sm">Alta, edici√≥n, foto y baja.</p>
        </div>

        {mode.kind === "idle" && (
          <button
            onClick={startCreate}
            className="inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2.5 text-white font-medium shadow-md hover:shadow-lg hover:from-fuchsia-700 hover:to-fuchsia-800 transition-all"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
            Nueva sucursal
          </button>
        )}
      </header>

      {error && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-red-700">
          {error}
        </div>
      )}

      {/* Formulario solo en create/edit */}
      {mode.kind !== "idle" && (
        <div className="rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 shadow-sm">
          <div className="grid gap-4 sm:grid-cols-2">
            <label className="grid gap-2">
              <span className="text-sm font-medium text-slate-700">Nombre</span>
              <input
                className="w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent"
                value={form.nombre}
                onChange={(e) => setForm({ ...form, nombre: e.target.value })}
                placeholder="Ej: Sucursal Centro"
              />
            </label>
            <label className="grid gap-2">
              <span className="text-sm font-medium text-slate-700">Direcci√≥n</span>
              <input
                className="w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:border-transparent"
                value={form.direccion}
                onChange={(e) => setForm({ ...form, direccion: e.target.value })}
                placeholder="Ej: Av. Principal 123"
              />
            </label>
            <label className="grid gap-2 sm:col-span-2">
              <span className="text-sm font-medium text-slate-700">Foto (.jpg/.png) ‚Äî opcional</span>
              <input
                type="file"
                accept="image/*"
                onChange={(e) => setFile(e.target.files?.[0] || null)}
                className="block w-full text-sm text-slate-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-fuchsia-50 file:text-fuchsia-700 hover:file:bg-fuchsia-100 cursor-pointer"
              />
            </label>
          </div>

          <div className="mt-4 flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
            <button
              onClick={save}
              disabled={!canSave || loading}
              className="rounded-xl bg-fuchsia-600 px-4 py-2 text-white disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors"
            >
              {mode.kind === "edit" ? "Guardar cambios" : "Crear"}
            </button>
            <button
              onClick={resetForm}
              className="rounded-xl border border-slate-300 px-4 py-2 hover:bg-slate-50 transition-colors"
            >
              Cancelar
            </button>
          </div>
        </div>
      )}

      {/* Tabla responsive */}
      <div className="rounded-2xl border border-slate-200 bg-white shadow-sm">
        {/* Vista m√≥vil: cards */}
        <div className="block md:hidden">
          {loadingTable && (
            <div className="p-4 text-slate-500 text-sm">Cargando‚Ä¶</div>
          )}

          {!loadingTable && rows.map((s) => (
            <div key={s.id} className="border-b last:border-b-0 p-3">
              <div className="flex items-start gap-3">
                {s.fotoUrl ? (
                  <img
                    src={resolveUrl(s.fotoUrl)}
                    alt={s.nombre}
                    className="h-16 w-16 object-cover rounded-xl border shrink-0"
                  />
                ) : (
                  <div className="h-16 w-16 rounded-xl bg-slate-200 grid place-items-center text-xs text-slate-600 shrink-0">
                    Sin foto
                  </div>
                )}

                <div className="flex-1 min-w-0">
                  <div className="font-medium truncate">{s.nombre}</div>
                  <div className="text-xs text-slate-500 mt-1">
                    üìç {s.direccion}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">ID: {s.id}</div>

                  <div className="flex flex-wrap gap-2 mt-2">
                    <button
                      className="rounded-lg border px-2 py-1 text-xs hover:bg-slate-50"
                      onClick={() => startEdit(s)}
                    >
                      Editar
                    </button>
                    <button
                      className="rounded-lg border px-2 py-1 text-xs text-red-600 border-red-300 hover:bg-red-50"
                      onClick={() => del(Number(s.id))}
                    >
                      Eliminar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          ))}

          {!loadingTable && rows.length === 0 && (
            <div className="p-8 text-center">
              <svg className="w-12 h-12 text-slate-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <p className="text-sm text-slate-500 mb-2">Sin sucursales.</p>
              <button
                onClick={startCreate}
                className="text-xs text-fuchsia-600 hover:text-fuchsia-700 font-medium"
              >
                Crear primera sucursal
              </button>
            </div>
          )}
        </div>

        {/* Vista desktop: tabla */}
        <div className="hidden md:block overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-50 text-slate-700">
              <tr>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">ID</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Nombre</th>
                <th className="px-4 py-3 text-left text-xs font-semibold uppercase">Direcci√≥n</th>
                <th className="px-4 py-3 text-right text-xs font-semibold uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {loadingTable && (
                <tr>
                  <td colSpan={4} className="px-4 py-4 text-slate-500 text-center">
                    Cargando‚Ä¶
                  </td>
                </tr>
              )}

              {!loadingTable && rows.map((s) => (
                <tr key={s.id} className="border-t border-slate-200 hover:bg-slate-50">
                  <td className="px-4 py-3">
                    <span className="font-mono text-xs font-semibold">#{s.id}</span>
                  </td>
                  <td className="px-4 py-3">
                    <div className="font-medium">{s.nombre}</div>
                  </td>
                  <td className="px-4 py-3">
                    <div className="text-slate-600 text-sm">{s.direccion}</div>
                  </td>
                  <td className="px-4 py-3 text-right space-x-2">
                    <button
                      className="rounded-xl border px-3 py-1 hover:bg-slate-50"
                      onClick={() => startEdit(s)}
                    >
                      Editar
                    </button>
                    <button
                      className="rounded-xl border px-3 py-1 text-red-600 border-red-300 hover:bg-red-50"
                      onClick={() => del(Number(s.id))}
                    >
                      Eliminar
                    </button>
                  </td>
                </tr>
              ))}

              {!loadingTable && rows.length === 0 && (
                <tr>
                  <td colSpan={4} className="px-4 py-8 text-slate-500 text-center">
                    <div className="flex flex-col items-center gap-2">
                      <svg className="w-12 h-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                      </svg>
                      <p className="text-sm">Sin sucursales.</p>
                      <button
                        onClick={startCreate}
                        className="mt-2 text-xs text-fuchsia-600 hover:text-fuchsia-700 font-medium"
                      >
                        Crear primera sucursal
                      </button>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}



========== FILE: ./pages/admin/TurnosAdmin.tsx ==========
// src/pages/admin/TurnosAdmin.tsx
import { useEffect, useMemo, useState } from "react";
import AdminApi, { PublicApi } from "../../lib/adminApi";
import CustomSelect from "../../components/CustomSelect";

// Helper para formatear fecha AAAA-MM-DD a DD/MM/AAAA
const formatFecha = (fecha: string): string => {
  const [y, m, d] = fecha.split('-');
  return `${d}/${m}/${y}`;
};

type TurnoAdminDTO = {
  id: number;
  clienteNombre: string;
  clienteEmail?: string | null;
  clienteTelefono?: string | null;
  sucursalId: number;
  barberoId: number;
  tipoCorteId: number;
  fecha: string;
  hora: string;
  estado: string;
  pagoConfirmado?: boolean | null;
  barberoNombre?: string;
  servicioNombre?: string;
  // üÜï Nuevos campos
  montoPagado?: number;
  senia?: boolean;
  montoEfectivo?: number;
  grupoId?: string | null; // UUID para agrupar turnos multi-sesi√≥n
  adicionales?: string; // Servicios adicionales separados por comas
};

type Page<T> = {
  content: T[];
  totalElements: number;
  totalPages: number;
  number: number;
  size: number;
};

function toIsoDate(d: Date) {
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2, "0");
  const day = String(d.getDate()).padStart(2, "0");
  return `${y}-${m}-${day}`;
}

export default function TurnosAdmin() {
  const [page, setPage] = useState(0);
  const [size, setSize] = useState(20);
  const [sort, setSort] = useState("id,desc"); // ‚úÖ Predeterminar por ID descendente
  const [data, setData] = useState<Page<TurnoAdminDTO>>({
    content: [],
    totalElements: 0,
    totalPages: 0,
    number: 0,
    size,
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [q, setQ] = useState("");
  const [barberoId, setBarberoId] = useState<string>("");
  const [mostrarBloqueados, setMostrarBloqueados] = useState(true);
  const [mostrarPasados, setMostrarPasados] = useState(false); // ‚úÖ NUEVO: Toggle para mostrar pasados

  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const plus365 = new Date(today); // ‚úÖ Extendido a 1 a√±o para cubrir servicios multi-sesi√≥n
  plus365.setDate(today.getDate() + 365);
  const minus30 = new Date(today); // ‚úÖ NUEVO: Para mostrar hist√≥ricos
  minus30.setDate(today.getDate() - 30);

  const [from, setFrom] = useState<string>(toIsoDate(today)); // ‚úÖ Predeterminar desde hoy (vigentes)
  const [to, setTo] = useState<string>(toIsoDate(plus365));

  const [barberoName, setBarberoName] = useState<Record<number, string>>({});
  const [tipoCorteName, setTipoCorteName] = useState<Record<number, string>>({});

  // Helper para obtener badge de estado
  const getEstadoBadge = (estado: string, pagoConfirmado?: boolean | null) => {
    if (estado === "BLOQUEADO") {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">
          üîí Bloqueado
        </span>
      );
    }
    if (pagoConfirmado) {
      return (
        <span className="inline-flex items-center gap-1 rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
          ‚úì Confirmado
        </span>
      );
    }
    return (
      <span className="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">
        Pendiente
      </span>
    );
  };

  // ‚úÖ NUEVO: Actualizar rango de fechas al cambiar toggle de pasados
  useEffect(() => {
    if (mostrarPasados) {
      // Mostrar √∫ltimos 30 d√≠as + pr√≥ximos 365 d√≠as
      setFrom(toIsoDate(minus30));
      setTo(toIsoDate(plus365));
    } else {
      // Solo vigentes (hoy + pr√≥ximos 365 d√≠as para cubrir servicios multi-sesi√≥n)
      setFrom(toIsoDate(today));
      setTo(toIsoDate(plus365));
    }
  }, [mostrarPasados]);

  useEffect(() => {
    (async () => {
      try {
        const bs = await PublicApi.barberos();
        const bmap: Record<number, string> = {};
        (Array.isArray(bs) ? bs : []).forEach((b: any) => {
          if (b?.id != null) bmap[Number(b.id)] = String(b.nombre || `#${b.id}`);
        });
        setBarberoName(bmap);

        const ss = await PublicApi.servicios();
        const smap: Record<number, string> = {};
        (Array.isArray(ss) ? ss : []).forEach((s: any) => {
          if (s?.id != null) smap[Number(s.id)] = String(s.nombre || `#${s.id}`);
        });
        setTipoCorteName(smap);
      } catch {}
    })();
  }, []);

  const load = async (pageArg = page) => {
    setLoading(true);
    setError(null);
    try {
      const res = await AdminApi.listTurnos({
        desde: from,
        hasta: to,
        page: pageArg,
        size,
        sort, // üîß A√±adir par√°metro sort
      });
      setData(res);
      setPage(pageArg);
    } catch (e: any) {
      setError(e?.message || "Error cargando turnos");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    load(0);
  }, [size, sort, from, to]);

  const filtered = useMemo(() => {
    const term = q.trim().toLowerCase();
    return (data.content || []).filter((t) => {
      const byText =
        !term ||
        `${t.id}`.includes(term) ||
        (t.clienteNombre || "").toLowerCase().includes(term) ||
        (t.clienteEmail || "").toLowerCase().includes(term) ||
        (t.clienteTelefono || "").toLowerCase().includes(term);

      const byBarbero = !barberoId || String(t.barberoId) === String(barberoId);
      const byFrom = !from || t.fecha >= from;
      const byTo = !to || t.fecha <= to;

      // üÜï Filtro de bloqueados
      const byEstado = mostrarBloqueados || t.estado !== "BLOQUEADO";

      return byText && byBarbero && byFrom && byTo && byEstado;
    });
  }, [data.content, q, barberoId, from, to, mostrarBloqueados]);

  const exportCsv = async () => {
    try {
      setLoading(true);
      const first = await AdminApi.listTurnos({
        desde: from,
        hasta: to,
        page: 0,
        size: 100,
      });
      const all: TurnoAdminDTO[] = [...(first.content || [])];
      for (let p = 1; p < (first.totalPages || 0); p++) {
        const next = await AdminApi.listTurnos({
          desde: from,
          hasta: to,
          page: p,
          size: 100,
        });
        all.push(...(next.content || []));
      }

      const term = q.trim().toLowerCase();
      const filteredAll = all.filter((t) => {
        const byText =
          !term ||
          `${t.id}`.includes(term) ||
          (t.clienteNombre || "").toLowerCase().includes(term) ||
          (t.clienteEmail || "").toLowerCase().includes(term) ||
          (t.clienteTelefono || "").toLowerCase().includes(term);
        const byBarbero = !barberoId || String(t.barberoId) === String(barberoId);
        const byFrom = !from || t.fecha >= from;
        const byTo = !to || t.fecha <= to;
        const byEstado = mostrarBloqueados || t.estado !== "BLOQUEADO";
        return byText && byBarbero && byFrom && byTo && byEstado;
      });

      const header = [
        "ID",
        "Cliente",
        "Email",
        "Tel√©fono",
        "SucursalID",
        "Barbero",
        "Servicio",
        "Adicionales",
        "Fecha",
        "Hora",
        "Estado",
        "MontoPagado",
        "Se√±a",
        "MontoEfectivo"
      ];
      const rows = filteredAll.map((t) => {
        // Determinar estado unificado
        let estadoFinal = t.estado;
        if (t.estado === "BLOQUEADO") {
          estadoFinal = "BLOQUEADO";
        } else if (t.pagoConfirmado) {
          estadoFinal = "CONFIRMADO";
        } else {
          estadoFinal = "PENDIENTE";
        }

        return [
          t.id,
          safe(t.clienteNombre),
          safe(t.clienteEmail),
          safe(t.clienteTelefono),
          t.sucursalId,
          safe(t.barberoNombre ?? barberoName[t.barberoId] ?? t.barberoId),
          safe(t.servicioNombre ?? tipoCorteName[t.tipoCorteId] ?? t.tipoCorteId),
          safe(t.adicionales),
          t.fecha,
          t.hora,
          estadoFinal,
          t.montoPagado ?? 0,
          t.senia ? "SI" : "NO",
          t.montoEfectivo ?? 0
        ];
      });

      const csv = [header, ...rows]
        .map((r) =>
          r
            .map((cell) =>
              typeof cell === "string"
                ? `"${cell.replaceAll(`"`, `""`)}"`
                : String(cell)
            )
            .join(",")
        )
        .join("\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `turnos_${new Date().toISOString().slice(0, 19)}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    } catch (e: any) {
      alert(e?.message || "Error exportando CSV");
    } finally {
      setLoading(false);
    }
  };

  const safe = (v: any) => (v == null ? "" : String(v));

  return (
    <div className="space-y-6">
      <header className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
        <div className="flex-1">
          <h1 className="text-2xl lg:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 bg-clip-text text-transparent">
            Gesti√≥n de Turnos
          </h1>
          <p className="text-slate-600 text-sm lg:text-base mt-1">
            Listado completo con filtros y exportaci√≥n. Estados actualizados autom√°ticamente.
          </p>
        </div>
        <div className="flex flex-wrap gap-2">
          <button
            onClick={() => load(page)}
            disabled={loading}
            className="inline-flex items-center gap-2 rounded-xl border border-slate-300 px-4 py-2.5 text-sm font-medium hover:bg-slate-50 transition-colors disabled:opacity-50"
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            <span className="hidden sm:inline">Refrescar</span>
          </button>
          <button
            onClick={exportCsv}
            disabled={loading}
            className="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-fuchsia-600 to-fuchsia-700 px-4 py-2.5 text-sm font-medium text-white hover:from-fuchsia-700 hover:to-fuchsia-800 shadow-md hover:shadow-lg transition-all disabled:opacity-50"
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Exportar CSV
          </button>
        </div>
      </header>

      {error && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-4 py-2 text-red-700">
          {error}
        </div>
      )}

      {/* Filtros */}
      <div className="bg-white/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 p-4 sm:p-6">
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-2">Buscar</label>
            <input
              className="w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 transition-all"
              placeholder="Buscar por ID o cliente‚Ä¶"
              value={q}
              onChange={(e) => setQ(e.target.value)}
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-2">Barbero</label>
            <select
              className="w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 transition-all"
              value={barberoId}
              onChange={(e) => setBarberoId(e.target.value)}
            >
              <option value="">Todos los barberos</option>
              {Object.entries(barberoName).map(([id, nombre]) => (
                <option key={id} value={id}>
                  {nombre} (ID: {id})
                </option>
              ))}
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-2">Desde</label>
            <input
              type="date"
              className="w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 transition-all"
              value={from}
              onChange={(e) => setFrom(e.target.value)}
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700 mb-2">Hasta</label>
            <input
              type="date"
              className="w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 transition-all"
              value={to}
              onChange={(e) => setTo(e.target.value)}
            />
          </div>
        </div>
      </div>

      {/* Toggles de filtros */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="flex items-center gap-2">
          <input
            type="checkbox"
            id="mostrarBloqueados"
            checked={mostrarBloqueados}
            onChange={(e) => setMostrarBloqueados(e.target.checked)}
            className="rounded border-slate-300 text-fuchsia-600 focus:ring-fuchsia-500"
          />
          <label htmlFor="mostrarBloqueados" className="text-sm text-slate-600 cursor-pointer select-none">
            Mostrar turnos bloqueados desde Telegram
          </label>
        </div>

        <div className="flex items-center gap-2">
          <input
            type="checkbox"
            id="mostrarPasados"
            checked={mostrarPasados}
            onChange={(e) => setMostrarPasados(e.target.checked)}
            className="rounded border-slate-300 text-fuchsia-600 focus:ring-fuchsia-500"
          />
          <label htmlFor="mostrarPasados" className="text-sm text-slate-600 cursor-pointer select-none">
            Mostrar turnos pasados/hist√≥ricos
          </label>
        </div>
      </div>

      {/* Tabla - RESPONSIVE */}
      <div className="rounded-2xl border border-slate-200 bg-white shadow-sm">
        {/* Vista m√≥vil: cards */}
        <div className="block md:hidden">
          {loading && (
            <div className="p-4 text-slate-500 text-sm">Cargando‚Ä¶</div>
          )}

          {!loading && filtered.map((t) => {
            const horaDisplay = t.hora === "00:00:00" || t.hora === "00:00" ? "FH" : t.hora;

            return (
              <div key={t.id} className="border-b last:border-b-0 p-3">
                <div className="flex flex-col gap-2">
                  {/* Header con ID y estado */}
                  <div className="flex items-center justify-between gap-2">
                    <span className="font-mono text-xs font-semibold text-slate-900">#{t.id}</span>
                    {getEstadoBadge(t.estado, t.pagoConfirmado)}
                  </div>

                  {/* Fecha y Hora */}
                  <div className="flex items-center gap-3 text-sm">
                    <span className="font-medium text-slate-700">üìÖ {formatFecha(t.fecha)}</span>
                    {horaDisplay === "FH" ? (
                      <span className="inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-xs text-purple-800 font-medium">
                        FH
                      </span>
                    ) : (
                      <span className="text-slate-600">üïê {horaDisplay}</span>
                    )}
                  </div>

                  {/* Cliente */}
                  <div className="flex items-center gap-2">
                    <span className="font-medium text-slate-900">{t.clienteNombre}</span>
                    {t.grupoId && (
                      <span
                        className="inline-flex items-center gap-1 rounded-full bg-fuchsia-100 px-2 py-0.5 text-xs font-medium text-fuchsia-700"
                        title={`Grupo multi-sesi√≥n: ${t.grupoId.substring(0, 8)}...`}
                      >
                        <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        Multi
                      </span>
                    )}
                  </div>

                  {/* Tel√©fono */}
                  {t.clienteTelefono && (
                    <div className="text-xs text-slate-600">üìû {t.clienteTelefono}</div>
                  )}

                  {/* Barbero y Servicio */}
                  <div className="text-xs text-slate-600 space-y-1">
                    <div>üíà {t.barberoNombre || barberoName[t.barberoId] || `Barbero #${t.barberoId}`}</div>
                    <div>‚úÇÔ∏è {t.servicioNombre || tipoCorteName[t.tipoCorteId] || `Servicio #${t.tipoCorteId}`}</div>
                    {t.adicionales && t.adicionales.trim() !== "" && (
                      <div className="text-fuchsia-600">+ {t.adicionales}</div>
                    )}
                  </div>

                  {/* Montos */}
                  <div className="flex items-center gap-4 text-xs mt-1">
                    <div>
                      <span className="text-slate-500">Monto: </span>
                      {(t.montoPagado ?? 0) > 0 ? (
                        <span className="font-semibold text-slate-900">${t.montoPagado}</span>
                      ) : t.grupoId ? (
                        <span className="text-fuchsia-600 italic">Ver principal</span>
                      ) : (
                        <span className="text-slate-400">-</span>
                      )}
                    </div>
                    <div>
                      <span className="text-slate-500">Se√±a: </span>
                      {t.senia ? (
                        <span className="text-orange-600 font-medium">50%</span>
                      ) : (
                        <span className="text-slate-500">No</span>
                      )}
                    </div>
                    <div>
                      <span className="text-slate-500">Efectivo: </span>
                      {(t.montoEfectivo ?? 0) > 0 ? (
                        <span className="font-semibold text-slate-900">${t.montoEfectivo}</span>
                      ) : (
                        <span className="text-slate-400">-</span>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          })}

          {!loading && filtered.length === 0 && (
            <div className="p-8 text-center">
              <svg className="w-12 h-12 text-slate-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p className="text-sm text-slate-500 mb-1">Sin resultados</p>
              <p className="text-xs text-slate-400">No se encontraron turnos con los filtros aplicados</p>
            </div>
          )}
        </div>

        {/* Vista desktop: tabla */}
        <div className="hidden md:block overflow-x-auto">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-50 text-slate-700">
              <tr>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">#</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Fecha</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Hora</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Cliente</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Tel√©fono</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Barbero</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Servicio</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Adicionales</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Estado</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Monto</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Se√±a</th>
                <th className="px-3 py-3 text-left whitespace-nowrap text-xs font-semibold uppercase tracking-wider">Efectivo</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-100">
              {filtered.map((t) => {
                // Mostrar "FH" si la hora es 00:00:00 (fuera de horario)
                const horaDisplay = t.hora === "00:00:00" || t.hora === "00:00" ? "FH" : t.hora;

                return (
                <tr key={t.id} className="hover:bg-slate-50 transition-colors">
                  <td className="px-3 py-3">
                    <span className="font-mono text-xs font-semibold text-slate-900">#{t.id}</span>
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap text-slate-700">{formatFecha(t.fecha)}</td>
                  <td className="px-3 py-3 whitespace-nowrap">
                    {horaDisplay === "FH" ? (
                      <span className="inline-flex items-center rounded-full bg-purple-100 px-2 py-1 text-xs text-purple-800 font-medium">
                        FH
                      </span>
                    ) : (
                      <span className="text-slate-700">{horaDisplay}</span>
                    )}
                  </td>
                  <td className="px-3 py-3">
                    <div className="flex items-center gap-2">
                      <div className="font-medium text-slate-900">{t.clienteNombre}</div>
                      {t.grupoId && (
                        <span
                          className="inline-flex items-center gap-1 rounded-full bg-fuchsia-100 px-2 py-0.5 text-xs font-medium text-fuchsia-700"
                          title={`Grupo multi-sesi√≥n: ${t.grupoId.substring(0, 8)}...`}
                        >
                          <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                          </svg>
                          Multi
                        </span>
                      )}
                    </div>
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap text-slate-700">{t.clienteTelefono || "-"}</td>
                  <td className="px-3 py-3 text-slate-700">{t.barberoNombre || barberoName[t.barberoId] || t.barberoId}</td>
                  <td className="px-3 py-3 text-slate-700">{t.servicioNombre || tipoCorteName[t.tipoCorteId] || t.tipoCorteId}</td>
                  <td className="px-3 py-3 text-slate-700">
                    {t.adicionales && t.adicionales.trim() !== "" ? (
                      <span className="text-fuchsia-600 text-xs">+ {t.adicionales}</span>
                    ) : (
                      <span className="text-slate-400">-</span>
                    )}
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap">
                    {getEstadoBadge(t.estado, t.pagoConfirmado)}
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap">
                    {(t.montoPagado ?? 0) > 0 ? (
                      <span className="font-semibold text-slate-900">${t.montoPagado}</span>
                    ) : t.grupoId ? (
                      <span className="text-xs text-fuchsia-600 italic">Ver turno principal</span>
                    ) : (
                      <span className="text-slate-400">-</span>
                    )}
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap">
                    {t.senia ? (
                      <span className="text-orange-600 font-medium">S√≠ (50%)</span>
                    ) : t.grupoId && (t.montoPagado ?? 0) === 0 ? (
                      <span className="text-xs text-slate-400 italic">-</span>
                    ) : (
                      <span className="text-slate-500">No</span>
                    )}
                  </td>
                  <td className="px-3 py-3 whitespace-nowrap">
                    {(t.montoEfectivo ?? 0) > 0 ? (
                      <span className="font-semibold text-slate-900">${t.montoEfectivo}</span>
                    ) : t.grupoId && (t.montoPagado ?? 0) === 0 ? (
                      <span className="text-xs text-fuchsia-600 italic">Ver turno principal</span>
                    ) : (
                      <span className="text-slate-400">-</span>
                    )}
                  </td>
                </tr>
                );
              })}
              {filtered.length === 0 && (
                <tr>
                  <td colSpan={12} className="px-4 py-8 text-slate-500 text-center">
                    <div className="flex flex-col items-center gap-2">
                      <svg className="w-12 h-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      <p className="font-medium">Sin resultados</p>
                      <p className="text-sm text-slate-400">No se encontraron turnos con los filtros aplicados</p>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Paginaci√≥n - RESPONSIVE */}
      <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
        <div className="flex items-center gap-2 flex-wrap">
          <span className="text-sm text-slate-600">
            P√°g. {data.number + 1} de {Math.max(1, data.totalPages || 1)}
          </span>
          <CustomSelect
            className="w-32"
            value={String(size)}
            onChange={(value) => setSize(Number(value))}
            dropup={true}
            options={[
              { value: "10", label: "10 por p√°g." },
              { value: "20", label: "20 por p√°g." },
              { value: "50", label: "50 por p√°g." },
              { value: "100", label: "100 por p√°g." }
            ]}
          />
          <CustomSelect
            className="w-28"
            value={sort}
            onChange={(value) => setSort(value)}
            dropup={true}
            options={[
              { value: "fecha,desc", label: "Fecha ‚Üì" },
              { value: "fecha,asc", label: "Fecha ‚Üë" },
              { value: "id,desc", label: "ID ‚Üì" },
              { value: "id,asc", label: "ID ‚Üë" }
            ]}
          />
        </div>
        <div className="flex gap-2">
          <button
            className="rounded-lg border border-slate-300 px-3 py-2 text-sm hover:bg-slate-50 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
            onClick={() => load(page - 1)}
            disabled={page <= 0 || loading}
          >
            ‚Üê Anterior
          </button>
          <button
            className="rounded-lg border border-slate-300 px-3 py-2 text-sm hover:bg-slate-50 disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
            onClick={() => load(page + 1)}
            disabled={page + 1 >= (data.totalPages || 1) || loading}
          >
            Siguiente ‚Üí
          </button>
        </div>
      </div>
    </div>
  );
}

========== FILE: ./pages/Barberos.tsx ==========
import { useEffect, useMemo, useState } from "react";
import { BASE, RAW_URL, resolveUrl } from "../lib/adminApi";
import OptimizedImage from "../components/OptimizedImage";

type Barbero = {
  id: number;
  nombre: string;
  sucursalId: number;
  fotoUrl?: string | null;
  instagram?: string | null;
  facebook?: string | null;
};

type Sucursal = { id: number; nombre: string };

export default function Barberos() {
  const [barberos, setBarberos] = useState<Barbero[]>([]);
  const [sucursales, setSucursales] = useState<Sucursal[]>([]);
  const [filtro, setFiltro] = useState<number | "all">("all");
  const [loading, setLoading] = useState(true);
  const [err, setErr] = useState<string | null>(null);

  async function getJson<T>(url: string): Promise<T> {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }

  useEffect(() => {
    let alive = true;
    (async () => {
      setLoading(true);
      setErr(null);
      try {
        const [bs, ss] = await Promise.all([
          getJson<any>(`${BASE}/barberos`),
          getJson<any>(`${BASE}/sucursales`),
        ]);
        const listB: Barbero[] = Array.isArray(bs?.content) ? bs.content : (Array.isArray(bs) ? bs : []);
        const listS: Sucursal[] = Array.isArray(ss) ? ss : [];
        if (!alive) return;
        setBarberos(listB);
        setSucursales(listS);
      } catch (e: any) {
        if (!alive) return;
        setErr(e?.message || "Error cargando barberos");
      } finally {
        if (alive) setLoading(false);
      }
    })();
    return () => { alive = false; };
  }, []);

  const nombreSucursal = (id: number) =>
    sucursales.find(s => s.id === id)?.nombre || "‚Äî";

  const imgSrc = (b: Barbero) => {
    if (b.fotoUrl) return `${resolveUrl(b.fotoUrl)}?ts=${b.fotoUrl.length}`;
    return `${RAW_URL}/barberos/${b.id}/foto`;
  };

  // Lista a mostrar seg√∫n filtro
  const listaFiltrada = useMemo(() => {
    if (filtro === "all") return [...barberos].sort((a, b) => a.nombre.localeCompare(b.nombre));
    return barberos.filter(b => b.sucursalId === filtro);
  }, [barberos, filtro]);

  return (
    <div className="max-w-6xl mx-auto px-4 py-8 space-y-6">
      {/* Header responsive */}
      <header className="space-y-4">
        <div>
          <h1 className="text-3xl font-bold">Nuestros barberos</h1>
          <p className="text-slate-600">
            {filtro === "all" ? "Todas las sucursales" : nombreSucursal(Number(filtro))} ‚Äî {listaFiltrada.length} barbero(s)
          </p>
        </div>

        {/* Filtro moderno con botones tipo pill */}
        <div className="flex flex-wrap gap-2">
          <button
            onClick={() => setFiltro("all")}
            className={`px-4 py-2 rounded-full font-medium text-sm transition-all duration-200 ${
              filtro === "all"
                ? "bg-fuchsia-600 text-white shadow-md"
                : "bg-slate-100 text-slate-700 hover:bg-slate-200"
            }`}
          >
            Todas
          </button>
          {sucursales.map(s => (
            <button
              key={s.id}
              onClick={() => setFiltro(s.id)}
              className={`px-4 py-2 rounded-full font-medium text-sm transition-all duration-200 ${
                filtro === s.id
                  ? "bg-fuchsia-600 text-white shadow-md"
                  : "bg-slate-100 text-slate-700 hover:bg-slate-200"
              }`}
            >
              {s.nombre}
            </button>
          ))}
        </div>
      </header>

      {err && (
        <div className="rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-red-700">
          {err}
        </div>
      )}
      {loading && <p className="text-slate-500">Cargando‚Ä¶</p>}

      {/* UNA grilla para ‚ÄúTodas‚Äù */}
      {!loading && filtro === "all" && (
        <div className="grid gap-5 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4">
          {listaFiltrada.map(b => (
            <CardBarbero
              key={b.id}
              b={b}
              nombreSucursal={nombreSucursal}
              imgSrc={imgSrc(b)}
            />
          ))}
          {listaFiltrada.length === 0 && (
            <p className="text-slate-500">No hay barberos para mostrar.</p>
          )}
        </div>
      )}

      {/* Una sucursal espec√≠fica */}
      {!loading && filtro !== "all" && (
        <>
          <h2 className="text-xl font-semibold">{nombreSucursal(Number(filtro))}</h2>
          {listaFiltrada.length === 0 ? (
            <p className="text-slate-500">Sin barberos en esta sucursal.</p>
          ) : (
            <div className="grid gap-5 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4">
              {listaFiltrada.map(b => (
                <CardBarbero
                  key={b.id}
                  b={b}
                  nombreSucursal={nombreSucursal}
                  imgSrc={imgSrc(b)}
                />
              ))}
            </div>
          )}
        </>
      )}
    </div>
  );
}

/** Tarjeta responsive del barbero */
function CardBarbero({
  b,
  nombreSucursal,
}: {
  b: Barbero;
  nombreSucursal: (id: number) => string;
  imgSrc: string;
}) {
  return (
    <article className="rounded-2xl border bg-white p-5 shadow-sm">
      {/* En m√≥vil: columna (img arriba). Desde sm: fila (img izquierda). */}
      <div className="flex flex-col items-center gap-4">
        {b.fotoUrl ? (
          <OptimizedImage
            src={resolveUrl(b.fotoUrl)!}
            alt={`Foto de ${b.nombre}`}
            className="h-28 w-28 md:h-32 md:w-32 rounded-full object-cover border shrink-0"
            width={128}
            height={128}
            loading="lazy"
          />
        ) : (
          <div className="h-28 w-28 md:h-32 md:w-32 rounded-full bg-slate-200 grid place-items-center text-xs text-slate-600 border shrink-0">
            Sin foto
          </div>
        )}
        <div className="text-center w-full">
          <h3 className="font-semibold text-base md:text-lg leading-snug mb-1">{b.nombre}</h3>
          <p className="text-slate-500 text-sm mb-2">{nombreSucursal(b.sucursalId)}</p>
          <div className="flex flex-wrap justify-center gap-x-4 gap-y-1 text-sm">
            {b.instagram && (
              <a
                href={b.instagram}
                target="_blank"
                rel="noreferrer"
                className="text-fuchsia-600 hover:underline"
              >
                Instagram
              </a>
            )}
            {b.facebook && (
              <a
                href={b.facebook}
                target="_blank"
                rel="noreferrer"
                className="text-fuchsia-600 hover:underline"
              >
                Facebook
              </a>
            )}
          </div>
        </div>
      </div>
    </article>
  );
}



========== FILE: ./pages/Inicio.tsx ==========
import SocialLinks from '../components/SocialLinks'
import { Link } from 'react-router-dom'

export default function Inicio() {
  return (
    <section className="relative min-h-screen w-full grid place-items-center overflow-hidden">
      {/* VIDEO DE FONDO - 100% de la pantalla */}
      <video
        className="absolute inset-0 w-full h-full object-cover object-center
                   [filter:grayscale(var(--hero-gray,0.8))_blur(var(--hero-blur,3px))]"
        src="/media/Video-optimized.mp4"
        autoPlay
        muted
        loop
        playsInline
        preload="metadata"
        aria-hidden="true"
      />

      {/* OVERLAYS: oscurecer + degradado para mejor legibilidad */}
      <div className="absolute inset-0 bg-black/45"></div>
      <div className="absolute inset-0 pointer-events-none bg-gradient-to-b from-black/10 via-transparent to-black/60"></div>

      {/* CONTENIDO */}
      <div className="relative z-10 text-center text-white px-4">
        <h1 className="text-4xl md:text-5xl font-bold mb-4 leading-tight">
          Bienvenidos a <span className="text-fuchsia-400">Cromados</span>
        </h1>
        <p className="text-lg text-white/90 max-w-2xl mx-auto mb-8">
          Tu estilo, nuestro compromiso. Reserv√° tu turno f√°cil y r√°pido.
        </p>
        <div className="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Link
            to="/turnos"
            className="px-6 py-3 bg-fuchsia-600 hover:bg-fuchsia-700 rounded-xl font-semibold shadow-lg transition-all"
          >
            Reservar Turno
          </Link>
          <SocialLinks />
        </div>
      </div>

      {/* COPYRIGHT sobre el video */}
      <div className="absolute bottom-0 left-0 right-0 py-6 text-center z-20">
        <p className="text-xs sm:text-sm text-white/90">
          &copy; {new Date().getFullYear()} <span className="font-semibold">Cromados</span>. Todos los derechos reservados.
        </p>
      </div>
    </section>
  )
}



========== FILE: ./pages/Nosotros.tsx ==========
// src/pages/Nosotros.tsx
export default function Nosotros() {
  return (
    <div className="min-h-screen bg-white">
      {/* Hero corto */}
      <section className="max-w-5xl mx-auto px-4 sm:px-6 pt-6 sm:pt-8 pb-6 sm:pb-8 text-center">
        <h1 className="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight">
          Conoc√© <span className="text-fuchsia-600">Cromados</span>
        </h1>
        <p className="mt-3 sm:mt-4 text-base sm:text-lg text-slate-600 max-w-2xl mx-auto px-2">
          Una barber√≠a de barrio con coraz√≥n, detalle y oficio. Un lugar pensado para disfrutar el momento.
        </p>
      </section>

      {/* Due√±os / fundadores */}
      <section className="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
        <div className="grid gap-4 sm:gap-6 lg:grid-cols-[1fr_1fr_1.5fr] items-start">
          {/* Foto vertical */}
          <div className="rounded-2xl overflow-hidden bg-slate-200 aspect-[3/4]">
            <img
              src="/fundadores-main.jpg"
              alt="Fundadores de Cromados"
              className="w-full h-full object-cover"
              onError={(e) => {
                (e.currentTarget as HTMLImageElement).src = "/placeholder-wide.jpg";
              }}
            />
          </div>

          {/* Video vertical en bucle sin controles */}
          <div className="rounded-2xl overflow-hidden bg-slate-200 aspect-[3/4]">
            <video
              className="w-full h-full object-cover"
              autoPlay
              loop
              muted
              playsInline
            >
              <source src="/video-cromados.mp4" type="video/mp4" />
            </video>
          </div>

          {/* Texto de presentaci√≥n a la derecha */}
          <div className="px-2">
            <h2 className="text-xl sm:text-2xl font-semibold">Qui√©nes somos</h2>
            <p className="mt-3 sm:mt-4 text-sm sm:text-base text-slate-700 leading-relaxed">
              Somos <span className="font-medium">Facu y Bruno</span>, fundadores de Cromados.
              Empezamos con una idea simple: ofrecer una experiencia de barber√≠a honesta, moderna y c√≥moda,
              donde cada visita se sienta como una pausa en el d√≠a.
            </p>
            <p className="mt-3 text-sm sm:text-base text-slate-700 leading-relaxed">
              En nuestro espacio vas a encontrar <span className="font-medium">t√©cnica, escucha y detalle</span>.
              Creemos en el trato cercano y en construir una relaci√≥n a largo plazo con cada cliente.
            </p>

            {/* Datos breves / highlights */}
            <div className="mt-5 sm:mt-6 grid grid-cols-3 gap-2 sm:gap-3">
              <div className="rounded-xl sm:rounded-2xl border bg-white p-3 sm:p-4">
                <div className="text-xs sm:text-sm text-slate-500">Desde</div>
                <div className="text-lg sm:text-xl font-semibold">2017</div>
              </div>
              <div className="rounded-xl sm:rounded-2xl border bg-white p-3 sm:p-4">
                <div className="text-xs sm:text-sm text-slate-500">Especialidad</div>
                <div className="text-sm sm:text-xl font-semibold leading-tight">Fades & Barbas</div>
              </div>
              <div className="rounded-xl sm:rounded-2xl border bg-white p-3 sm:p-4">
                <div className="text-xs sm:text-sm text-slate-500">Ciudad</div>
                <div className="text-sm sm:text-xl font-semibold leading-tight">Alta Gracia</div>
              </div>
            </div>

            {/* Valores */}
            <div className="mt-5 sm:mt-6">
              <h3 className="font-semibold text-base sm:text-lg">Nuestros valores</h3>
              <ul className="mt-3 space-y-2 text-sm sm:text-base text-slate-700">
                <li>‚Ä¢ Atenci√≥n personalizada y honesta.</li>
                <li>‚Ä¢ Puntualidad y respeto por tu tiempo.</li>
                <li>‚Ä¢ Detalle t√©cnico en cada corte y barba.</li>
                <li>‚Ä¢ Ambiente c√°lido y relajado.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* Franja de texto (opcional) */}
      <section className="px-4 sm:px-6">
        <div className="max-w-4xl mx-auto rounded-2xl sm:rounded-3xl bg-fuchsia-50 border border-fuchsia-100 p-5 sm:p-6 text-center">
          <p className="text-sm sm:text-base text-slate-700 leading-relaxed">
            "Cromados es nuestro lugar en el mundo. Queremos que tambi√©n sea el tuyo cada vez que te sientes en la silla."
          </p>
        </div>
      </section>

      {/* CTA final */}
      <section className="py-12 sm:py-16 text-center px-4">
        <h2 className="text-xl sm:text-2xl font-semibold mb-3 sm:mb-4">¬øListo para tu pr√≥ximo look?</h2>
        <p className="text-sm sm:text-base text-slate-600 mb-5 sm:mb-6 max-w-md mx-auto">
          Reserv√° tu turno online y viv√≠ la experiencia Cromados.
        </p>
        <a
          href="/turnos"
          className="inline-block rounded-xl bg-fuchsia-600 px-6 py-3 text-sm sm:text-base text-white font-semibold hover:bg-fuchsia-700 transition"
        >
          Reservar turno
        </a>
      </section>
    </div>
  );
}


========== FILE: ./pages/Privacidad.tsx ==========
// src/pages/Privacidad.tsx
export default function Privacidad() {
  return (
    <div className="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-8">
          Pol√≠tica de Privacidad
        </h1>

        <p className="text-sm text-gray-600 mb-8">
          √öltima actualizaci√≥n: 1 de noviembre de 2025
        </p>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            1. Informaci√≥n que Recopilamos
          </h2>
          <p className="text-gray-700 mb-4">
            En Cromados, recopilamos la siguiente informaci√≥n cuando reserv√°s un turno:
          </p>
          <ul className="list-disc pl-6 text-gray-700 space-y-2">
            <li><strong>Nombre y apellido</strong>: Para identificar tu reserva</li>
            <li><strong>N√∫mero de tel√©fono</strong>: Para enviarte confirmaciones y recordatorios por WhatsApp</li>
            <li><strong>Edad</strong>: Para cumplir con requisitos regulatorios</li>
            <li><strong>Informaci√≥n de la reserva</strong>: Fecha, hora, servicio seleccionado, barbero y sucursal</li>
            <li><strong>Informaci√≥n de pago</strong>: Procesada de forma segura a trav√©s de Mercado Pago (no almacenamos datos de tarjetas)</li>
          </ul>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            2. C√≥mo Usamos tu Informaci√≥n
          </h2>
          <p className="text-gray-700 mb-4">
            Utilizamos tu informaci√≥n personal para:
          </p>
          <ul className="list-disc pl-6 text-gray-700 space-y-2">
            <li>Procesar y confirmar tus reservas de turnos</li>
            <li>Enviarte confirmaciones y recordatorios por WhatsApp</li>
            <li>Notificar a nuestros barberos sobre nuevas reservas</li>
            <li>Procesar pagos de manera segura a trav√©s de Mercado Pago</li>
            <li>Mejorar nuestros servicios y experiencia del cliente</li>
            <li>Cumplir con requisitos legales y regulatorios</li>
          </ul>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            3. Comunicaciones por WhatsApp
          </h2>
          <p className="text-gray-700 mb-4">
            Al proporcionar tu n√∫mero de tel√©fono y completar una reserva, acept√°s recibir:
          </p>
          <ul className="list-disc pl-6 text-gray-700 space-y-2">
            <li>Confirmaci√≥n de tu turno por WhatsApp</li>
            <li>Recordatorios de tu pr√≥ximo turno (enviados 8 horas antes)</li>
            <li>Notificaciones sobre cambios o cancelaciones (si aplicable)</li>
          </ul>
          <p className="text-gray-700 mt-4">
            Utilizamos WhatsApp Business API de Meta para estas comunicaciones.
            No compartimos tu n√∫mero con terceros ni enviamos publicidad no solicitada.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            4. Compartir Informaci√≥n con Terceros
          </h2>
          <p className="text-gray-700 mb-4">
            Compartimos tu informaci√≥n √∫nicamente con:
          </p>
          <ul className="list-disc pl-6 text-gray-700 space-y-2">
            <li>
              <strong>Mercado Pago</strong>: Para procesar pagos de forma segura.
              Consult√° la <a href="https://www.mercadopago.com.ar/privacidad" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                pol√≠tica de privacidad de Mercado Pago
              </a>.
            </li>
            <li>
              <strong>Meta (WhatsApp)</strong>: Para enviar mensajes de confirmaci√≥n y recordatorios.
              Consult√° la <a href="https://www.whatsapp.com/legal/privacy-policy" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">
                pol√≠tica de privacidad de WhatsApp
              </a>.
            </li>
          </ul>
          <p className="text-gray-700 mt-4">
            <strong>No vendemos ni alquilamos</strong> tu informaci√≥n personal a terceros.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            5. Seguridad de la Informaci√≥n
          </h2>
          <p className="text-gray-700">
            Implementamos medidas de seguridad t√©cnicas y organizativas para proteger
            tu informaci√≥n personal contra acceso no autorizado, p√©rdida o alteraci√≥n.
            Sin embargo, ning√∫n m√©todo de transmisi√≥n por Internet es 100% seguro.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            6. Retenci√≥n de Datos
          </h2>
          <p className="text-gray-700">
            Conservamos tu informaci√≥n personal durante el tiempo necesario para
            cumplir con los prop√≥sitos descritos en esta pol√≠tica, incluyendo
            requisitos legales, contables o de informes.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            7. Tus Derechos
          </h2>
          <p className="text-gray-700 mb-4">
            Seg√∫n la legislaci√≥n argentina de protecci√≥n de datos personales, ten√©s derecho a:
          </p>
          <ul className="list-disc pl-6 text-gray-700 space-y-2">
            <li>Acceder a tus datos personales</li>
            <li>Rectificar datos inexactos o incompletos</li>
            <li>Solicitar la eliminaci√≥n de tus datos</li>
            <li>Oponerte al procesamiento de tus datos</li>
            <li>Retirar tu consentimiento en cualquier momento</li>
          </ul>
          <p className="text-gray-700 mt-4">
            Para ejercer estos derechos, contactanos a trav√©s de nuestros canales oficiales.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            8. Cookies y Tecnolog√≠as Similares
          </h2>
          <p className="text-gray-700">
            Utilizamos cookies esenciales para el funcionamiento del sitio web
            (autenticaci√≥n, carrito de compra). No utilizamos cookies de seguimiento
            ni publicidad de terceros.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            9. Menores de Edad
          </h2>
          <p className="text-gray-700">
            Nuestros servicios est√°n dirigidos a personas mayores de 4 a√±os.
            Si sos menor de 18 a√±os, necesit√°s el consentimiento de un padre o tutor
            para utilizar nuestros servicios.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            10. Cambios a esta Pol√≠tica
          </h2>
          <p className="text-gray-700">
            Podemos actualizar esta pol√≠tica de privacidad ocasionalmente.
            Te notificaremos sobre cambios significativos publicando la nueva pol√≠tica
            en esta p√°gina con una fecha de "√∫ltima actualizaci√≥n" revisada.
          </p>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            11. Contacto
          </h2>
          <p className="text-gray-700 mb-4">
            Si ten√©s preguntas sobre esta pol√≠tica de privacidad o sobre c√≥mo
            manejamos tu informaci√≥n personal, pod√©s contactarnos:
          </p>
          <ul className="list-none text-gray-700 space-y-2">
            <li><strong>Sitio web</strong>: <a href="https://cromados.uno" className="text-blue-600 hover:underline">cromados.uno</a></li>
            <li><strong>WhatsApp</strong>: +54 9 3547 509878 / +54 9 3547 468607</li>
          </ul>
        </section>

        <section className="mb-8">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">
            12. Legislaci√≥n Aplicable
          </h2>
          <p className="text-gray-700">
            Esta pol√≠tica de privacidad se rige por la{" "}
            <strong>Ley de Protecci√≥n de Datos Personales N¬∞ 25.326</strong> de Argentina
            y normativas complementarias.
          </p>
        </section>

        <div className="mt-12 pt-8 border-t border-gray-200">
          <p className="text-center text-gray-600">
            Cromados - Barber√≠a
          </p>
          <p className="text-center text-sm text-gray-500 mt-2">
            Villa Mar√≠a, C√≥rdoba, Argentina
          </p>
        </div>
      </div>
    </div>
  );
}


========== FILE: ./pages/Turnos.tsx ==========
import { ensureCsrf, getCsrfCookie } from "../lib/authApi";
import { useEffect, useMemo, useState, useRef } from "react";
import { BASE, RAW_URL, resolveUrl } from "../lib/adminApi";
import { useToast } from '../components/Toast';
import IntroSucursales from "../components/IntroSucursales";
import DatosClienteModal from "../components/DatosClienteModal";

/** ===== Tipos p√∫blicos ===== */
type SucursalDTO = { id: number; nombre: string; direccion: string; fotoUrl?: string | null };
type BarberoDTO = { id: number; nombre: string; sucursalId: number; fotoUrl?: string | null };
type ServicioDTO = {
  id: number;
  nombre: string;
  precio: number;
  duracionMin: number;
  descripcion?: string | null;
  sesiones?: number | null;
  adicional: boolean;
};

type ClienteForm = { nombre: string; edad: number; telefono: string };

// Datos de cada sesi√≥n
type SesionData = {
  fecha: string | null;
  hora: string | null;
  adicionalesIds: number[];
};

/** ===== Helpers ===== */
async function getJSON<T>(url: string): Promise<T> {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status} ‚Äî ${url}`);
  return res.json();
}

const PublicApi = {
  async sucursales(): Promise<SucursalDTO[]> {
    return getJSON(`${BASE}/sucursales`);
  },
  async barberosBySucursal(sucursalId: number): Promise<BarberoDTO[]> {
    return getJSON(`${BASE}/barberos?sucursalId=${sucursalId}`);
  },
  async servicios(barberoId?: number): Promise<ServicioDTO[]> {
    const url = barberoId
      ? `${BASE}/servicios?barberoId=${barberoId}`
      : `${BASE}/servicios`;
    return getJSON(url);
  },
};

type DayOpt = { iso: string; label: string };

function buildMonthDays(year: number, monthIdx0: number): DayOpt[] {
  const out: DayOpt[] = [];
  const d = new Date(year, monthIdx0, 1);
  const fmt = (x: Date) =>
    x.toLocaleDateString("es-AR", { weekday: "short", day: "2-digit", month: "short" });
  const pad = (n: number) => String(n).padStart(2, "0");
  while (d.getMonth() === monthIdx0) {
    const iso = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
    out.push({ iso, label: fmt(d) });
    d.setDate(d.getDate() + 1);
  }
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  return out.filter((opt) => {
    const dd = dateFromISOLocal(opt.iso);
    dd.setHours(0, 0, 0, 0);
    return dd >= today;
  });
}

function dateFromISOLocal(yyyy_mm_dd: string): Date {
  const [y, m, d] = yyyy_mm_dd.split("-").map(Number);
  return new Date(y, m - 1, d);
}

/** ===== Componente principal ===== */
export default function Turnos() {
  const toast = useToast();
  const [introVisible, setIntroVisible] = useState(true);
  const topRef = useRef<HTMLDivElement>(null);
  const confirmarButtonRef = useRef<HTMLButtonElement>(null);
  const [shouldHighlight, setShouldHighlight] = useState(false);

  // Datos maestros
  const [sucursales, setSucursales] = useState<SucursalDTO[]>([]);
  const [barberos, setBarberos] = useState<BarberoDTO[]>([]);
  const [servicios, setServicios] = useState<ServicioDTO[]>([]);

  // Selecci√≥n del flujo
  const [step, setStep] = useState<number>(1);
  const [sucursalId, setSucursalId] = useState<number | null>(null);
  const [barberoId, setBarberoId] = useState<number | null>(null);
  const [servicioPrincipalId, setServicioPrincipalId] = useState<number | null>(null);

  // Datos de sesiones (una por cada sesi√≥n del servicio)
  const [sesiones, setSesiones] = useState<SesionData[]>([]);

  // Cliente
  const [senia, setSenia] = useState(false);
  const [showDatosModal, setShowDatosModal] = useState(false);

  // Calendario para sesi√≥n actual
  const [monthOffset, setMonthOffset] = useState(0);
  const [weekOpenDays, setWeekOpenDays] = useState<Set<number>>(new Set([1, 2, 3, 4, 5, 6]));
  const [horasDisponibles, setHorasDisponibles] = useState<string[]>([]);
  const [diasConHorarios, setDiasConHorarios] = useState<Set<string>>(new Set());
  const [autoAdvanced, setAutoAdvanced] = useState(false);

  // Errores
  const [err, setErr] = useState<string | null>(null);

  // ================== Computed ==================
  const servicioPrincipal = servicios.find(s => s.id === servicioPrincipalId);
  const numSesiones = servicioPrincipal?.sesiones || 1;
  const totalSteps = 3 + numSesiones; // 1:Sucursal, 2:Barbero, 3:Servicio, 4+:Sesiones

  const sucursalSeleccionada = sucursales.find(s => s.id === sucursalId);
  const barberoSeleccionado = barberos.find(b => b.id === barberoId);
  const servicesAdicionales = servicios.filter(s => s.adicional);

  // Calcular total
  const totalImporte = useMemo(() => {
    let total = servicioPrincipal?.precio || 0;
    sesiones.forEach(sesion => {
      sesion.adicionalesIds.forEach(addId => {
        const add = servicios.find(s => s.id === addId);
        if (add) total += add.precio;
      });
    });
    return total;
  }, [servicioPrincipal, sesiones, servicios]);

  const montoAPagar = senia ? Math.round(totalImporte * 0.5) : totalImporte;
  const montoRestante = totalImporte - montoAPagar;

  // Validar si todo est√° completo
  const todoCompleto = useMemo(() => {
    if (!sucursalId || !barberoId || !servicioPrincipalId) return false;
    // Verificar que todas las sesiones tengan fecha y hora
    for (let i = 0; i < numSesiones; i++) {
      const ses = sesiones[i];
      if (!ses || !ses.fecha || !ses.hora) return false;
    }
    return true;
  }, [sucursalId, barberoId, servicioPrincipalId, sesiones, numSesiones]);

  // ================== Effects ==================
  useEffect(() => {
    (async () => {
      try {
        setErr(null);
        const [s, servs] = await Promise.all([
          PublicApi.sucursales(),
          PublicApi.servicios()
        ]);
        setSucursales(s);
        setServicios(servs);
      } catch (e: any) {
        setErr(e?.message || "Error cargando datos.");
      }
    })();
  }, []);

  useEffect(() => {
    (async () => {
      if (!sucursalId) {
        setBarberos([]);
        return;
      }
      try {
        setBarberos(await PublicApi.barberosBySucursal(sucursalId));
      } catch (e: any) {
        setErr(e?.message || "Error cargando barberos.");
      }
    })();
  }, [sucursalId]);

  // Recargar servicios cuando cambia el barbero seleccionado
  useEffect(() => {
    (async () => {
      if (!barberoId) {
        // Si no hay barbero seleccionado, mostrar todos los servicios
        try {
          setServicios(await PublicApi.servicios());
        } catch (e: any) {
          setErr(e?.message || "Error cargando servicios.");
        }
        return;
      }
      try {
        // Filtrar servicios seg√∫n el barbero seleccionado
        setServicios(await PublicApi.servicios(barberoId));
      } catch (e: any) {
        setErr(e?.message || "Error cargando servicios del barbero.");
      }
    })();
  }, [barberoId]);

  // Traer horarios del barbero
  useEffect(() => {
    (async () => {
      if (!barberoId) {
        setWeekOpenDays(new Set([1, 2, 3, 4, 5, 6]));
        return;
      }
      try {
        const res = await fetch(`${BASE}/barberos/${barberoId}/horarios-semana`);
        if (!res.ok) throw new Error();
        const arr: Array<{ diaSemana: number; inicio: string; fin: string }> = await res.json();

        const days = new Set<number>();

        for (const h of arr) {
          const n = Number(h.diaSemana);
          const dow = n === 0 ? 7 : n;
          days.add(dow);
        }

        setWeekOpenDays(days);
      } catch {
        // defaults
      }
    })();
  }, [barberoId]);

  // Inicializar sesiones cuando se selecciona servicio principal
  useEffect(() => {
    if (servicioPrincipalId) {
      const num = servicioPrincipal?.sesiones || 1;
      const newSesiones: SesionData[] = [];
      for (let i = 0; i < num; i++) {
        newSesiones.push({
          fecha: null,
          hora: null,
          adicionalesIds: []
        });
      }
      setSesiones(newSesiones);
    }
  }, [servicioPrincipalId]);

  // Cargar disponibilidad para la sesi√≥n actual
  useEffect(() => {
    (async () => {
      if (!barberoId || step < 4) {
        setHorasDisponibles([]);
        return;
      }

      const sesionIdx = step - 4;
      if (sesionIdx >= numSesiones || sesionIdx < 0) {
        setHorasDisponibles([]);
        return;
      }

      const fechaSesion = sesiones[sesionIdx]?.fecha;
      if (!fechaSesion) {
        setHorasDisponibles([]);
        return;
      }

      try {
        const res = await fetch(`${BASE}/disponibilidad?barberoId=${barberoId}&fecha=${fechaSesion}`);
        if (!res.ok) return;
        const horas: string[] = await res.json();
        setHorasDisponibles(horas);

        // Actualizar set de d√≠as con horarios
        if (horas.length > 0) {
          setDiasConHorarios(prev => new Set(prev).add(fechaSesion));
        } else {
          setDiasConHorarios(prev => {
            const newSet = new Set(prev);
            newSet.delete(fechaSesion);
            return newSet;
          });
        }
      } catch {
        setHorasDisponibles([]);
      }
    })();
  }, [barberoId, step, sesiones, numSesiones]);

  // Pre-cargar disponibilidad de d√≠as del mes
  useEffect(() => {
    (async () => {
      if (!barberoId || step < 4) return;

      const base = new Date();
      base.setDate(1);
      base.setMonth(base.getMonth() + monthOffset);
      const dias = buildMonthDays(base.getFullYear(), base.getMonth()).filter((opt) => {
        const dd = dateFromISOLocal(opt.iso).getDay();
        const dow = dd === 0 ? 7 : dd;
        return weekOpenDays.has(dow);
      });

      const nuevosDiasConHorarios = new Set<string>();

      // Consultar disponibilidad de cada d√≠a en paralelo
      await Promise.all(
        dias.map(async (d) => {
          try {
            const res = await fetch(`${BASE}/disponibilidad?barberoId=${barberoId}&fecha=${d.iso}`);
            if (res.ok) {
              const horas: string[] = await res.json();
              if (horas.length > 0) {
                nuevosDiasConHorarios.add(d.iso);
              }
            }
          } catch {
            // ignorar errores
          }
        })
      );

      setDiasConHorarios(nuevosDiasConHorarios);

      // Si el mes actual no tiene d√≠as con horarios Y no hemos avanzado autom√°ticamente todav√≠a, avanzar al siguiente
      if (nuevosDiasConHorarios.size === 0 && monthOffset < 12 && !autoAdvanced) {
        setMonthOffset(monthOffset + 1);
        setAutoAdvanced(true);
      }
    })();
  }, [barberoId, monthOffset, step, weekOpenDays, autoAdvanced]);

  // Resetear cuando cambia el barbero o cuando entra al step de fecha (step 4)
  useEffect(() => {
    if (step === 4) {
      setAutoAdvanced(false);
      setMonthOffset(0);
    }
  }, [barberoId, step]);

  // Auto-scroll al cambiar de paso
  useEffect(() => {
    if (topRef.current) {
      topRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [step]);

  const monthDays = useMemo(() => {
    const base = new Date();
    base.setDate(1);
    base.setMonth(base.getMonth() + monthOffset);
    return buildMonthDays(base.getFullYear(), base.getMonth()).filter((opt) => {
      const dd = dateFromISOLocal(opt.iso).getDay();
      const dow = dd === 0 ? 7 : dd;
      // Solo mostrar d√≠as laborables Y que tengan horarios disponibles
      return weekOpenDays.has(dow) && diasConHorarios.has(opt.iso);
    });
  }, [monthOffset, weekOpenDays, diasConHorarios]);

  const labelMes = useMemo(() => {
    const base = new Date();
    base.setMonth(base.getMonth() + monthOffset);
    return base.toLocaleDateString("es-AR", { month: "long", year: "numeric" });
  }, [monthOffset]);

  // ================== Handlers ==================
  const irSiguiente = () => {
    if (step < totalSteps) {
      setStep(step + 1);
    } else if (step === totalSteps) {
      // √öltimo paso completado - hacer scroll al bot√≥n o brillar
      if (confirmarButtonRef.current) {
        const isMobile = window.innerWidth < 1024; // lg breakpoint

        if (isMobile) {
          // Mobile: scroll al bot√≥n
          confirmarButtonRef.current.scrollIntoView({
            behavior: 'smooth',
            block: 'center'
          });
        } else {
          // Desktop: hacer brillar el bot√≥n
          setShouldHighlight(true);
          setTimeout(() => setShouldHighlight(false), 2000);
        }
      }
    }
  };

  const irAnterior = () => {
    if (step > 1) {
      // Borrar datos del step actual al retroceder
      if (step === 2) {
        // Retrocede de barbero -> borrar barbero
        setBarberoId(null);
      } else if (step === 3) {
        // Retrocede de servicio -> borrar servicio y sesiones
        setServicioPrincipalId(null);
        setSesiones([]);
      } else if (step >= 4) {
        // Retrocede de alguna sesi√≥n -> borrar datos de esa sesi√≥n
        const sesionIdx = step - 4;
        if (sesionIdx >= 0 && sesionIdx < sesiones.length) {
          const newSesiones = [...sesiones];
          newSesiones[sesionIdx] = {
            fecha: null,
            hora: null,
            adicionalesIds: []
          };
          setSesiones(newSesiones);
        }
      }
      setStep(step - 1);
    }
  };

  const toggleAdicionalSesion = (sesionIdx: number, servicioId: number) => {
    const newSesiones = [...sesiones];
    const sesion = newSesiones[sesionIdx];
    if (sesion.adicionalesIds.includes(servicioId)) {
      sesion.adicionalesIds = sesion.adicionalesIds.filter(id => id !== servicioId);
    } else {
      sesion.adicionalesIds = [...sesion.adicionalesIds, servicioId];
    }
    setSesiones(newSesiones);
  };

  const selectFechaSesion = (sesionIdx: number, iso: string) => {
    const newSesiones = [...sesiones];
    newSesiones[sesionIdx].fecha = iso;
    newSesiones[sesionIdx].hora = null; // Resetear hora al cambiar fecha
    setSesiones(newSesiones);
  };

  const selectHoraSesion = (sesionIdx: number, h: string) => {
    const newSesiones = [...sesiones];
    newSesiones[sesionIdx].hora = h;
    setSesiones(newSesiones);
  };

  const confirmar = async () => {
    if (!todoCompleto) {
      toast("Complet√° todos los pasos antes de confirmar.");
      return;
    }
    setShowDatosModal(true);
  };

  const pagar = async (datos: ClienteForm) => {
    setShowDatosModal(false);

    if (!servicioPrincipalId || !sucursalId || !barberoId || !todoCompleto) {
      toast("Faltan datos de la reserva.");
      return;
    }

    const clean = {
      nombre: datos.nombre.trim(),
      telefono: datos.telefono,
      edad: Number(datos.edad),
    };

    if (!clean.nombre || !clean.telefono || !clean.edad) {
      toast("Complet√° todos tus datos.");
      return;
    }

    try {
      await ensureCsrf();
      const csrfToken = getCsrfCookie();

      // Construir payload con m√∫ltiples sesiones
      const turnosSesiones = sesiones.map((sesion) => ({
        fecha: sesion.fecha!,
        hora: sesion.hora!,
        adicionalesIds: sesion.adicionalesIds.length > 0 ? sesion.adicionalesIds : null
      }));

      const body = {
        sucursalId,
        barberoId,
        tipoCorteId: servicioPrincipalId,
        sesiones: turnosSesiones, // Array de sesiones
        clienteNombre: clean.nombre,
        clienteTelefono: clean.telefono,
        clienteEdad: clean.edad,
        senia,
      };

      const res = await fetch(`${RAW_URL}/pagos/checkout`, {
        method: "POST",
        headers: { "Content-Type": "application/json", "X-CSRF-Token": csrfToken },
        body: JSON.stringify(body),
        credentials: "include",
      });

      if (!res.ok) {
        const txt = await res.text();
        throw new Error(txt || "Error al crear la preferencia de pago.");
      }

      const data = await res.json();
      if (data.initPoint) {
        window.location.href = data.initPoint;
      } else {
        throw new Error("No se recibi√≥ el initPoint de Mercado Pago.");
      }
    } catch (e: any) {
      console.error(e);
      toast(e?.message || "Error al crear la preferencia de pago.");
    }
  };

  // ================== Render ==================
  return (
    <div className="min-h-screen bg-white">
      {introVisible && (
        <IntroSucursales onSelect={(id) => { setSucursalId(id); setStep(2); setIntroVisible(false); }} />
      )}

      <div ref={topRef} className="mx-auto max-w-7xl px-4 py-8">
        <h1 className="mb-6 text-3xl font-bold">Reservar Turno</h1>

        {err && (
          <div className="mb-4 rounded-lg border border-red-300 bg-red-50 p-3 text-red-800">
            {err}
          </div>
        )}

        {/* STEPPER */}
        <div className="mb-8">
          <div className="flex items-center justify-center gap-2 sm:gap-4">
            {Array.from({ length: totalSteps }, (_, i) => i + 1).map((s, idx) => (
              <div key={s} className="flex items-center">
                <div
                  className={`flex h-10 w-10 items-center justify-center rounded-full font-semibold transition-all ${
                    step === s
                      ? "bg-fuchsia-600 text-white ring-4 ring-fuchsia-200"
                      : step > s
                      ? "bg-fuchsia-600 text-white"
                      : "bg-slate-300 text-slate-600"
                  }`}
                >
                  {step > s ? "‚úì" : s}
                </div>
                {idx < totalSteps - 1 && (
                  <div
                    className={`h-1 w-8 sm:w-16 transition-all ${
                      step > s ? "bg-fuchsia-600" : "bg-slate-300"
                    }`}
                  />
                )}
              </div>
            ))}
          </div>
          <div className="mt-3 text-center text-sm text-slate-600">
            {step === 1 && "Seleccion√° la sucursal"}
            {step === 2 && "Seleccion√° el barbero"}
            {step === 3 && "Seleccion√° el servicio"}
            {step >= 4 && step <= 3 + numSesiones && `Sesi√≥n ${step - 3} de ${numSesiones}: Fecha, hora y adicionales`}
          </div>
        </div>

        <div className="grid gap-6 lg:grid-cols-[1fr_400px]">
          {/* COLUMNA IZQUIERDA: STEP BY STEP */}
          <div className="space-y-4">
            {/* STEP 1: Sucursal */}
            {step === 1 && (
            <Section title="Seleccion√° la sucursal" expanded={true}>
              <div className="grid gap-3 sm:grid-cols-2">
                {sucursales.map(s => (
                  <button
                    key={s.id}
                    className={`rounded-lg border p-4 text-left transition-all ${
                      sucursalId === s.id
                        ? "border-fuchsia-500 bg-fuchsia-50 ring-2 ring-fuchsia-500"
                        : "border-slate-300 hover:border-fuchsia-300"
                    }`}
                    onClick={() => setSucursalId(s.id)}
                  >
                    <div className="font-semibold">{s.nombre}</div>
                    <div className="text-sm text-slate-600">{s.direccion}</div>
                  </button>
                ))}
              </div>
              {sucursalId && (
                <div className="mt-6">
                  <button
                    className="w-full rounded-lg bg-fuchsia-600 px-6 py-3 font-semibold text-white shadow-lg hover:bg-fuchsia-700 transition-all"
                    onClick={irSiguiente}
                  >
                    Siguiente
                  </button>
                </div>
              )}
            </Section>
            )}

            {/* STEP 2: Barbero */}
            {step === 2 && (
              <Section title="Seleccion√° el barbero" expanded={true}>
                <div className="grid gap-3 sm:grid-cols-2">
                  {barberos.map(b => (
                    <button
                      key={b.id}
                      className={`rounded-lg border p-4 text-left transition-all ${
                        barberoId === b.id
                          ? "border-fuchsia-500 bg-fuchsia-50 ring-2 ring-fuchsia-500"
                          : "border-slate-300 hover:border-fuchsia-300"
                      }`}
                      onClick={() => setBarberoId(b.id)}
                    >
                      {b.fotoUrl && (
                        <img
                          src={resolveUrl(b.fotoUrl)}
                          alt={b.nombre}
                          className="mb-2 h-20 w-20 rounded-full object-cover"
                        />
                      )}
                      <div className="font-semibold">{b.nombre}</div>
                    </button>
                  ))}
                </div>
                <div className="mt-6 flex gap-3">
                  <button
                    className="flex-1 rounded-lg border border-slate-300 px-6 py-3 font-semibold text-slate-700 hover:bg-slate-50 transition-all"
                    onClick={irAnterior}
                  >
                    Anterior
                  </button>
                  {barberoId && (
                    <button
                      className="flex-1 rounded-lg bg-fuchsia-600 px-6 py-3 font-semibold text-white shadow-lg hover:bg-fuchsia-700 transition-all"
                      onClick={irSiguiente}
                    >
                      Siguiente
                    </button>
                  )}
                </div>
              </Section>
            )}

            {/* STEP 3: Servicio Principal */}
            {step === 3 && (
              <Section title="Seleccion√° el servicio" expanded={true}>
                <div className="grid gap-3">
                  {servicios.filter(s => !s.adicional).map(s => (
                    <button
                      key={s.id}
                      className={`rounded-lg border p-4 text-left transition-all ${
                        servicioPrincipalId === s.id
                          ? "border-fuchsia-500 bg-fuchsia-50 ring-2 ring-fuchsia-500"
                          : "border-slate-300 hover:border-fuchsia-300"
                      }`}
                      onClick={() => setServicioPrincipalId(s.id)}
                    >
                      <div className="flex items-start justify-between">
                        <div>
                          <div className="font-semibold">{s.nombre}</div>
                          {s.descripcion && (
                            <div className="text-sm text-slate-600">{s.descripcion}</div>
                          )}
                          {(s.sesiones || 1) > 1 && (
                            <div className="mt-1 inline-flex items-center gap-1 rounded-full bg-fuchsia-100 px-2 py-0.5 text-xs font-medium text-fuchsia-700">
                              <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                              </svg>
                              {s.sesiones} sesiones
                            </div>
                          )}
                        </div>
                        <div className="text-lg font-bold text-fuchsia-600">${s.precio}</div>
                      </div>
                    </button>
                  ))}
                </div>
                <div className="mt-6 flex gap-3">
                  <button
                    className="flex-1 rounded-lg border border-slate-300 px-6 py-3 font-semibold text-slate-700 hover:bg-slate-50 transition-all"
                    onClick={irAnterior}
                  >
                    Anterior
                  </button>
                  {servicioPrincipalId && (
                    <button
                      className="flex-1 rounded-lg bg-fuchsia-600 px-6 py-3 font-semibold text-white shadow-lg hover:bg-fuchsia-700 transition-all"
                      onClick={irSiguiente}
                    >
                      Siguiente
                    </button>
                  )}
                </div>
              </Section>
            )}

            {/* STEPS 4+: Por cada sesi√≥n */}
            {step >= 4 && step <= 3 + numSesiones && (() => {
              const sesionIdx = step - 4;
              const sesion = sesiones[sesionIdx];
              if (!sesion) return null;

              return (
                <Section title={`Sesi√≥n ${sesionIdx + 1} de ${numSesiones}`} expanded={true}>
                  {/* Servicios adicionales para esta sesi√≥n */}
                  {servicesAdicionales.length > 0 && (
                    <div className="mb-6">
                      <h4 className="mb-3 text-sm font-medium text-slate-700">Servicios adicionales (opcional)</h4>
                      <div className="grid gap-2">
                        {servicesAdicionales.map(s => (
                          <button
                            key={s.id}
                            className={`rounded-lg border p-3 text-left transition-all ${
                              sesion.adicionalesIds.includes(s.id)
                                ? "border-green-500 bg-green-50 ring-2 ring-green-500"
                                : "border-slate-300 hover:border-green-300"
                            }`}
                            onClick={() => toggleAdicionalSesion(sesionIdx, s.id)}
                          >
                            <div className="flex items-start justify-between">
                              <div>
                                <div className="font-semibold text-sm">{s.nombre}</div>
                                {s.descripcion && (
                                  <div className="text-xs text-slate-600">{s.descripcion}</div>
                                )}
                              </div>
                              <div className="text-sm font-bold text-green-600">+${s.precio}</div>
                            </div>
                          </button>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Fecha y hora */}
                  <div className="space-y-4">
                    <div>
                      <h4 className="mb-2 text-sm font-medium text-slate-700">Seleccion√° la fecha</h4>
                      <div className="mb-2 flex items-center justify-between">
                        <div className="text-sm font-medium text-slate-700">{labelMes}</div>
                        <div className="flex gap-2">
                          <button
                            className="rounded-lg border-2 border-slate-300 px-4 py-2 text-xl font-bold text-slate-700 hover:bg-slate-100 hover:border-fuchsia-400 transition-all disabled:opacity-40 disabled:cursor-not-allowed"
                            onClick={() => setMonthOffset(Math.max(0, monthOffset - 1))}
                            disabled={monthOffset === 0}
                            aria-label="Mes anterior"
                          >
                            ‚Äπ
                          </button>
                          <button
                            className="rounded-lg border-2 border-slate-300 px-4 py-2 text-xl font-bold text-slate-700 hover:bg-slate-100 hover:border-fuchsia-400 transition-all"
                            onClick={() => setMonthOffset(monthOffset + 1)}
                            aria-label="Mes siguiente"
                          >
                            ‚Ä∫
                          </button>
                        </div>
                      </div>
                      <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2">
                        {monthDays.map(d => (
                          <button
                            key={d.iso}
                            className={`rounded-lg border p-2 text-sm ${
                              sesion.fecha === d.iso
                                ? "border-fuchsia-500 bg-fuchsia-500 text-white"
                                : "border-slate-300 hover:border-fuchsia-300"
                            }`}
                            onClick={() => selectFechaSesion(sesionIdx, d.iso)}
                          >
                            {d.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    {sesion.fecha && (
                      <div>
                        <h4 className="mb-2 text-sm font-medium text-slate-700">Horarios disponibles</h4>
                        <div className="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2">
                          {horasDisponibles.map(h => (
                            <button
                              key={h}
                              className={`rounded-lg border p-2 text-sm ${
                                sesion.hora === h
                                  ? "border-fuchsia-500 bg-fuchsia-500 text-white"
                                  : "border-slate-300 hover:border-fuchsia-300"
                              }`}
                              onClick={() => selectHoraSesion(sesionIdx, h)}
                            >
                              {h}
                            </button>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>

                  <div className="mt-6 flex gap-3">
                    <button
                      className="flex-1 rounded-lg border border-slate-300 px-6 py-3 font-semibold text-slate-700 hover:bg-slate-50 transition-all"
                      onClick={irAnterior}
                    >
                      Anterior
                    </button>
                    {sesion.fecha && sesion.hora && (
                      <button
                        className="flex-1 rounded-lg bg-fuchsia-600 px-6 py-3 font-semibold text-white shadow-lg hover:bg-fuchsia-700 transition-all"
                        onClick={irSiguiente}
                      >
                        {sesionIdx === numSesiones - 1 ? "Finalizar" : "Siguiente"}
                      </button>
                    )}
                  </div>
                </Section>
              );
            })()}
          </div>

          {/* COLUMNA DERECHA: RESUMEN */}
          <div className="lg:sticky lg:top-4 lg:self-start">
            <div className="rounded-xl border border-slate-300 bg-white p-6 shadow-xl">
              <h2 className="mb-4 text-xl font-bold">Resumen</h2>

              <div className="space-y-3 text-sm">
                {sucursalSeleccionada && (
                  <div>
                    <div className="font-medium text-slate-500">Sucursal:</div>
                    <div>{sucursalSeleccionada.nombre}</div>
                  </div>
                )}

                {barberoSeleccionado && (
                  <div>
                    <div className="font-medium text-slate-500">Barbero:</div>
                    <div>{barberoSeleccionado.nombre}</div>
                  </div>
                )}

                {servicioPrincipal && (
                  <div>
                    <div className="font-medium text-slate-500">Servicio:</div>
                    <div>{servicioPrincipal.nombre}</div>
                    <div className="text-fuchsia-600">${servicioPrincipal.precio}</div>
                  </div>
                )}

                {/* Mostrar resumen de cada sesi√≥n */}
                {sesiones.map((sesion, idx) => {
                  const adicionalesSesion = servicios.filter(s => sesion.adicionalesIds.includes(s.id));
                  const tieneDatos = sesion.fecha || sesion.hora || adicionalesSesion.length > 0;

                  if (!tieneDatos) return null;

                  return (
                    <div key={idx} className="border-t pt-3">
                      <div className="font-medium text-slate-500 mb-1">Sesi√≥n {idx + 1}:</div>

                      {sesion.fecha && (
                        <div className="text-xs">
                          üìÖ {dateFromISOLocal(sesion.fecha).toLocaleDateString("es-AR", {
                            weekday: "short",
                            day: "2-digit",
                            month: "short"
                          })}
                          {sesion.hora && ` a las ${sesion.hora} hs`}
                        </div>
                      )}

                      {adicionalesSesion.length > 0 && (
                        <div className="mt-1">
                          {adicionalesSesion.map(a => (
                            <div key={a.id} className="flex justify-between text-xs">
                              <span>+ {a.nombre}</span>
                              <span className="text-green-600">+${a.precio}</span>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>

              <div className="mt-4 border-t pt-4">
                <div className="flex justify-between text-lg font-bold mb-2">
                  <span>Total:</span>
                  <span className="text-fuchsia-600">${montoAPagar}</span>
                </div>

                {senia && (
                  <div className="mb-3 text-xs text-yellow-600 font-medium">
                    + ${montoRestante} en efectivo
                  </div>
                )}

                <div className="flex items-center justify-between p-3 rounded-lg border border-slate-200 hover:border-fuchsia-300 transition-all mb-3">
                  <label htmlFor="senia" className="text-sm font-medium cursor-pointer select-none flex-1">
                    Pagar se√±a del 50%
                  </label>
                  <button
                    type="button"
                    role="switch"
                    aria-checked={senia}
                    onClick={() => setSenia(!senia)}
                    className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-fuchsia-500 focus:ring-offset-2 ${
                      senia ? 'bg-fuchsia-600' : 'bg-slate-300'
                    }`}
                  >
                    <span
                      className={`inline-block h-4 w-4 transform rounded-full bg-white shadow-lg transition-transform ${
                        senia ? 'translate-x-6' : 'translate-x-1'
                      }`}
                    />
                  </button>
                </div>
              </div>

              <button
                ref={confirmarButtonRef}
                className={`mt-6 w-full rounded-lg px-6 py-3 font-semibold text-white shadow-lg transition-all ${
                  todoCompleto
                    ? "bg-green-600 hover:bg-green-700"
                    : "bg-slate-400 cursor-not-allowed opacity-60"
                } ${shouldHighlight ? 'animate-pulse ring-4 ring-green-400' : ''}`}
                onClick={confirmar}
                disabled={!todoCompleto}
              >
                {todoCompleto ? "Confirmar y Pagar" : "Complet√° todos los datos"}
              </button>
            </div>
          </div>
        </div>
      </div>

      <DatosClienteModal
        open={showDatosModal}
        onCancel={() => setShowDatosModal(false)}
        onConfirm={pagar}
      />
    </div>
  );
}

// ===== Section Component =====
type SectionProps = {
  title: string;
  expanded: boolean;
  children: React.ReactNode;
};

function Section({ title, expanded, children }: SectionProps) {
  if (!expanded) return null;

  return (
    <div className="rounded-xl border border-slate-300 bg-white p-6 shadow-md">
      <h3 className="mb-4 text-lg font-semibold">{title}</h3>
      {children}
    </div>
  );
}


========== FILE: ./pages/Turnos.tsx.backup ==========
import { ensureCsrf, getCsrfCookie } from "../lib/authApi";
import { useEffect, useMemo, useState } from "react";
import { BASE, RAW_URL, resolveUrl } from "../lib/adminApi";
import { useToast } from '../components/Toast';
import IntroSucursales from "../components/IntroSucursales";
import DatosClienteModal from "../components/DatosClienteModal";


/** ===== Tipos p√∫blicos ===== */
type SucursalDTO = { id: number; nombre: string; direccion: string; fotoUrl?: string | null };
type BarberoDTO = { id: number; nombre: string; sucursalId: number; fotoUrl?: string | null };
type ServicioDTO = {
  id: number;
  nombre: string;
  precio: number;
  duracionMin: number;
  descripcion?: string | null;
  sesiones?: number | null;
};

// ‚ö†Ô∏è Ajuste: solo pedimos estos 3 campos ahora
type ClienteForm = { nombre: string; edad: string; telefono: string };

/** ===== Helpers ===== */
async function getJSON<T>(url: string): Promise<T> {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status} ‚Äî ${url}`);
  return res.json();
}
const PublicApi = {
  async sucursales(): Promise<SucursalDTO[]> {
    return getJSON(`${BASE}/sucursales`);
  },
  async barberosBySucursal(sucursalId: number): Promise<BarberoDTO[]> {
    return getJSON(`${BASE}/barberos?sucursalId=${sucursalId}`);
  },
  async servicios(): Promise<ServicioDTO[]> {
    return getJSON(`${BASE}/servicios`);
  },
};

type DayOpt = { iso: string; label: string };

/** Forzar labels en espa√±ol */
function buildMonthDays(year: number, monthIdx0: number): DayOpt[] {
  const out: DayOpt[] = [];
  const d = new Date(year, monthIdx0, 1);
  const fmt = (x: Date) =>
    x.toLocaleDateString("es-AR", { weekday: "short", day: "2-digit", month: "short" });
  const pad = (n: number) => String(n).padStart(2, "0");
  while (d.getMonth() === monthIdx0) {
    const iso = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
    out.push({ iso, label: fmt(d) });
    d.setDate(d.getDate() + 1);
  }
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  return out.filter((opt) => {
    // no usamos new Date("YYYY-MM-DD") para evitar corrimientos
    const dd = dateFromISOLocal(opt.iso);
    dd.setHours(0, 0, 0, 0);
    return dd >= today;
  });
}

/** helper: a partir de "YYYY-MM-DD" devuelve Date local sin corrimiento */
function dateFromISOLocal(yyyy_mm_dd: string): Date {
  const [y, m, d] = yyyy_mm_dd.split("-").map(Number);
  return new Date(y, m - 1, d);
}

/** helper: suma minutos a "HH:mm" */
function addMinutes(hhmm: string, plus: number): string {
  const [h, m] = hhmm.split(":").map(Number);
  const t = new Date(2000, 0, 1, h, m, 0, 0);
  t.setMinutes(t.getMinutes() + plus);
  const hh = String(t.getHours()).padStart(2, "0");
  const mm = String(t.getMinutes()).padStart(2, "0");
  return `${hh}:${mm}`;
}

/** helper: obtiene rango [inicio..fin] con paso de 30m (FIN INCLUSIVO) */
function rangeTimes(inicio: string, fin: string): string[] {
  const acc: string[] = [];
  let t = inicio;
  while (t <= fin) {           // üëà ahora incluye el borde superior
    acc.push(t);
    t = addMinutes(t, 30);
  }
  return acc;
}

/** ===== Componente principal ===== */
type PlanItem = {
  key: string; // √∫nico
  servicioId: number;
  label: string; // ‚ÄúCorte cl√°sico (1/4)‚Äù
  precio: number;
  fecha?: string | null;
  hora?: string | null;
};

export default function Turnos() {
  const toast = useToast();

  const [introVisible, setIntroVisible] = useState(true);


  // datos
  const [sucursales, setSucursales] = useState<SucursalDTO[]>([]);
  const [barberos, setBarberos] = useState<BarberoDTO[]>([]);
  const [servicios, setServicios] = useState<ServicioDTO[]>([]);

  // selecci√≥n
  const [sucursalId, setSucursalId] = useState<number | null>(null);
  const [barberoId, setBarberoId] = useState<number | null>(null);
  const [cantidades, setCantidades] = useState<Record<number, number>>({});
  const [err, setErr] = useState<string | null>(null);

  // formulario cliente (solo 3 campos)
  const [cliente, setCliente] = useState<ClienteForm>({ nombre: "", telefono: "", edad: "" });

  // toggle de se√±a 50%
  const [senia, setSenia] = useState(false);

  // plan por sesiones
  const [plan, setPlan] = useState<PlanItem[]>([]);

  const totalImporte = useMemo(
    () => plan.reduce((acc, row) => acc + (row.precio || 0), 0),
    [plan]
  );

  // ==== Calendario por sesi√≥n (independiente) ====
  // offset de mes POR FILA/SESI√ìN (no por servicio)
  const [monthOffsetByRow, setMonthOffsetByRow] = useState<Record<string, number>>({});
  const offsetForRow = (rowKey: string) => monthOffsetByRow[rowKey] ?? 0;
  const gotoPrevMonthRow = (rowKey: string) => {
    setMonthOffsetByRow((prev) => {
      const curr = prev[rowKey] ?? 0;
      const next = Math.max(0, curr - 1); // no ir a meses anteriores al actual
      return { ...prev, [rowKey]: next };
    });
  };
  const gotoNextMonthRow = (rowKey: string) => {
    setMonthOffsetByRow((prev) => ({ ...prev, [rowKey]: (prev[rowKey] ?? 0) + 1 }));
  };
  const labelMesForRow = (rowKey: string) => {
    const base = new Date();
    base.setMonth(base.getMonth() + offsetForRow(rowKey));
    return base.toLocaleDateString("es-AR", { month: "long", year: "numeric" });
  };

  // Semana abierta del barbero (1=Lun..7=Dom)
  const [weekOpenDays, setWeekOpenDays] = useState<Set<number>>(new Set([1, 2, 3, 4, 5, 6])); // por defecto Lun‚ÄìS√°b
  const [weekRanges, setWeekRanges] = useState<Record<number, { inicio: string; fin: string }[]>>({});

  // D√≠as filtrados por sesi√≥n seg√∫n la semana abierta del barbero
  const monthDaysForRow = (rowKey: string): DayOpt[] => {
    const base = new Date();
    base.setDate(1);
    base.setMonth(base.getMonth() + offsetForRow(rowKey));
    return buildMonthDays(base.getFullYear(), base.getMonth()).filter((opt) => {
      const dd = dateFromISOLocal(opt.iso).getDay(); // 0=Dom..6=S√°b
      const dow = dd === 0 ? 7 : dd; // 1=Lun..7=Dom
      return weekOpenDays.has(dow);
    });
  };


  // ================== effects ==================
  useEffect(() => {
    (async () => {
      try {
        setErr(null);
        setSucursales(await PublicApi.sucursales());
      } catch (e: any) {
        setErr(e?.message || "Error cargando sucursales.");
      }
    })();
  }, []);

  useEffect(() => {
    (async () => {
      if (!sucursalId) {
        setBarberos([]);
        return;
      }
      try {
        setBarberos(await PublicApi.barberosBySucursal(sucursalId));
      } catch (e: any) {
        setErr(e?.message || "Error cargando barberos.");
      }
    })();
  }, [sucursalId]);

  // traer semana del barbero (d√≠as abiertos y rangos)
  useEffect(() => {
    (async () => {
      if (!barberoId) {
        setWeekOpenDays(new Set([1, 2, 3, 4, 5, 6])); // Lun‚ÄìS√°b por defecto
        setWeekRanges({});
        return;
      }
      try {
        const res = await fetch(`${BASE}/barberos/${barberoId}/horarios-semana`);
        if (!res.ok) throw new Error();
        const arr: Array<{ diaSemana: number; inicio: string; fin: string }> = await res.json();

        const days = new Set<number>();
        const map: Record<number, { inicio: string; fin: string }[]> = {};

        for (const h of arr) {
          const n = Number(h.diaSemana);
          const dow = n === 0 ? 7 : n; // ‚ö†Ô∏è normalizar: 0 (Dom) -> 7
          days.add(dow);
          (map[dow] ||= []).push({ inicio: h.inicio, fin: h.fin });
        }
        // ordenar tramos por hora de inicio
        Object.keys(map).forEach(k =>
          map[Number(k)].sort((a, b) => a.inicio.localeCompare(b.inicio))
        );

        setWeekOpenDays(days);
        setWeekRanges(map);
      } catch {
        // dejamos defaults
      }
    })();
  }, [barberoId]);


  // Disponibilidad por fecha (YYYY-MM-DD) cacheada desde el backend
  const [horasDisponiblesByDate, setHorasDisponiblesByDate] = useState<Record<string, string[]>>({});

  async function cargarDisponibilidadFecha(fechaISO: string): Promise<string[]> {
    if (!barberoId || !fechaISO) return [];
    // cache simple por fecha
    if (horasDisponiblesByDate[fechaISO]) return horasDisponiblesByDate[fechaISO];
    const res = await fetch(`${BASE}/disponibilidad?barberoId=${barberoId}&fecha=${fechaISO}`);
    if (!res.ok) return [];
    const horas: string[] = await res.json();
    setHorasDisponiblesByDate(prev => ({ ...prev, [fechaISO]: horas }));
    return horas;
  }



  // helper com√∫n para no repetir l√≥gica
  function buildRowsForService(srv: ServicioDTO, qty: number): PlanItem[] {
    const sesionesPorPack = Math.max(1, Number(srv.sesiones) || 1);
    const totalRows = sesionesPorPack * qty;

    const rows: PlanItem[] = [];
    for (let i = 0; i < totalRows; i++) {
      const esPrimeraDePack = (i % sesionesPorPack) === 0;     // 1ra sesi√≥n del pack
      const packIndex = Math.floor(i / sesionesPorPack) + 1;   // n¬∫ de pack (1..qty)
      const sesionIndex = (i % sesionesPorPack) + 1;           // n¬∫ de sesi√≥n dentro del pack (1..sesiones)

      rows.push({
        key: `${srv.id}-${i + 1}-${Date.now()}`,
        servicioId: srv.id,
        label: `${srv.nombre} (pack ${packIndex}/${qty}, sesi√≥n ${sesionIndex}/${sesionesPorPack})`,
        // üí° SOLO la primera sesi√≥n de cada pack aporta precio:
        precio: esPrimeraDePack ? Number(srv.precio) || 0 : 0,
        // opcionalmente pod√©s inicializar:
        // fecha: "",
        // hora: "",
      });
    }
    return rows;
  }

  const addServicio = (srv: ServicioDTO) => {
    const qtyPrev = Number(cantidades[srv.id]) || 0;
    const qtyNew = qtyPrev + 1;

    // filtramos las filas de OTROS servicios
    const others = plan.filter((row) => row.servicioId !== srv.id);

    // reconstruimos SOLO las filas de este servicio con la nueva cantidad
    const rebuilt = buildRowsForService(srv, qtyNew);

    setCantidades((q) => ({ ...q, [srv.id]: qtyNew }));
    setPlan([...others, ...rebuilt]);
  };

  const rmServicio = (srv: ServicioDTO) => {
    const qtyPrev = Number(cantidades[srv.id]) || 0;
    if (qtyPrev <= 0) return;

    const qtyNew = qtyPrev - 1;
    const others = plan.filter((row) => row.servicioId !== srv.id);

    if (qtyNew === 0) {
      setCantidades((q) => ({ ...q, [srv.id]: 0 }));
      setPlan(others);
      return;
    }

    const rebuilt = buildRowsForService(srv, qtyNew);

    setCantidades((q) => ({ ...q, [srv.id]: qtyNew }));
    setPlan([...others, ...rebuilt]);
  };

  const setFecha = (idx: number, fecha: string) => {
    setPlan((p) => p.map((row, i) => (i === idx ? { ...row, fecha } : row)));
  };
  const setHora = (idx: number, hora: string) => {
    setPlan((p) => p.map((row, i) => (i === idx ? { ...row, hora } : row)));
  };

  const readyToConfirm = !!sucursalId && !!barberoId && plan.length > 0 && plan.every((p) => p.fecha && p.hora);

  const confirmar = () => {
    if (readyToConfirm) setShowCliente(true);
    else toast("Asign√° fecha y hora a todas las sesiones.");
  };
  const closeCliente = () => setShowCliente(false);

  // ================== pago (ajustado a 3 campos + toasts + se√±a) ==================
  async function pagar(override?: { nombre: string; telefono: string; edad: number }) {
    const c = override ?? {
      nombre: (cliente.nombre || "").trim(),
      telefono: cliente.telefono || "", // Ya viene formateado desde DatosClienteModal
      edad: Number(cliente.edad),
    };

    // Validaci√≥n: el tel√©fono ya viene con formato internacional (+54...)
    // Debe tener al menos 12 caracteres (ej: +5493547640108 = 14 chars)
    if (!c.telefono || c.telefono.length < 12) {
      toast("Ingres√° un tel√©fono v√°lido.");
      return;
    }
    if (!c.nombre) {
      toast("Falta el nombre.");
      return;
    }
    if (!Number.isFinite(c.edad) || c.edad <= 0) {
      toast("Edad inv√°lida.");
      return;
    }
    if (!(plan.length > 0 && plan.every(p => p.fecha && p.hora))) {
      toast("Asign√° fecha y hora a todas las sesiones.");
      return;
    }
    // Evitar duplicados (misma fecha|hora)
    {
      const seen = new Set<string>();
      for (const row of plan) {
        const key = `${row.fecha}|${row.hora}`;
        if (seen.has(key)) {
          toast("Ten√©s dos sesiones con la misma fecha/hora. Cambi√° uno de los horarios.");
          return;
        }
        seen.add(key);
      }
    }

    try {
      const sesion = plan[0];
      if (!sesion?.fecha || !sesion?.hora) {
        toast("Asign√° fecha y hora a la sesi√≥n.");
        return;
      }

      // üÜï Soportar m√∫ltiples sesiones
      const payloadCheckout: any = {
        sucursalId: Number(sucursalId),
        barberoId:  Number(barberoId),
        tipoCorteId: Number(sesion.servicioId),
        clienteNombre: c.nombre,
        clienteTelefono: c.telefono, // Ya viene formateado desde DatosClienteModal
        clienteEdad: c.edad,
        senia: !!senia,
        montoTotal: Math.round(totalImporte),
      };

      // Si hay m√∫ltiples sesiones, enviar array de horarios
      if (plan.length > 1) {
        payloadCheckout.horarios = plan.map(p => ({
          fecha: String(p.fecha).trim(),
          hora: String(p.hora).trim(),
          servicioId: p.servicioId, // üîß Incluir servicioId para cada sesi√≥n
        }));
      } else {
        // Sesi√≥n √∫nica: mantener compatibilidad
        payloadCheckout.fecha = String(sesion.fecha).trim();
        payloadCheckout.hora = String(sesion.hora).trim();
      }

      // sanity check r√°pida
      if (
        !Number.isFinite(payloadCheckout.sucursalId) || payloadCheckout.sucursalId <= 0 ||
        !Number.isFinite(payloadCheckout.barberoId)  || payloadCheckout.barberoId  <= 0 ||
        !Number.isFinite(payloadCheckout.tipoCorteId)|| payloadCheckout.tipoCorteId<= 0
      ) {
        toast("Falta informaci√≥n del turno (ids).");
        return;
      }

      // Validar horarios
      if (payloadCheckout.horarios) {
        // Multi-sesi√≥n
        for (const h of payloadCheckout.horarios) {
          if (!/^\d{4}-\d{2}-\d{2}$/.test(h.fecha) || !/^\d{2}:\d{2}$/.test(h.hora)) {
            toast("Formato de fecha/hora inv√°lido.");
            return;
          }
        }
      } else {
        // Sesi√≥n √∫nica
        if (!/^\d{4}-\d{2}-\d{2}$/.test(payloadCheckout.fecha) || !/^\d{2}:\d{2}$/.test(payloadCheckout.hora)) {
          toast("Formato de fecha/hora inv√°lido.");
          return;
        }
      }

      // --- CSRF ---
      await ensureCsrf(RAW_URL);                   // pide cookie CSRF si falta
      const csrf = getCsrfCookie();               // lee cookie CSRF

      toast("Redirigiendo a Mercado Pago‚Ä¶");
      const chk = await fetch(`${RAW_URL}/pagos/checkout`, {
        method: "POST",
        credentials: "include",                   // MUY IMPORTANTE para mandar cookies
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": csrf,                   // double-submit header
        },
        // ‚ùå SIN X-CSRF-Token
        body: JSON.stringify(payloadCheckout),
      });

      if (!chk.ok) {
        console.error("Error /pagos/checkout:", await chk.text());
        toast("Error al iniciar el pago.");
        return;
      }

      const data = await chk.json();
      const initPoint = data?.init_point || data?.initPoint || data?.url;
      if (!initPoint) {
        toast("Checkout no disponible.");
        return;
      }
      window.location.href = initPoint;

    } catch (err: any) {
      console.error(err);
      toast("Error al procesar el pago.");
    }
  }


  // ==== UI ====
  const [showCliente, setShowCliente] = useState(false);

  // cargar servicios (igual que ten√≠as)
  useEffect(() => {
    (async () => {
      try {
        setServicios(await PublicApi.servicios());
      } catch {
        // silencioso
      }
    })();
  }, []);

  // ========= Render =========
  return (
    <div className="max-w-6xl mx-auto p-4 grid gap-6 md:grid-cols-[1.1fr_0.9fr]">
      {introVisible && !sucursalId && (
        <IntroSucursales
          onSelect={(id) => {
            setSucursalId(id);
            setIntroVisible(false);
          }}
        />
      )}

      {/* Col principal */}
      <div className="space-y-6">
        {err && (
          <div className="rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-red-700">{err}</div>
        )}

        {/* 1) Sucursal */}
        <Section title="1) Eleg√≠ una sucursal">
          <div className="grid gap-3 sm:grid-cols-2">
            {sucursales.map((s) => {
              const active = s.id === sucursalId;
              return (
                <button
                  key={s.id}
                  onClick={() => {
                    setSucursalId(s.id);
                    setBarberoId(null);
                    setCantidades({});
                    setPlan([]);
                  }}
                  className={`text-left rounded-2xl border p-3 hover:shadow ${
                    active ? "border-indigo-500 ring-2 ring-indigo-200" : "border-slate-200"
                  }`}
                >
                  <div className="flex items-center gap-3">
                    <div className="h-14 w-14 rounded-xl overflow-hidden bg-slate-100 border">
                      {s.fotoUrl ? (
                        <img src={resolveUrl(s.fotoUrl)} className="h-full w-full object-cover" />
                      ) : (
                        <div className="h-full w-full grid place-items-center text-xs text-slate-500">Sucursal</div>
                      )}
                    </div>
                    <div>
                      <div className="font-semibold">{s.nombre}</div>
                      <div className="text-xs text-slate-500">{s.direccion}</div>
                      {/* acceso directo a Google Maps */}
                      <a
                        href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.direccion || s.nombre)}`}
                        target="_blank"
                        rel="noreferrer"
                        onClick={(e) => e.stopPropagation()}
                        className="text-xs text-indigo-600 underline"
                      >
                        C√≥mo llegar
                      </a>
                    </div>
                  </div>
                </button>
              );
            })}
            {sucursalId && sucursales.length === 0 && (
              <div className="text-sm text-slate-500">Sin sucursales.</div>
            )}
          </div>
        </Section>

        {/* 2) Barbero */}
        <Section title="2) Eleg√≠ tu barbero" disabled={!sucursalId}>
          <div className="grid gap-3 sm:grid-cols-2">
            {barberos.map((b) => {
              const active = b.id === barberoId;
              return (
                <button
                  key={b.id}
                  onClick={() => {
                    setBarberoId(b.id);
                    setCantidades({});
                    setPlan([]);
                  }}
                  className={`text-left rounded-2xl border p-3 hover:shadow ${
                    active ? "border-indigo-500 ring-2 ring-indigo-200" : "border-slate-200"
                  }`}
                >
                  <div className="flex items-center gap-3">
                    {b.fotoUrl ? (
                      <img
                        src={resolveUrl(b.fotoUrl)!}
                        alt={b.nombre}
                        className="h-14 w-14 rounded-full object-cover border shrink-0"
                      />
                    ) : (
                      <div className="h-14 w-14 rounded-full bg-slate-200 grid place-items-center text-xs text-slate-600 border shrink-0">
                        Sin foto
                      </div>
                    )}
                    <div className="font-semibold">{b.nombre}</div>
                  </div>
                </button>
              );
            })}
            {sucursalId && barberos.length === 0 && (
              <div className="text-sm text-slate-500">Sin barberos.</div>
            )}
          </div>
        </Section>

        {/* 3) Servicios (cantidad) */}
        <Section title="3) Eleg√≠ tus servicios" disabled={!barberoId}>
          <div className="grid gap-3 sm:grid-cols-2">
            {servicios.map((s) => {
              const qty = cantidades[s.id] || 0;
              const sesiones = s.sesiones && s.sesiones > 0 ? s.sesiones : 1;
              return (
                <div
                  key={s.id}
                  className={`rounded-2xl border p-3 ${
                    qty > 0 ? "border-indigo-500 ring-2 ring-indigo-200" : "border-slate-200"
                  }`}
                >
                  <div className="flex items-center justify-between">
                    <div className="font-semibold">{s.nombre}</div>
                    <div className="text-slate-500">${s.precio}</div>
                  </div>
                  {s.descripcion && <div className="text-xs text-slate-500 mt-1">{s.descripcion}</div>}

                  <div className="mt-3 flex items-center gap-2">
                    <button className="rounded-lg border px-3 py-1" onClick={() => rmServicio(s)} disabled={qty <= 0}>
                      ‚àí
                    </button>
                    <div className="w-10 text-center">{qty}</div>
                    <button className="rounded-lg border px-3 py-1" onClick={() => addServicio(s)}>
                      +
                    </button>
                  </div>

                  {qty > 0 && (
                    <div className="mt-2 text-xs text-slate-500">
                      {sesiones} sesi√≥n{sesiones !== 1 ? "es" : ""} √ó {qty} = {sesiones * qty} turnos
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </Section>

        {/* 4) Calendario por sesi√≥n */}
        <Section title="4) Eleg√≠ fecha y hora" disabled={!barberoId || plan.length === 0}>
          <div className="grid gap-4">
            {plan.map((row, idx) => {
              const days = monthDaysForRow(row.key);
              const selectedDate = row.fecha ? dateFromISOLocal(row.fecha) : null;

              // construir rango horario para el d√≠a seleccionado 
              const dd  = selectedDate?.getDay() ?? 0; // 0=Dom..6=S√°b
              const dow = dd === 0 ? 7 : dd;
              const ranges = weekRanges[dow] || []; // [{inicio, fin}] (T1/T2)
              const hoursForDay = ranges.flatMap(r => rangeTimes(r.inicio, r.fin));
              const horasDisponibles = hoursForDay; // ya vienen limitadas al/los tramos reales

              
              // Partir de las horas construidas desde T1/T2
              let visibleTimes = Array.from(new Set(horasDisponibles));

              // Aseguramos s√≥lo el inicio, jam√°s el fin (exclusivo)
              ranges.forEach((r) => {
                if (r?.inicio && !visibleTimes.includes(r.inicio)) visibleTimes.push(r.inicio);
              });
              visibleTimes.sort((a, b) => a.localeCompare(b));



              // slots tomados por otras sesiones (evitar solapamiento)
              const takenSlots = new Set(plan.filter((_, i) => i !== idx).map((p) => `${p.fecha}|${p.hora}`));

              return (
                <div key={row.key} className="rounded-xl border p-3">
                  <div className="flex items-center justify-between">
                    <div className="font-medium">{row.label}</div>
                    <span className="text-xs text-slate-500">
                      {row.fecha ? (
                        <>
                          {dateFromISOLocal(row.fecha).toLocaleDateString("es-AR", {
                            weekday: "short",
                            day: "2-digit",
                            month: "short",
                          })}
                          {row.hora ? <> ‚Äî <b>{row.hora} hs</b></> : null}
                        </>
                      ) : null}
                    </span>
                  </div>

                  <div className="grid gap-3 lg:grid-cols-[2fr_1fr]">
                    {/* Columna de fechas */}
                    <div>
                      <div className="mb-2 flex items-center justify-between">
                        <div className="text-xs text-slate-500">{labelMesForRow(row.key)}</div>
                        <div className="flex items-center gap-2">
                          <button
                            className="rounded-lg border px-2 py-1"
                            onClick={() => gotoPrevMonthRow(row.key)}
                            disabled={offsetForRow(row.key) === 0}
                            title="Mes anterior"
                          >
                            ‚Äπ
                          </button>
                          <button
                            className="rounded-lg border px-2 py-1"
                            onClick={() => gotoNextMonthRow(row.key)}
                            title="Mes siguiente"
                          >
                            ‚Ä∫
                          </button>
                        </div>
                      </div>

                      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                        {days.map((d) => {
                          const active = row.fecha === d.iso;
                          const takenInDay = new Set(
                            plan.filter((p) => p.fecha === d.iso && p.hora).map((p) => p.hora!)
                          );
                          return (
                            <button
                              key={d.iso}
                              className={`rounded-lg border px-3 py-2 text-left ${
                                active ? "border-indigo-500 ring-2 ring-indigo-200" : "border-slate-200"
                              }`}
                              onClick={async () => {
                                setFecha(idx, d.iso);
                                setHora(idx, ""); // reset

                                await cargarDisponibilidadFecha(d.iso);
                              }}
                            >
                              <div className="text-xs">{d.label}</div>
                              {row.fecha === d.iso && (
                                <div className="mt-1 text-[11px] text-slate-500">
                                  {takenInDay.size} turno{takenInDay.size !== 1 ? "s" : ""} ya asignado{takenInDay.size !== 1 ? "s" : ""}
                                </div>
                              )}
                            </button>
                          );
                        })}
                      </div>
                    </div>

                    {/* Columna de horas */}
                    <div>
                      <div className="text-xs text-slate-500 mb-1">Horarios</div>
                      {/* si no hay fecha elegida a√∫n */}
                      {!row.fecha && <div className="text-sm text-slate-500">Eleg√≠ un d√≠a primero.</div>}
                      {row.fecha && (
                        <div className="flex flex-wrap gap-2">
                          {(() => {
                            const setDisponibles = new Set(
                              row.fecha ? (horasDisponiblesByDate[row.fecha] ?? horasDisponibles) : horasDisponibles
                            );

                            return (
                              <div className="flex flex-wrap gap-2">
                                {visibleTimes.map((time) => {
                                  const active = time === row.hora;

                                  const notAvailable = !setDisponibles.has(time);

                                  const myKey = `${row.fecha}|${time}`;
                                  const isTakenByOther =
                                    takenSlots.has(myKey) &&
                                    !(row.fecha && row.hora && `${row.fecha}|${row.hora}` === myKey);

                                  const disabled = notAvailable || isTakenByOther;

                                  return (
                                    <button
                                      key={time}
                                      disabled={disabled}
                                      onClick={() => setHora(idx, time)}
                                      title={
                                        isTakenByOther
                                          ? "Horario ocupado por otra sesi√≥n"
                                          : notAvailable
                                          ? "Bloqueado / no disponible"
                                          : ""
                                      }
                                      className={`rounded-lg border px-2 py-1 text-sm ${
                                        active
                                          ? "border-indigo-500 ring-2 ring-indigo-200"
                                          : disabled
                                          ? "border-slate-200 text-slate-400"
                                          : "border-slate-300 hover:border-slate-500"
                                      }`}
                                    >
                                      {time}
                                    </button>
                                  );
                                })}
                              </div>
                            );
                          })()}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </Section>
      </div>

      {/* Col lateral: resumen + datos cliente */}
      <aside className="space-y-4">
        <Section title="Resumen">
          <ul className="text-sm">
            <li className="mb-1">
              <span className="text-slate-500">Sucursal:</span>{" "}
              <b>{sucursales.find((s) => s.id === sucursalId)?.nombre || "-"}</b>
            </li>
            <li className="mb-1">
              <span className="text-slate-500">Barbero:</span>{" "}
              <b>{barberos.find((b) => b.id === barberoId)?.nombre || "-"}</b>
            </li>
            <li className="mb-1">
              <span className="text-slate-500">Servicios:</span>
              {Object.entries(cantidades)
                .filter(([, q]) => q > 0)
                .map(([sid, q]) => {
                  const s = servicios.find((x) => x.id === Number(sid));
                  return (
                    <div key={sid} className="ml-1">
                      ‚Ä¢ {s?.nombre} √ó {q}
                    </div>
                  );
                })}
            </li>
            <li className="mb-1">
              <span className="text-slate-500">Sesiones:</span>
              <ul className="ml-1">
                {plan.map((p, i) => (
                  <li key={p.key}>
                    #{i + 1} ‚Äî{" "}
                    {p.fecha && p.hora ? (
                      <b>
                        {dateFromISOLocal(p.fecha).toLocaleDateString("es-AR", {
                          weekday: "short",
                          day: "2-digit",
                          month: "short",
                        })}
                        , {p.hora} hs
                      </b>
                    ) : (
                      <span className="text-slate-400">sin asignar</span>
                    )}
                  </li>
                ))}
              </ul>
            </li>
          </ul>
          <div className="border-t my-3" />
          <div className="flex items-center justify-between">
            <div className="text-slate-500">Total</div>
            <div className="text-xl font-semibold">${totalImporte}</div>
          </div>

          {/* Toggle se√±a 50% */}
          <div className="mt-3 flex items-center gap-4 text-sm">
            <label className="inline-flex items-center gap-2">
              <input type="radio" checked={!senia} onChange={() => setSenia(false)} />
              <span>Pago total</span>
            </label>
            <label className="inline-flex items-center gap-2">
              <input type="radio" checked={senia} onChange={() => setSenia(true)} />
              <span>Se√±a 50%</span>
            </label>
          </div>
          {senia && (
            <div className="text-xs text-slate-600 mt-1">
              Abon√°s ahora <b>${Math.round(totalImporte / 2)}</b>. El barbero cobrar√° el resto al finalizar.
            </div>
          )}

          <button
            disabled={!readyToConfirm}
            onClick={confirmar}
            className="mt-4 w-full rounded-xl bg-indigo-600 px-4 py-2 text-white disabled:bg-slate-300"
          >
            Confirmar y pagar
          </button>
        </Section>
      </aside>
      <DatosClienteModal
        open={showCliente}
        onCancel={closeCliente}
        onConfirm={(datos) => {
          // El tel√©fono ya viene formateado desde DatosClienteModal (+549...)
          const clean = {
            nombre: datos.nombre.trim(),
            telefono: datos.telefono, // Ya tiene formato internacional
            edad: Number(datos.edad),
          };

          // actualiz√° tu estado (si lo necesit√°s para mostrar en UI)
          setCliente({
            nombre: clean.nombre,
            telefono: clean.telefono,
            edad: String(clean.edad),
          });

          setShowCliente(false);

          // llam√° a pagar con los datos limpios para evitar carreras con setState
          pagar(clean); // <- ver firma abajo
        }}
      />

    </div>
  );
}

/** ====== utilidades locales del componente ====== */

function Section({
  title,
  children,
  disabled,
}: {
  title: string;
  children: React.ReactNode;
  disabled?: boolean;
}) {
  return (
    <section className={`rounded-2xl border p-4 bg-white shadow-sm ${disabled ? "opacity-50 pointer-events-none" : ""}`}>
      <h2 className="font-semibold mb-3">{title}</h2>
      {children}
    </section>
  );
}


========== FILE: ./types.ts ==========
export type ID = number | string

export interface Sucursal {
  id: ID
  nombre: string
  direccion?: string
  activa?: boolean
}

export interface Barbero {
  id: ID
  nombre: string
  bio?: string
  fotoUrl?: string
  instagram?: string
  facebook?: string
  activo?: boolean
  telefono?: string
  
}

export interface Servicio {
  id: ID
  nombre: string
  precio: number
  descripcion?: string
  duracionMin?: number
  activo?: boolean
}

export interface ReservaRequest {
  sucursalId: ID
  servicioId: ID
  barberoId: ID
  fecha: string
  hora: string
  clienteNombre: string
  clienteTelefono: string
  clienteEdad: number
  // Opcionales por ahora:
  clienteEmail?: string
  clienteDni?: string
}

export interface ReservaResponse {
  id: ID
  estado: 'PENDIENTE_PAGO' | 'PAGADA' | 'CANCELADA'
}



========== FILE: ./vite-env.d.ts ==========
/// <reference types="vite/client" />


